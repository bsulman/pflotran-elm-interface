\documentclass[12pt]{article}
%\usepackage{times}
%\usepackage{palatino}
\usepackage[T1]{fontenc}
\usepackage{fourier}
\usepackage{amsmath,amsbsy,amssymb}
\usepackage{deflist}
%\usepackage{fancyheadings}
\usepackage{fancyhdr}
\usepackage{tabularx}
\usepackage{verbatim}
\usepackage{moreverb}
\usepackage{float}
\usepackage{fancybox}
\usepackage{graphicx}
\usepackage{longtable}
\usepackage{subfigure}
%\usepackage{ssss}
\usepackage{fancybox}
\usepackage{booktabs}
\usepackage{array}
\usepackage{colortbl}
\usepackage{color}
\usepackage[table]{xcolor}
%\usepackage{toc_entr}
\usepackage[debug=false, colorlinks=true, pdfstartview=FitV, linkcolor=blue, citecolor=black, urlcolor=blue]{hyperref}

\textwidth 6.5in
\textheight 9.5in
\topmargin -1.0in
%\topmargin -3.280cm
\newlength{\boxwidth}
\setlength{\boxwidth}{5.8in}
\oddsidemargin 0.in
\evensidemargin 0.in
\headheight 0.25in
\lhead{\sl PFLOTRAN: Quick Reference User Guide}
\chead{\sl DRAFT}
%\chead{\rm - \thepage\ -}
%\rhead{DRAFT \qquad \qquad \ \today}
\rhead{\today}
%\rfoot{\today--[\thepage]}
\rfoot{}
\cfoot{\rm - \thepage\ -}
%\cfoot{}
%\footrulewidth 0.4pt
\newcommand\keyend{{(.,\,/,\,END)}}
\newcommand{\negsp}{\vspace{-4mm}}
\newcommand\secsp{\vspace{-3 mm}}
\newcommand\secspb{\vspace{-2 mm}}
\newcommand\subsecsp{\vspace{-0.0 mm}}
\newcommand\pflotran{{\bf\sl PFLOTRAN}}
\newcommand\pflow{{\bf\sl PFLOW}}
\newcommand\ptran{{\bf\sl PTRAN}}
\renewcommand{\baselinestretch}{1.01}
%\setlength{\baselineskip}{13pt}
\def\EQ#1\EN{\begin{equation}#1\end{equation}}
\def\BA#1\EA{\begin{align}#1\end{align}}
\def\BS#1\ES{\begin{split}#1\end{split}}
%\newcommand{\EQ}{\begin{equation}}
%\newcommand{\EN}{\end{equation}}
\newcommand{\longline}{\noindent\rule[-0.1in]{\textwidth}{0.01in}}
\newcommand{\bc}{\begin{center}}
\newcommand{\ec}{\end{center}}
\newcommand{\degc}{$^\circ$C}
\newcommand{\eq}{\ =\ }
\newcommand{\eff}{{\rm eff}}
\newcommand{\eqr}{{\rm le}}
\newcommand{\equ}{{\rm eq}}
\newcommand{\kin}{{\rm kin}}
\newcommand{\rdx}{{\rm rdx}}
\newcommand{\ind}{{\rm id}}
\newcommand{\dep}{{\rm dp}}
\newcommand{\e}{{\rm{e}}}
\newcommand{\erf}{{\rm{erf}}}
\newcommand{\erfc}{{\rm{erfc}}}
\renewcommand{\sc}{{\rm sc}}
\newcommand{\sign}{{\rm{sign}}}
\newcommand{\p}{{\partial}}
\newcommand{\im}{{\rm im}}
\newcommand{\m}{{\rm m}}
\newcommand{\A}{{\mathcal A}}
\newcommand{\B}{{\mathcal B}}
\newcommand{\C}{{\mathcal C}}
\newcommand{\D}{{\mathcal D}}
\newcommand{\E}{{\mathcal E}}
\newcommand{\F}{{\mathcal F}}
\newcommand{\G}{{\mathcal G}}
\newcommand{\J}{{\mathcal J}}
\newcommand{\jo}{{j_o}}
\newcommand{\M}{{\mathcal M}}
\newcommand{\mO}{{\mathcal O}}
\renewcommand{\P}{{{\mathcal P}}}
\newcommand{\Q}{{\mathcal Q}}
\newcommand{\R}{{{\mathcal R}}}
\renewcommand{\S}{{\mathcal S}}
\newcommand{\T}{{\mathcal T}}
\newcommand{\W}{{\mathcal W}}
\newcommand{\X}{{\mathcal X}}
\newcommand{\Y}{{\mathcal Y}}
\newcommand{\Z}{{\mathcal Z}}
\newcommand{\rev}{{\rm rev}}
\newcommand{\irr}{{\rm irr}}
\renewcommand{\a}{{\alpha}}
\newcommand{\abar}{{\bar \alpha}}
\renewcommand{\b}{{\beta}}
\renewcommand{\c}{{\rm CO_2}}
\newcommand{\w}{{\rm H_2O}}
\newcommand{\air}{{\rm N_2}}
\newcommand{\pe}{{\rm Pe}}
\newcommand{\da}{{\rm Da}}
\renewcommand{\k}{{\dot R}^0}
\renewcommand{\L}{\widehat{\mathcal L}}
\renewcommand{\bar}{\overline}
\newcommand{\dsty}{{\displaystyle}}
\newcommand{\diff}{{\mathcal D}}
\newcommand{\surf}{\equiv \!\!\!}
\newcommand{\bnabla}{\boldsymbol{\nabla}}
\newcommand{\bA}{\boldsymbol{A}}
\newcommand{\ba}{\boldsymbol{a}}
\newcommand{\bB}{\boldsymbol{B}}
\newcommand{\bC}{\boldsymbol{C}}
\newcommand{\bD}{\boldsymbol{D}}
\newcommand{\bE}{\boldsymbol{E}}
\newcommand{\bF}{\boldsymbol{F}}
\newcommand{\bi}{\boldsymbol{i}}
\newcommand{\bI}{\boldsymbol{I}}
\newcommand{\bJ}{\boldsymbol{J}}
\newcommand{\bK}{\boldsymbol{K}}
\newcommand{\bM}{\boldsymbol{M}}
\newcommand{\bg}{\boldsymbol{g}}
\newcommand{\bGamma}{\boldsymbol{\Gamma}}
\newcommand{\bOmega}{\boldsymbol{\Omega}}
\newcommand{\bPsi}{\boldsymbol{\Psi}}
\newcommand{\bO}{\boldsymbol{O}}
\newcommand{\bnu}{\boldsymbol{\nu}}
\newcommand{\bdS}{\boldsymbol{dS}}
\newcommand{\bq}{\boldsymbol{q}}
\newcommand{\br}{\boldsymbol{r}}
\newcommand{\bR}{\boldsymbol{R}}
\newcommand{\bS}{\boldsymbol{S}}
\newcommand{\bu}{\boldsymbol{u}}
\newcommand{\bv}{\boldsymbol{v}}
\newcommand{\bx}{\boldsymbol{x}}
\newcommand{\by}{\boldsymbol{y}}
\newcommand{\bz}{\boldsymbol{z}}
\newcommand{\bzero}{\boldsymbol{0}}
\newcommand{\arrows}{~\rightleftharpoons~}
\newcommand{\arrowstab}{\!\!\!\rightleftharpoons\!\!\!}
\newcommand{\CA}{C_{\rm A}}
\newcommand{\CB}{C_{\rm B}}
\newcommand{\CC}{C_{\rm C}}
\newcommand{\CAB}{C_{\rm AB}}
\newcommand{\CBC}{C_{\rm BC}}
\newcommand{\RA}{\R_{\rm A}}
\newcommand{\RB}{\R_{\rm B}}
\newcommand{\RC}{\R_{\rm C}}
\newcommand{\RAB}{\R_{\rm AB}}
\newcommand{\RBC}{\R_{\rm BC}}
%\newcommand{\kdsc}{K^{DS}}
%\newcommand{\kdec}{K^{DE}}
%\newcommand{\kdsm}{\overline K^{DS}}
%\newcommand{\kdem}{\overline K^{DE}}
\newcommand{\kdsc}{K^{sc}}
\newcommand{\kdec}{K^{ec}}
\newcommand{\kdsm}{K^{sm}}
\newcommand{\kdem}{K^{em}}
\newcommand{\csm}{S}
\renewcommand{\csc}{S}
\newcommand{\cem}{\E}
\newcommand{\cec}{\E}
\renewcommand{\min}{{\rm min}}
\newcommand{\coll}{{\rm coll}}
\newcommand{\ex}{{\rm ex}}
\newcommand{\srf}{{\rm srf}}
\def\dbar{{\mkern2mu\mathchar'26\mkern-11mu\mathrm{d}}}

\newcounter{saveeqn}%
\newcommand{\alpheqn}{\setcounter{saveeqn}{\value{equation}}%
\stepcounter{saveeqn}\setcounter{equation}{0}%
\renewcommand{\theequation}
      {\mbox{\arabic{saveeqn}\alph{equation}}}}%
\newcommand{\reseteqn}{\setcounter{equation}{\value{saveeqn}}%
\renewcommand{\theequation}{\arabic{equation}}}%

\renewcommand{\contentsname}{TABLE OF CONTENTS}
\renewcommand{\listfigurename}{{LIST OF FIGURES}}
\renewcommand{\listtablename}{{LIST OF TABLES}}

\renewcommand{\arraystretch}{1.3}

\setlength{\parindent}{0.3125in}
\setlength{\parskip}{2ex plus 0.2ex minus 0.2ex}

\setcounter{secnumdepth}{4}
\setcounter{tocdepth}{4}

\pagestyle{fancy}
%\pagestyle{empty}

\thispagestyle{empty}

\renewcommand{\theequation}{\arabic{equation}}
%\renewcommand{\thetable}{{\protect\bf\arabic{table}}}
%\renewcommand{\thefigure}{{\protect\bf\arabic{figure}}}
%\renewcommand{\thepage}{\roman{page}}

\setlongtables

\begin{document}

%begin title page
\noindent
{\large\sffamily LA-UR-06-7048}

\medskip

\noindent
\scriptsize
{\em Approved for public release;}\\
{\em distribution is unlimited.}

\normalsize

\bc
\begin{tabular}{r|l}
~ & ~\\
%{\em Title:} & {\sl Quick Reference Guide: PFLOTRAN 1.0 (LA-CC 06-093)}\\
{\em Title:} & {\sl Quick Reference Guide: PFLOTRAN 2.0 (LA-CC-09-047)}\\
~ & {\sl Multiphase-Multicomponent-Multiscale Massively Parallel} \\
~ & {\sl Reactive Transport Code}\\
~ & ~\\
~ & ~\\
{\em Author(s):} & SciDAC-2 Project (PI: Peter C. Lichtner, lichtner@lanl.gov)\\
~  & Glenn Hammond (glenn.hammond@pnnl.gov)\\
~ & ~\\
~ & ~\\
{\em Contacts:}  & Richard Mills (rmills@ornl.gov)\\
~ & Chuan Lu (Chuan.Lu@inl.gov)\\
%~ & %David Moulton (moulton@lanl.gov)\\
~ & Bobby Philip (bphilip@lanl.gov)\\
~ & Barry Smith (bsmith@anl.gov)\\
~ & \\%Albert Valocchi (clu@lanl.gov)\\
~ & ~\\
%{\em Submitted to:} & \\
~ & ~\\
{\em Date:} & \today \\
~ & ~\\
~ & ~\\
~ & {\bf \huge DRAFT}\\
~ & ~\\
\end{tabular}
\ec

\vfill

\noindent
{\Huge\sffamily Los Alamos}

\vspace{-8pt}

\noindent
{\sffamily NATIONAL LABORATORY}

\vspace{-6pt}

\noindent
\scriptsize
Los Alamos National Laboratory, an affirmative action/equal opportunity employer, is operated by the Los Alamos National Security, LLC
for the National Nuclear Security Administration of the U.S. Department of Energy under contract DE-AC52-06NA25396. By acceptance
of this article, the publisher recognizes that the U.S. Government retains a nonexclusive, royalty-free license to publish or reproduce the
published form of this contribution, or to allow others to do so, for U.S. Government purposes. Los Alamos National Laboratory requests
that the publisher identify this article as work performed under the auspices of the U.S. Department of Energy. Los Alamos National
Laboratory strongly supports academic freedom and a researcherï¿½s right to publish; as an institution, however, the Laboratory does not
endorse the viewpoint of a publication or guarantee its technical correctness.

\hfill Form 836 (7/06)

\normalsize

\clearpage

\tableofcontents
%\clearpage

%\listoffigures

%\listoftables

\clearpage

\section{Introduction}

PFLOTRAN solves a system of generally nonlinear partial differential equations describing multiphase, multicomponent and multiscale reactive flow and transport in porous materials. The code is designed to run on massively parallel computing architectures as well as workstations and labtops (Hammond et al., 2011). Parallelization is achieved through domain decomposition using the PETSc (Port\-a\-ble Extensible Toolkit for Scientific Computation) libraries for the parallelization framework  (Balay et al., 1997).

\section{Governing Equations}

\subsection{Mode: {\tt RICHARDS}}

{\tt RICHARDS} Mode applies to single phase, variably saturated, isothermal systems.
The governing mass conservation equation is given by
\EQ
\frac{\p}{\p t}\left(\varphi s\rho\right) + \bnabla\cdot\left(\rho\bq\right) = Q_w,
\EN
and
\EQ
\bq = -\frac{kk_r}{\mu}\bnabla\left(P-\rho g z\right).
\EN
Here, $\varphi$ denotes porosity, $s$ saturation, $\rho$ water density, $\bq$ Darcy flux, $k$ intrinsic permeability, $k_r$ relative permeability, $\mu$ viscosity, $P$ pressure, $g$ gravity, and $z$ the vertical component of the position vector.  Supported relative permeability functions $k_r$ for Richards' equation include van Genuchten, Books-Corey and Thomeer-Corey, while the saturation functions include Burdine and Mualem.  Water density and viscosity are computed as a function of temperature and pressure through an equation of state for water.

\subsection{Mode: {\tt MPHASE}}
Local equilibrium is assumed between phases for modeling multiphase systems with PFLOTRAN. The multiphase partial differential equations for mass and energy conservation solved by PFLOTRAN have the general form:
\begin{subequations}
\BA\label{mass_conservation_equation}
\frac{\p}{\p t} \bigg(\varphi \sum_\a s_\a^{}\rho_\a^{} X_i^\a \bigg)
+ \bnabla\cdot\sum_\a\bigg[\bq_\a^{}\rho_\a^{} X_i^\a 
 - \varphi s_\a^{} D_\a^{} \rho_\a^{} \bnabla X_i^\a \bigg] \eq Q_i,
\EA
for the $i$th component, and
\BA\label{energy_equation}
\frac{\p}{\p t} \bigg(\varphi \sum_\a s_\a\rho_\a U_\a + (1-\varphi) \rho_r c_r T\bigg)
+ \bnabla\cdot\sum_\a\bigg[\bq_\a\rho_\a H_\a - \kappa\bnabla T\bigg] \eq Q_e.
\EA
\end{subequations}
for energy. 
In these equations $\a$ designates a fluid phase (e.g. H$_\textrm{2}$O, supercritical CO$_\textrm{2}$) at temperature $T$ and pressure $P_\a$ with the sums over all fluid phases present in the system; 
species are designated by the subscript $i$ 
(e.g. $w\!=\!\textrm{H}_\textrm{2}\textrm{O}$, $c\!=\!$~CO$_\textrm{2}$); 
$\varphi$ denotes the porosity of the geologic formation; 
$s_\a$ denotes the phase saturation state; 
$X_i^\a$ denotes the mole fraction of species $i$ ($\sum_i X_i^\alpha=1$); 
$\rho_\a$, $H_\a$, $U_\a$ refer to the molar density, enthalpy, and internal energy of each fluid phase, respectively; and 
$\bq_\a$ denotes the Darcy flow rate defined by
\EQ
\bq_\a \eq -\frac{kk_\a}{\mu_\a} \bnabla \big(P_\a-W_\a^{}\rho_\a g \bz\big),
\EN
where $k$ refers to the intrinsic permeability, $k_\a$ denotes the relative permeability, $\mu_\a$ denotes the fluid viscosity, $W_\a^{}$ denotes the formula weight, $g$ denotes the acceleration of gravity, and $z$ designates the vertical of the position vector. The source/sink terms, $Q_i$ and $Q_e$, describe injection and extraction of mass and heat at wells, respectively. The quantities $\rho_r$, $c_r$, and $\kappa$ refer to the density, heat capacity, and thermal conductivity of the porous rock.

Additional constitutive relations are needed to account for capillary pressure, and changes in phase which are not discussed in detail here (see \cite{lichtner:pflotran07}).
In PFLOTRAN a variable switching approach is used to account for phase changes enforcing local equilibrium. According to the Gibbs phase rule there are a total of $N_C\!+\!1$ degrees of freedom where $N_C$ denotes the number of independent components. This can be seen by noting that the
intensive
degrees of freedom are equal to $N_{\rm int}\!=\!N_C \!-\! N_P \!+\!2$, where $N_P$ denotes the number of phases. The 
extensive
degrees of freedom equals $N_{\rm ext}\!=\!N_P\!-\!1.$ This gives a total number of degrees of freedom $N_{\rm dof}\!=\!N_{\rm int}\!+\!N_{\rm ext}\!=\!N_C\!+\!1$, independent of the number of phases $N_P$ in the system.

\subsection{Mode: {\tt IMMIS}}

The {\tt IMMIS} mode applies to multiple immiscible phases.

\subsection{Mode: {\tt Air-Water}}

The {\tt Air-Water} mode involves two phase liquid water-gas flow coupled to the reactive transport mode. Mass conservation equations have the form
\EQ
\frac{\p}{\p t} \varphi \Big(s_l^{} \rho_l^{} x_i^l + s_g^{} \rho_g^{} x_i^g \Big) + \bnabla\cdot\Big(\bq_l^{} \rho_l^{} x_i^l + \bq_g \rho_g^{} x_i^g -\varphi s_l^{} D_l^{} \rho_l^{} \bnabla x_i^l -\varphi s_g^{} D_g^{} \rho_g^{} \bnabla x_i^g \Big) \eq Q_i^{},
\EN
for liquid and gas saturation $s_{l,\,g}^{}$, density $\rho_{l,\,g}^{}$, diffusivity $D_{l,\,g}^{}$, Darcy velocity $\bq_{l,\,g}^{}$ and mole fraction $x_i^{l,\,g}$.
The energy conservation equation can be written in the form
\EQ
\sum_{\a=l,\,g}\left\{\frac{\p}{\p t} \big(\varphi s_\a \rho_\a U_\a\big) + \bnabla\cdot\big(\bq_\a \rho_\a H_\a\big) \right\} + \frac{\p}{\p t} \Big((1-\varphi)\rho_r C_p T \big) - \bnabla\cdot (\kappa\bnabla T)\Big) \eq Q,
\EN
as the sum of contributions from liquid and gas fluid phases and rock,
with internal energy $U_\a$ and enthalpy $H_\a$ of fluid phase $\a$, rock heat capacity $C_p$ and thermal conductivity $\kappa$. Note that
\EQ
U_\a \eq H_\a -\frac{P_\a}{\rho_\a}.
\EN



\subsection{Mode: {\tt THC} (Thermal-Hydrologic-Chemical)}

{\tt THC} Mode applies to single phase, variably saturated, nonisothermal systems
with incorporation of density variations coupled to fluid flow. The THC equations may be coupled to the reactive transport mode (see section \ref{sec:chem}).
The governing equations for mass and energy are given by
\EQ\label{masseqn}
\frac{\p}{\p t}\left(\varphi s\rho\right) + \bnabla\cdot\left(\rho\bq\right) = Q_w,
\EN
and
\EQ
\frac{\p}{\p t}\left(\varphi s\rho U + (1-\varphi) c_p T\right) + \bnabla\cdot\left(\rho\bq H -\kappa \bnabla T\right) = Q_e,
\EN
with the Darcy flow velocity $\bq$ given by
\EQ
\bq = -\frac{kk_r}{\mu}\bnabla\left(P-\rho g z\right).
\EN
Here, $\varphi$ denotes porosity, $s$ saturation, $\rho$ mixture density of the brine, $\bq$ Darcy flux, $k$ intrinsic permeability, $k_r$ relative permeability, $\mu$ viscosity, $P$ pressure, $g$ gravity, and $z$ the vertical component of the position vector.  Supported relative permeability functions $k_r$ for Richards' equation include van Genuchten, Books-Corey and Thomeer-Corey, while the saturation functions include Burdine and Mualem.  Water density and viscosity are computed as a function of temperature and pressure through an equation of state for water. The quantity $\kappa$ denotes the thermal conductivity of the porous medium-fluid system. The internal energy and enthalpy of the fluid, $U$ and $H$, are obtained from an equation of state for pure water. These two quantities are related by the thermodynamic expression
\EQ
U \eq H -\frac{P}{\rho}.
\EN
Nonreactive solute transport equations representing e.g. NaCl have the form
\EQ
\frac{\p}{\p t} \varphi s \rho x_i + \bnabla\cdot\Big(\bq \rho x_i -\varphi D \rho\bnabla x_i\Big) \eq Q_i,
\EN
with mole fraction $x_i$, source term $Q_i$, and diffusion/dispersion coefficient $D$. Summing this equation over all components $i$ using $\sum_ix_i=1$, leads to Eqn.\eqref{masseqn} with
\EQ
Q_w \eq \sum_i Q_i.
\EN
Additional constitutive relations are needed to close the set of governing equations.

\subsection{Mode: Reactive Transport (Keyword {\tt CHEMISTRY})}\label{sec:chem}

The governing mass conservation equations for the geochemical transport mode for a multiphase system written in terms of a set of independent aqueous primary or basis species with the form
\BA\label{rteqn}
\frac{\p}{\p t}\big(\varphi \sum_\a s_\a \Psi_j^\a\big) &+
\nabla\cdot\sum_\a\big(\bq_\a - \varphi s_\a \bD_\a\bnabla\big)\Psi_j^\a \nonumber\\
&\qquad\eq Q_j - \sum_m\nu_{jm} I_m -\frac{\p S_j}{\p t},
\EA
where the sums over $\a$ are over all fluid phases in the system, and where $\Psi_j^\a$ denotes the total concentration of the $j$th primary species $\A_j^{\rm pri}$ in the $\a$th fluid phase defined by
\EQ
\Psi_j^\a = \delta_{l\a}^{} C_j^l + \sum_{i=1}^{N_{\rm sec}}\nu_{ji}^{\a} C_i^\a.
\EN
In this equation the subscript $l$ represents the aqueous electrolyte phase from which the primary species are chosen. The secondary species concentrations $C_i^\a$ are obtained from mass action equations corresponding to equilibrium conditions of the reactions
\EQ
\sum_j\nu_{ji}^\a\A_j^l \arrows \A_i^\a,
\EN
yielding
\EQ
C_i^\a \eq \frac{K_i^\a}{\gamma_i^\a} \prod_j \Big(\gamma_j^l C_j^l\Big)^{\nu_{ji}^\a},
\EN
with equilibrium constant $K_i^\a$, and activity coefficients $\gamma_k^\a$.

The quantity $Q_j$ denotes a source/sink term and $S_j$ represents the sorbed concentration of the $j$th primary species. Diffusion is assumed to be species independent, but may be different for different phases, e.g. an aqueous electrolyte solution or gas phase. Dispersivity currently must be described through a diagonal dispersion tensor. The Darcy velocity $\bq_\a$ for phase $\a$ is given by
\EQ
\bq_a \eq -\frac{kk_\a}{\mu_\a} \bnabla \big(p_\a -\rho_\a g z\big),
\EN
with bulk permeability of the porous medium $k$ and relative permeability $k_\a$, fluid viscosity $\mu_\a$, pressure $p_\a$, density $\rho_\a$, and acceleration of gravity $g$.

\subsubsection{Sorption}

Sorption reactions incorporated into PFLOTRAN consist of ion exchange and surface complexation reactions for both equilibrium and multirate formulations.

\paragraph{Ion Exchange}

Ion exchange reactions may be represented either in terms of bulk- or mineral-specific rock properties.  Changes in bulk sorption properties can be expected as a result of mineral reactions.  However, only the mineral-based formulation enables these effects to be captured in the model.  The bulk rock sorption site concentration $\omega_\a$, in units of moles of sites per bulk sediment volume (mol/dm$^3$), is related to the bulk cation exchange capacity $Q_\a$ (mol/kg) by the expression
\EQ
\omega_\a \eq \frac{N_{\rm site}}{V} \eq \frac{N_{\rm site}}{M_s} \frac{M_s}{V_s} \frac{V_s}{V} \eq Q_\a \rho_s (1-\phi).
\EN
The cation exchange capacity associated with the $m$th mineral is defined on a molar basis as
\EQ
\omega_m^{\rm CEC} \eq \frac{N_m}{V} \eq \frac{N_m}{M_m} \frac{M_m}{V_m} \frac{V_m}{V} \eq Q_m^{\rm CEC} \rho_m \phi_m.
\EN

Ion exchange reactions are expressed in the form
\EQ\label{ex1}
z_i \A_j + z_j X_{z_i}^\a\A_i \arrows z_j \A_i + z_i X_{z_j}^\a\A_j,
\EN
with valencies $z_j$, $z_i$ of cations $\A_j$ and $\A_i$, respectively. The reference cation is denoted by the subscript $j$ and the subscript $i\!\ne\! j$ represents all other cations. 
The corresponding mass action equation is given by
\EQ\label{ionexmassact}
K_{ji}^\a \eq \frac{(k_j^\a)^{z_i}}{(k_i^\a)^{z_j}} \eq \left(\frac{X_j^\a}{a_j}\right)^{z_i} \left(\frac{a_i}{X_i^\a}\right)^{z_j}.
\EN
Using the Gaines-Thomas convention, the equivalent fractions $X_k^\a$ are defined by
\EQ
X_k^\a = \frac{z_k S_k^\a}{\displaystyle\sum_l z_l S_l^\a} = \frac{z_k}{\omega_\a}S_k^\a,
\EN
with 
\EQ
\sum_k X_k^\a = 1.
\EN
The site concentration $\omega_\a$ is defined by
\EQ
\omega_\a = \sum_k z_k S_k^\a,
\EN
where $\omega_\a$ is related to the cation exchange capacity $Q_\a$ (CEC) by the expression
\EQ
\omega_\a = (1-\varphi) \rho_s \, Q_\a,
\EN
with solid density $\rho_s$ and porosity $\varphi$. 

For equivalent exchange $(z_j\!=\!z_i\!=\!z)$, an explicit expression exists for the sorbed concentrations given by
\EQ
S_j^\a \eq \frac{\omega_\a}{z} \frac{k_j^\a \gamma_j m_j^{}}{\displaystyle\sum_l k_l^\a \gamma_l m_l^{}},
\EN
where $m_k$ denotes the $k$th cation molality. This expression follows directly from the mass action equations and conservation of exchange sites.

In the more general case $(z_i\ne z_j)$ it is necessary to solve the nonlinear equation
\EQ
X_j^\a + \sum_{i\ne j} X_i^\a \eq 1,
\EN
for the reference cation mole fraction $X_j$. 
From the mass action equation Eqn.\eqref{ionexmassact}
it follows that
\EQ
X_i^\a\eq k_i^\a a_i\left(\frac{X_j^\a}{k_j^\a a_j}\right)^{z_i/z_j}.
\EN
Defining the function
\EQ
f(X_j^\a) \eq X_j^\a + \sum_{i\ne j}X_i^\a(X_j^\a)-1,
\EN
its derivative is given by
\EQ
\frac{df}{dX_j^\a} \eq 1 - \frac{1}{z_jX_j^\a}\sum_{i\ne j} z_i k_i^\a a_i \left(\frac{X_j^\a}{k_j^\a a_j}\right)^{z_i/z_j}.
\EN
The reference mole fraction is then obtained by Newton-Raphson iteration
\EQ
(X_j^\a)^{k+1} \eq (X_j^\a)^k -\dfrac{f[(X_j^\a)^k]}{\dfrac{df[(X_j^\a)^k]}{dX_j^\a}}.
\EN

The sorbed concentration for the $j$th cation appearing in the accumulation term is given by
\EQ
S_j^\a \eq \frac{\omega_\a}{z_j} X_j^\a,
\EN
with the derivatives for $j\ne l$
\begin{subequations}
\BA
\dfrac{\p S_j^\a}{\p m_l} &\eq -\frac{\omega_\a}{m_l} \dfrac{X_j^\a X_l^\a}{\displaystyle\sum_l z_l X_l^\a},\\
&\eq -\frac{1}{m_l} \dfrac{z_jz_lS_j^\a S_l^\a}{\displaystyle\sum_l z_l^2 S_l^\a},
\EA
\end{subequations}
and for $j=l$
\begin{subequations}
\BA
\dfrac{\p S_j^\a}{\p m_j} &\eq \frac{\omega_\a X_j^\a}{z_j m_j} \left(1-\dfrac{z_j X_j^\a}{\displaystyle\sum_{l} z_{l} X_{l}^\a}\right),\\
&\eq \frac{S_j^\a}{m_j} \left(1-\dfrac{z_j^2 S_j^\a}{\displaystyle\sum_{l} z_{l}^2 S_{l}^\a}\right).
\EA
\end{subequations}

\paragraph{Surface Complexation}

Surface complexation reactions are assumed to have the form
\EQ\label{srfrxn}
\nu_\a >\!\!\chi_\a + \sum_j\nu_{ji} \A_j \arrows \!>\!\! \S_{i\a},
\EN
for the $i$th surface complex $>\!\!\S_{i\a}$ on site $\a$ and empty site $>\!\!\chi_\a$.
As follows from the corresponding mass action equation the equilibrium sorption concentration $S_{i\a}^{\rm eq}$ is given by
\EQ
S_{i\a}^{\rm eq}\eq \frac{\omega_\a K_i Q_i}{1+\sum_l K_lQ_l},
\EN
and the empty site concentration by
\EQ
S_\a^{\rm eq}\eq\frac{\omega_\a}{1+\sum_l K_lQ_l},
\EN
where the ion activity product $Q_i$ is defined by
\EQ
Q_i\eq\prod_j\big(\gamma_jC_j\big)^{\nu_{ji}}.
\EN
The site concentration $\omega_\a$ satisfies the relation
\EQ\label{totsite}
\omega_\a \eq S_\a + \sum_i S_{i\a}.
\EN
and is constant.
The equilibrium sorbed concentration $S_{j\a}^{\rm eq}$ is defined as
\EQ\label{qeq}
S_{j\a}^{\rm eq} \eq \sum_i \nu_{ji}^{} S_{i\a}^{\rm eq}\eq \frac{\omega_\a}{1+\sum_l K_lQ_l} \sum_i \nu_{ji}K_i Q_i.
\EN

\paragraph{Multirate Sorption}

In the multirate model the rates of sorption reactions are described through a kinetic relation given by
\EQ\label{sorbed}
\frac{\p S_{i\a}}{\p t} \eq k_\a^{} \big(S_{i\a}^{\rm eq}-S_{i\a}\big),
\EN
for surface complexes, and
\BA\label{fsite}
\frac{\p S_{\a}}{\p t} &\eq -\sum_i k_\a^{} \big(S_{i\a}^{\rm eq}-S_{i\a}\big),\\
&\eq k_\a\big(S_\a^{\rm eq}-S_{\a}\big),
\EA
for empty sites, where $S_\a^{\rm eq}$ denotes the equilibrium sorbed concentration. For simplicity, in what follows it is assumed that $\nu_\a\!=\!1$. 
With each site $\a$ is associated a rate constant $k_\a$ and site concentration $\omega_\a$. These quantities are defined through a given distribution of sites $\wp(\a)$, such that
\EQ
\int_0^\infty \wp(k_\a)dk_\a \eq 1.
\EN
The fraction of sites $f_\a$ belonging to site $\a$ is determined from the relation
\EQ
f_\a \eq \int_{k_\a-\Delta k_\a/2}^{k_\a+\Delta k_\a/2} \wp(k_\a)dk_\a \simeq \wp(k_\a)\Delta k_\a,
\EN
with the property that
\EQ
\sum_\a f_\a =1.
\EN
Given that the total site concentration is $\omega$, then the site concentration $\omega_\a$ associated with site $\a$ is equal to
\EQ
\omega_\a \eq f_\a \omega.
\EN

An alternative form of these equations is obtained by introducing the total sorbed concentration for the $j$th primary species for each site defined as
\EQ
S_{j\a}\eq\sum_i \nu_{ji}S_{i\a}.
\EN
Then the transport equations become
\EQ
\frac{\p}{\p t}\left(\varphi \Psi_j + \sum_{\a}S_{j\a}\right) + \bnabla\cdot\bOmega_j \eq  - \sum_m\nu_{jm}I_m.
\EN
The total sorbed concentrations are obtained from the equations
\EQ
\frac{\p S_{j\a}}{\p t} \eq k_\a^{} \big(S_{j\a}^{\rm eq}-S_{j\a}\big).
\EN

\subsubsection{Colloid-Facilitated Transport}

Colloid-facilitated transport is implemented into PFLOTRAN based on surface complexation reactions. Competition between mobile and immobile colloids and stationary mineral surfaces is taken into account. Colloid filtration processes are not currently implemented into PFLOTRAN. 
A colloid is treated as a solid particle suspended in solution or attached to a mineral surface. Colloids may be generated through nucleation of minerals in solution, although this effect is not included currently in the code.

Three separate reactions may take place involving competition between mobile and immobile colloids and mineral surfaces
\BA
>\!X_k^\m + \sum_j\nu_{jk}\A_j &\arrows >\!S_k^\m,\\
>\!X_k^\im + \sum_j\nu_{jk}\A_j &\arrows >\!S_k^\im,\\
>\!X_k^s + \sum_j\nu_{jk}\A_j &\arrows >\!S_k^s,
\EA
with corresponding reaction rates $I_k^\m$, $I_k^\im$, and $I_k^s$, where the superscripts $s$, $m$, and $im$ denote mineral surfaces, and mobile and immobile colloids, respectively. In addition, reaction with minerals $\M_s$ may occur according to the reaction
\EQ
\sum_j\nu_{js}\A_j \arrows \M_s.
\EN
The transport equations for primary species, mobile and immobile colloids, read
\BA
\frac{\p}{\p t} \varphi s_l \Psi_j^l + \bnabla\cdot\bOmega_j^l &\eq -\sum_k\nu_{jk}\big(I_k^\m + I_k^\im + I_k^s\big) - \sum_s \nu_{js} I_s,\\
\frac{\p}{\p t} S_k^\m + \bnabla\cdot\bq_c S_k^\m & \eq I_k^\m,\\
\frac{\p}{\p t} S_k^\im & \eq I_k^\im,\\
\frac{\p}{\p t} S_k^s & \eq I_k^s,
\EA
where $\bq_c$ denotes the colloid Darcy velocity which may be greater than the fluid velocity $\bq$.
For conditions of local equilibrium the sorption reaction rates may be eliminated and replaced by algebraic sorption isotherms to yield
\EQ
\frac{\p}{\p t} \varphi s_l \Big[\Psi_j^l + \sum_k \nu_{jk} \big(S_k^\m + S_k^\im + S_k^s\big) \Big] + \bnabla\cdot\Big(\bOmega_j^l + \bq_c \sum_k \nu_{jk} S_k^\m\Big) \eq - \sum_s \nu_{js} I_s.
\EN

\subsection{Solute Age}

PFLOTRAN implements the Eulerian formulation of solute age for a nonreactive tracer following Goode (1996). PFLOTRAN solves the advection-diffusion/dispersion equation for age given by
\EQ
\frac{\p}{\p t} \varphi s AC + \bnabla\cdot\Big(\bq AC - \varphi s D \bnabla (AC)\Big) \eq \varphi s C,
\EN
where $A$ denotes the mean age of the solute with concentration $C$. Other quantities appearing in the age equation are identical to the solute transport equation for a partially saturated porous medium with saturation state $s$. The age and solute transport equations are solved simultaneously.

\section{Method of Solution}

The flow and heat equations (Modes: RICHARDS, MPHASE, FLASH2, THC, and 2PH) are solved using a fully implicit backward Euler approach based on Newton-Krylov iteration.
Both fully implicit backward Euler and operator splitting solution methods are supported for reactive transport.

\subsection{Fully Implicit}

In a fully implicit formulation the nonlinear equations for the residual function $\bR$ given by
\EQ
\bR(\bx) \eq \bzero,
\EN
are solved using an iterative solver based on the Newton-Raphson equations
\EQ
\bJ^{(i)} \delta\!\bx^{(i+1)} \eq -\bR^{(i)},
\EN
at the $i$th iteration. Iteration stops when
\EQ
\left|\bR^{(i+1)}\right| < \epsilon,
\EN
or if
\EQ
\big|\delta\!\bx^{(i+1)}\big| < \delta.
\EN
However, the latter criteria does not necessarily guarantee that the residual equations are satisfied.
The solution is updated from the relation
\EQ
\bx^{(i+1)} \eq \bx^{(i)} + \delta\!\bx^{(i+1)}.
\EN
For the logarithm of the concentration with $\bx=\ln\by$,
the solution is updated according to the equation
\EQ
\by^{(i+1)} \eq \by^{(i)} {\rm e}^{\delta\!\ln\by^{(i+1)}}.
\EN


\subsection{Operator Splitting}

Operator splitting involves splitting the reactive transport equations into a nonreactive part and a part incorporating reactions. This is accomplished by writing Eqns.\eqref{rteqn} as the two coupled equations
\EQ
\frac{\p}{\p t}\big(\varphi \sum_\a s_\a \Psi_j^\a\big) +
\nabla\cdot\sum_\a\big(\bq_\a - \varphi s_\a \bD_\a\bnabla\big)\Psi_j^\a \eq Q_j,
\EN
and
\EQ
\frac{d}{d t}\big(\varphi \sum_\a s_\a \Psi_j^\a\big) \eq - \sum_m\nu_{jm} I_m -\frac{\p S_j}{\p t},
\EN
The first set of equations are linear in $\Psi_j$ (for species-independent diffusion coeffients) and solved over over a time step $\Delta t$ resulting in $\Psi_j^*$. The result for $\Psi_j^*$ is inverted to give the concentrations $C_j^*$ by solving the equations
\EQ
\Psi_j^* \eq C_j^* + \sum_i \nu_{ji} C_i^*,
\EN
where the secondary species concentrations $C_i^*$ are nonlinear functions of the primary species concentrations $C_j^*$. With this result the second set of equations are solved implicitly for $C_j$ at $t+\Delta t$ using $\Psi_j^*$ for the starting value at time $t$.

As a simple example of operator splitting consider a single component system with retardation described by a constant $K_d$. According to this model the sorbed concentration $S$ is related to the aqueous concentration by the linear equation
\EQ\label{skd}
S \eq K_d C.
\EN
The governing equation is given by
\EQ
\frac{\p}{\p t} \varphi C + \bnabla\cdot\big(\bq C -\varphi D \bnabla C\big) \eq -\frac{\p S}{\p t}.
\EN
If $C(x,\,t;\, \bq,\,D)$ is the solution to the case with no retardation (i.e. $K_d=0$), then $C(x,\,t;\, \bq/R,\,D/R)$ is the solution with retardation $(K_d>0)$,
with
\EQ
R = 1+\frac{1}{\varphi}K_d.
\EN
Thus propagation of a front is retarded by the retardation factor $R$.

In operator splitting form this equation becomes
\EQ
\frac{\p}{\p t} \varphi C + \bnabla\cdot\big(\bq C -\varphi D \bnabla C\big) \eq 0,
\EN
and
\EQ
\frac{d}{d t} \varphi C \eq -\frac{d S}{d t}.
\EN
The solution to the latter equation is given by
\EQ
\varphi C^{t+\Delta t} - \varphi C^* \eq -\big(S^{t+\Delta t} - S^t\big),
\EN
where $C^*$ is the solution to the nonreactive transport equation. Using Eqn.\eqref{skd}, this result can be written as
\EQ
C^{t+\Delta t} \eq \frac{1}{R} C^* + \left(1-\frac{1}{R}\right) C^t.
\EN
Thus for $R=1$, $C^{t+\Delta t}=C^*$ and the solution advances unretarded.

\newpage

\section{Installation}

\subsection{MacOSX}

This installation requires compiler versions 4.4.2 for gfortran, gcc, and g++. The compiler g++ is needed for installing SAMRAI.
Define environment variables: {\tt MPI\_HOME}, {\tt PKGS}, \linebreak {\tt HYPRE\_INSTALL\_DIR}

\subsubsection{OpenMPI}

\begin{verbatim}
setenv F90 gfortran
setenv F77 gfortran
setenv FC gfortran
setenv CC gcc-4
setenv CXX g++-4

./configure \
--prefix=$PKGS/openmpi/openmpi-1.4.1-gcc-4.4.2-gfortran \
--disable-debug \
--enable-static \
--disable-shared

make
make install
\end{verbatim}

\subsubsection{Hypre}

\begin{verbatim}
./configure \
--with-MPI \
--enable-debug \
--disable-opt \
--prefix=${HYPRE_INSTALL_DIR} \
--with-MPI-include=${MPI_HOME}/include \
--with-MPI-libs=openmpi \
--with-MPI-lib-dirs=${MPI_HOME}/lib \
CC=mpicc \
CXX=mpicxx \
F77=mpif90

make
make install
\end{verbatim}

\subsubsection{PETSc}

The PETSc {\tt ./configure} script can be used not only to install PETSc but also HDF5, Parmetis, and various direct solvers such as Mumps and Trilinos solvers. To use PETSc with PFLOTRAN the PETSc developer version petsc-dev is necessary which can be downloaded from the PETSc web page (http://www.mcs.anl.gov/petsc/petsc-as/developers/index.html). The recommended way to do this is to use the version control program Mercurial \linebreak (http://mercurial.selenic.com/wiki).

Define environment variables: $\verb|PETSC_DIR|$ and $\verb|PETSC_ARCH|$ giving the location of the petsc-dev source and the architecture.

\paragraph{MacOSX 10.6.6 (SnowLeopard)}

\begin{verbatim}
./config/configure.py \
--with-mpi-dir=$MPI_HOME \
--download-openmpi=1 \
--with-debugging=0 \
--with-shared-libraries=0 \
--download-mumps=1 \
--download-parmetis=1 \
--download-scalapack=1 \
--download-blacs=1 \
--download-ml=1 \
--download-hdf5=1 

make all
make test
\end{verbatim}

\paragraph{MacOSX 10.6.4 (Snow Leopard)}

\begin{enumerate}
\item Obtain C compiler gcc4.5 or later for snow leopard (e.g. from http://hpc.sourceforge.net). 
%They just had gcc4.6 available recently. 
Install gcc under \verb|/opt/local| or \verb|/usr/local|. 
You don't have to get gcc4.5 or 4.6,
but you have to have a verison not older than gcc4.3 for some features in
pflotran. Both gcc4.5 and gcc4.6 come with gfortran.

\item Install openmpi 1.5.1 from www.open-mpi.org. Configure using the command:

\begin{verbatim}
./configure CC=gcc CXX=g++ FC=gfortran --enable-mpi-f77=no 
--prefix=/opt/local
\end{verbatim}

\item Download petsc-dev and configure using

\begin{verbatim}
./configure --download-hdf5=1 --with-cc=mpicc --with-cxx=mpicxx 
--with-fc=mpif90,
\end{verbatim}

then compile with \verb|make all|.

\item Compile pflotran using

\verb|make pflotran|
\end{enumerate}

\subsubsection{ORNL's Jaguar XT4/5}

\footnotesize
\begin{verbatim}
./config/configure.py PETSC_ARCH=cray-xt4-pgi_fast \
--configModules=PETSc.Configure \
--optionsModule=PETSc.compilerOptions \
--known-level1-dcache-size=65536 \
--known-level1-dcache-linesize=64 \
--known-level1-dcache-assoc=2 \
--known-memcmp-ok=1 \
--known-sizeof-char=1 \
--known-sizeof-void-p=8 \
--known-sizeof-short=2 \
--known-sizeof-int=4
--known-sizeof-long=8 \
--known-sizeof-long-long=8 \
--known-sizeof-float=4 \
--known-sizeof-double=8 \
--known-sizeof-size_t=8 \
--known-bits-per-byte=8 \
--known-sizeof-MPI_Comm=4 \
--known-sizeof-MPI_Fint=4 \
--known-mpi-long-double=0 \
--with-batch=1 \
--with-shared-libraries=0 \
--with-dynamic=0 \
--with-cc=cc \
--with-cxx=CC \
--with-fc=ftn \
--COPTFLAGS="-tp barcelona-64 -fastsse -Mipa=fast" \
--CXXOPTFLAGS="-tp barcelona-64 -fastsse -Mipa=fast" \
--FOPTFLAGS="-tp barcelona-64 -fastsse" \
--with-debugging=0 \
--with-blas-lib=sci \
--with-lapack-lib=sci \
--with-x=0 \
--with-mpi-dir=$MPICH_DIR \
--download-hypre=1 \
--download-parmetis=1 \
--with-hdf5=1 \
--with-hdf5-dir=$HDF5_DIR \
--known-mpi-shared=0
\end{verbatim}
\normalsize
The user will need to load the following HDF5 module beforehand: \ \verb|module load hdf5-parallel|.

\subsection{Building PFLOTRAN}

The source code for PFLOTRAN can be downloaded from the LANL web site using Mercurial: \verb|hg clone https://software.lanl.gov/pflotran/hg/pflotran|. PFLOTRAN is compiled with the command:

\verb|make [chuan_co2=1 coll=1 temp=1 dasvyat=1] pflotran|

\noindent
Options [] are: 

\begin{tabular}{ll}
\verb|chuan_co2|: & --enable two-phase supercritical CO$_2$ mode\\
%\verb|hdf5|: & --enable HDF5 I/O capability\\
\verb|coll|: & --enable colloid-facilitated transport option\\
\verb|temp|: & --enable temperature dependent log $K$ capability\\
\verb|dasvyat|: & --enable MFD full permeability tensor capability
\end{tabular}

\subsection{Running PFLOTRAN}

PFLOTRAN can be run from the command line as

\verb|mpirun -np 10 pflotran [options]|

A number of command line options are available:

\begin{tabular}{ll}
{\tt -pflotranin} <input file name> & specify an input file [Default: {\tt pflotran.in}]\\
{\tt -screen\_output off} & turn off screen output\\
{\tt -file\_output} <output file name> & specify an input file [Default: {\tt pflotran.out}]\\
%{\tt -v} &\\
{\tt -multisimulation} & run multiple input files in one run\\
{\tt -stochastic} & Monte Carlo multiple realization run\\
{\tt -log\_summary} & print out run performance (PETSc option)
\end{tabular}

\subsection{Building SAMRAI Version 2.4.4}

\noindent
To build SAMRAI follow the instructions listed below.

{\tt mkdir SAMRAI-v2.4.4}

{\tt cd SAMRAI-v2.4.4}

{\tt hg clone http://software.lanl.gov/pflotran/hg/samrai SAMRAI}

{\tt mkdir samrai-objs in directory SAMRAI-v2.4.4}

{\tt cd samrai-objs}

Define the environment variables $\verb|SAMRAI_INSTALL_DIR|$, $\verb|MPI_HOME|$, $\verb|HDF5_HOME|$, \linebreak $\verb|PETSC_DIR|$ to be the top level directories of the appropriate packages

\noindent
With MPICH:
\begin{verbatim}
../SAMRAI/configure --prefix=${SAMRAI_INSTALL_DIR} \
--with-CC=mpicc \
--with-CXX=mpicxx \
--with-F77=mpif90 \
--with-mpi \
--with-mpi-include=${MPI_HOME}/include \
--with-mpi-lib-dirs=${MPI_HOME}/lib \
--with-MPICC=mpicc \
--with-x \
--with-hdf5=${HDF5_HOME} \
--with-hypre=${HYPRE_HOME} \
--with-petsc=${PETSC_DIR} \
--with-blaslapack \
--enable-opt \
 --enable-debug \
--enable-char \
--enable-bool \
CXXFLAGS="-DMPICH_IGNORE_CXX_SEEK -DMPICH_SKIP_MPICXX" \
CPPFLAGS="-DMPICH_IGNORE_CXX_SEEK -DMPICH_SKIP_MPICXX"
\end{verbatim}

\noindent
With OPENMPI:
\begin{verbatim}
../${SAMRAI_SRC_DIR}/configure \
--prefix=${SAMRAI_INSTALL_DIR} \
--with-CC=mpicc \
--with-CXX=mpicxx \
--with-F77=mpif90 \
--with-mpi \
--with-mpi-include=${MPI_HOME}/include 
--with-mpi-lib-dirs=${MPI_HOME}/lib 
--with-MPICC=mpicc \
--with-x \
--with-hdf5=${HDF5_INSTALL_DIR} \
--with-hypre=${HYPRE_INSTALL_DIR} \
--with-petsc=${PETSC_DIR} \
--with-blaslapack \
--disable-opt \
--enable-debug \
--enable-char \
--enable-bool \
CXXFLAGS="-DOMPI_IGNORE_CXX_SEEK -DOMPI_SKIP_MPICXX \
  -I${PETSC_DIR}/${PETSC_ARCH}/include -I${PETSC_DIR}/include" \
CPPFLAGS="-DOMPI_IGNORE_CXX_SEEK -DOMPI_SKIP_MPICXX"
\end{verbatim}

{\tt make}

{\tt make install}

Define the environment variable $\verb|SAMRAI|$ to point to $\verb|SAMRAI_INSTALL_DIR|$ (for example in your .cshrc)

Instructions for SAMR utils package

{\tt hg clone  http://software.lanl.gov/pflotran/hg/samrutils}

{\tt cd samrutils}

Define the environment variable $\verb|AMRUTILITIES_HOME|$ to be the directory where you want the libraries and headers installed, it can point to the top level src dir if you like.

\verb|make prefix=${AMRUTILITIES_HOME} lib3d|

Instructions for SAMR solvers package

{\tt hg clone  http://software.lanl.gov/pflotran/hg/samrsolvers}

{\tt cd samrsolvers}

Define the environment variable $\verb|SAMRSOLVERS_HOME|$ to be the directory where you want the libraries and headers installed, it can point to the top level src dir if you like.

\verb|make prefix=${SAMRSOLVERS_HOME} lib3d|

\noindent
Assumptions:
\begin{enumerate}
\item External packages needed by PFLOTRAN are built: petsc-dev, hypre,  
hdf5, \linebreak mpich2/openmpi/some mpi
\item External packages needed by PFLOTRAN AMR interface are built:  
SAMRAI, SAMRUtils, SAMRSolvers
\end{enumerate}

\noindent
Define the environment variables:
\begin{center}
\begin{tabularx}{\linewidth}{lX}
\bf SAMRAI &--points to where SAMRAI is installed\\
\bf AMRUTILITIES\_HOME &--points to where SAMRUtils is installed\\
\bf SAMRSOLVERS\_HOME &--points to where SAMRSolvers is installed
\end{tabularx}
\end{center}

\noindent
Instructions for building $\verb|SAMRAIDriver|$:
\begin{center}
\begin{verbatim}
cd pflotran/src/pflotran
make samr_hdf5=1 pflotranamr

cd samr/src
make
\end{verbatim}
\end{center}

\noindent
At this point there should exist an executable named SAMRAIDriver.

\subsubsection{Running PFLOTRAN/SAMRAI on Jaguar}

Add to the {\tt .tcshrc} (or equivalent) file:
\begin{verbatim}
umask 0002
set LD_LIBRARY_PATH=/usr/lib64:${LD_LIBRARY_PATH}
setenv ARCH cray-xt5
setenv COMPILER gcc-4.4.2
setenv OPT opt
#setenv OPT debug 
setenv PROJ_DIR /tmp/proj/csc025/csc025geo3
setenv PKGS ${PROJ_DIR}/packages
setenv PKG_POSTFIX ${ARCH}-${COMPILER}-${OPT}
setenv PETSC_ARCH ${PKG_POSTFIX} 
setenv PETSC_VERSION petsc-dev
setenv PETSC_DIR ${PKGS}/petsc/${PETSC_VERSION}-${OPT}
setenv SAMRAI ${PKGS}/samrai/SAMRAI-v2.4.4/${PETSC_VERSION}-${PKG_POSTFIX}
setenv AMRUTILITIES_HOME ${PKGS}/samrutils/${PKG_POSTFIX}
setenv SAMRSOLVERS_HOME ${PKGS}/samrsolvers/${PKG_POSTFIX}
setenv PCH ${SAMRSOLVERS_HOME} 
 
setenv MPICH_UNEX_BUFFER_SIZE 400M
setenv MPICH_PTL_OTHER_EVENTS 4096
setenv MPICH_PTL_SEND_CREDITS -1
setenv MPICH_MSGS_PER_PROC 60000
\end{verbatim}

\noindent
Load the following modules:
\begin{verbatim}
module swap PrgEnv-pgi PrgEnv-gnu
 
module load mercurial
module load hdf5-parallel/1.8.3.1
module load hypre/2.4.0b
module load szip/2.1
module load totalview/8.6.0-1
\end{verbatim}

%########################################################################

\noindent
The user will need to set: PETSC\_DIR, PETSC\_ARCH, AMRUTILITIES\_HOME, SAMRSOLVERS\_HOME
to be defined as above. Also, note the swap to gnu.
\begin{verbatim}
 
cd pflotran
hg pull -u

cd src/pflotran
make hdf5=1 jaguar=1 pflotranamr

cd samr/src
make hdf5=1 jaguar=1
\end{verbatim}
At this point you should have an executable \verb|SAMRAIDriver|.
 
%\noindent
%To run the code do:

%\noindent
%\verb|cd nmg.4320|\\
%\verb|qsub run.4320|
 
%\noindent
%This should run the coupled flow (richards) and transport (15 species).

\begin{comment}
The following instructions should aid in installing openmpi, PETSc, HDF5 and PFLOTRAN on a UNIX or Mac computer running MacOSX 10.4 or later.

\subsection{Openmpi}

Set environment variables \verb|PKGS| and \verb|MPI_HOME| and the appropriate \verb|PATH|:

\verb|setenv PKGS /Users/lichtner/petsc/packages|

\verb|setenv MPI_HOME $PKGS/openmpi/openmpi-1.2.5-gcc-4.0.1-absoft-10.1|

\verb|setenv PATH \$PKGS/openmpi/openmpi-1.2.5-gcc-4.0.1-absoft-10.1:\$PATH|

\verb|setenv F90 f90|

\verb|setenv F77 'f90 -YEXT_NAMES=LCS -YEXT_SFX= -f'|

\verb|setenv FC 'f90 -YEXT_NAMES=LCS -YEXT_SFX= -f'|

\verb|setenv CC gcc|

\noindent
Configure using:

\verb|./configure --prefix=$PKGS/openmpi/openmpi-1.2.6-gcc-4.0.1-absoft-10.1|

\noindent
Finally, compile, check installation and install:

\verb|make|

\verb|make check|

\verb|make install|

\subsection{PETSc}

PFLOTRAN uses the Developer version of PETSc. To install PETSc first set the enviroment variables \verb|PETSC_DIR| and \verb|PETSC_ARCH|:

\verb|setenv PETSC_DIR /Users/lichtner/petsc/petsc-dev|

\verb|setenv PETSC_ARCH Intel_MacOSX10.5|

\noindent
Configure PETSc on a Mac using openmpi and Fortran 90 Absoft 10.1:
\begin{verbatim}
./config/configure.py
--with-blas-lapack-lib="-framework vecLib"
--with-mpi-dir=$PKGS/openmpi/openmpi-1.2.6-gcc-4.0.1-absoft-10.1
--with-debugging=0
--with-shared=0
\end{verbatim}

\noindent
Compile and test the PESTc installation with:

\verb|make all test|

\noindent
Optionally install PETSc:

\verb|make install|


\subsection{HDF5}

To install HDF5 set the following environment variables:

\verb|setenv HDF5_INCLUDE $PKGS/hdf/hdf5-1.6.7-gcc-4.0.1-absoft-10.1/include|

\verb|setenv HDF5_LIB $PKGS/hdf/hdf5-1.6.7-gcc-4.0.1-absoft-10.1/lib|

\verb|setenv CC $MPI_HOME/bin/mpicc|

\verb|setenv F9X $MPI_HOME/bin/mpif90|

\verb|setenv CFLAGS -fno-strict-aliasing|

\verb|setenv FFLAGS ""|

\begin{verbatim}
./configure --enable-fortran
--prefix=$PKGS/hdf/hdf5-1.6.7-gcc-4.0.1-absoft-10.1
--disable-debug --enable-production --enable-parallel
--enable-static --disable-shared
\end{verbatim}

\verb|make|

\verb|make check|

\verb|make install|

\subsection{PFLOTRAN}

Compile PFLOTRAN using the command

\verb|make [hdf5=1] pflotran|

\noindent
Create input file \verb|pflotran.in| and run PFLOTRAN with the command:

\verb|mpirun -np #proc pflotran|

\noindent
where \verb|#proc| is the desired number of processor cores.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Direct Solvers}

To implement direct solvers in PETSc with PFLOTRAN first recompile PETSc with the options (petsc-dev, MacOSX 10.5):

\begin{verbatim}
./config/configure.py --with-blas-lapack-lib="-framework vecLib"
--with-mpi-dir=\$PKGS/openmpi/openmpi-1.2.7-gcc-4.0.1-absoft-10.1
--with-debugging=0 --with-shared=0
--download-mumps=1
--download-parmetis=1 --with-parmetis
--download-scalapack=1 --with-scalapack
--download-blacs=1 --with-blacs
\end{verbatim}

\noindent
Then run PFLOTRAN with the command-line options:
\begin{verbatim}
-flow\_mat\_type mpiaij
-flow\_ksp\_type preonly
-flow\_pc\_type lu
-flow\_pc\_factor\_mat\_solver\_package mumps
\end{verbatim}

\subsection{Trilinos}

The Trilinos package for multi-level solvers (ML) may be used with PETSc by configuring petsc-dev with the flag

\begin{verbatim}
./config/configure.py ... --download-ml
\end{verbatim}

When running PFLOTRAN add \verb|-flow_pc_type ml| and/or \verb|-trans_pc_type ml|.
ML options are given in the manual page for PCML (not tested).

\subsection{Condition Number of the Preconditioned Jacobian Matrix}

Since the preconditioned matrix is not explicitly computed, it is necessary to estimate the condition number of the preconditioned Jacobian matrix using PETSc during a PFLOTRAN run. To do this specify a KSP type of GMRES (the Hessenberg matrix is needed that is constructed as part of the Arnoldi process), and then specify

 {\tt -ksp\_monitor\_singular\_value}

The ratio of the largest to smallest singular values gives the condition number estimate for the preconditioned operator.  Note that this flag will also cause the 2-norm of the true residual (as opposed to the preconditioned residual) to be printed.

If you are doing this in the current version of PFLOTRAN, you need

 {\tt -flow\_ksp\_type gmres -flow\_ksp\_monitor\_singular\_value}

The estimates will get better the closer one is to the GMRES restart.  (When restart occurs, the Hessenberg matrix from which the eigenvalue estimates are obtained gets discarded along with everything else.)  The frequency can be changed via the option

 {\tt -flow\_ksp\_gmres\_restart <positive integer>}

The default restart frequency is 30.
\end{comment}

\newpage

\section{Creating the Input File: PFLOTRAN Keywords}

The PFLOTRAN input file construction is based on keywords. Lines beginning with a colon (:) are treated as comments. Each entry to the input file must begin in the first column. Keywords {\tt SKIP} and {\tt NOSKIP} are used to skip over sections of the input file. Blank lines may occur in input file. Alternate keyword spelling is indicated in round brackets (~). Input options are indicated in square brackets [~], as well as default values. Curly brackets \{~\} indicate the result of invoking the corresponding keyword. Always refer to source code when in doubt!

Initial and boundary conditions and material properties are assigned to spatial regions using a novel {\em coupler} approach. In this approach, initial and boundary conditions (keyword CONDITION) are assigned to regions (keyword REGION) using keywords INITIAL\_CONDITION and BOUNDARY\_CONDITION. Material properties (keyword MATERIAL) are assigned to regions using the keyword STRATIGRAPHY.

\begin{longtable}{ll}%[h]%\centering
%\caption{PFLOTRAN Keywords}\label{flkeywd}

%\vspace{4mm}

%\begin{tabular}{lll}
\toprule[1.5pt]
\multicolumn{1}{c}{\bf Keyword} & \multicolumn{1}{c}{\bf Description}\\
\midrule[1pt]
\hyperlink{target_bcon}{\bf BOUNDARY\_CONDITION} & \\
\hyperlink{target_brk}{\bf BREAKTHROUGH} & \\
\hyperlink{target_brine}{\bf BRINE (BRIN)} & \\
\hyperlink{target_ckpt}{\bf CHECKPOINT} & \\
\hyperlink{target_chem}{\bf CHEMISTRY} & \\
\hyperlink{target_stat}{\bf COMPUTE\_STATISTICS} & \\
\hyperlink{target_constraint}{\bf CONSTRAINT} & transport (optional)\\
\hyperlink{target_datset}{\bf DATASET} & \\
\hyperlink{target_dbg}{\bf DEBUG} & \\
\hyperlink{target_flow_cond}{\bf FLOW\_CONDITION} & \\
\hyperlink{target_fluid_property}{\bf FLUID\_PROPERTY} & \\
\hyperlink{target_grid}{\bf GRID} & (required)\\
\hyperlink{target_init}{\bf INITIAL\_CONDITION} & \\
\hyperlink{target_linsolv}{\bf LINEAR\_SOLVER} & \\
\hyperlink{target_mat}{\bf MATERIAL\_PROPERTY} & \\
\hyperlink{target_mode}{\bf MODE} & \\
\hyperlink{target_newt}{\bf NEWTON\_SOLVER} & \\
\hyperlink{target_numjac}{\bf NUMERICAL\_JACOBIAN} & \\
\hyperlink{target_observation}{\bf OBSERVATION} & \\
\hyperlink{target_orig}{\bf ORIG, ORIGIN} & \\
\hyperlink{target_output}{\bf OUTPUT} & \\
\hyperlink{target_overwrite}{\bf OVERWRITE\_RESTART\_TRANSPORT} & \\
\hyperlink{target_proc}{\bf PROC} & (optional)\\
\hyperlink{target_region}{\bf REGION} & \\
\hyperlink{target_restart}{\bf RESTART} & \\
\hyperlink{target_sat}{\bf SATURATION\_FUNCTION} & \\
\hyperlink{target_src}{\bf SOURCE\_SINK} & \\
\hyperlink{target_strata}{\bf STRATIGRAPHY (STRATA)} & \\
\hyperlink{target_time}{\bf TIME} & \\
\hyperlink{target_timestep}{\bf TIMESTEPPER} & \\
\hyperlink{target_trans_cond}{\bf TRANSPORT\_CONDITION} & \\
\hyperlink{target_unifvel}{\bf UNIFORM\_VELOCITY} & \\
\hyperlink{target_touch}{\bf USE\_TOUCH\_OPTIONS} & \\
\hyperlink{target_veldata}{\bf VELOCITY\_DATASET} & (optional) \\
\hyperlink{target_wallclk}{\bf WALLCLOCK\_STOP} & \\
\bottomrule[1.5pt]
%\end{tabular}
\end{longtable}


\noindent{\bf Conventions and Notation:} Keywords are in boldface with optional modifying keywords in square brackets [\ldots], and user entries in typewriter font.

Unless otherwise specified, units in the input file are assumed to be as listed in Table~\ref{tunits}.

\begin{table}[h]\centering
\caption{Units}\label{tunits}

\vspace{3mm}

%\rowcolors{row}{odd-row cyan}{even-row green}
\rowcolors[]{1}{red!20}{red!10}\rowcolors[]{1}{blue!20}{blue!10}
\begin{tabular}{ll}
\toprule[2pt]
%\hline
%Quantity & \multicolumn{1}{c}{Units}\\
Quantity & Units\\
\midrule[1pt]
%\hline
Pressure: & Pascal [Pa] (absolute)\\
%\rowcolor[rgb]{0.5}
Temperature: & Celcius [C]\\
Distance: & meter [m]\\
Volume: & meter$^3$ [m$^3$]\\
Time: & second [s]\\
Velocity: & meter/second [m/s]\\
Concentration: & molarity [M] or molality [m] (see MOLAL keyword)\\
Enthalpy: & kilojoule/mole [kJ/mol]\\
Mass: & kilogram [kg]\\
Rate: & mass/second [kg/s] or volume/second [m$^3$/s]\\
Surface Site Density: & mole/meter$^{3}$ [mol/m$^{3}$]\\
\bottomrule[1.5pt]
%\hline
\end{tabular}
\end{table}

\begin{comment}
\begin{verbatim}
\protect\hypertarget{target_XXX}{}
\subsection{Keyword: XXX}
{\noindent\bf Description:}
{\noindent\bf Input:}
\begin{deflist}{0000000000}
\item[]
\end{deflist}
{\noindent\bf Explanation:}
\begin{description}
\item[Keyword XXX]
\end{description}
{\noindent\bf Examples:}
\end{verbatim}
\end{comment}

\subsection{Example Input File}

\footnotesize
:colon denotes a comment line
:Description: 3D infiltration problem with calcite dissolution

\noindent
: == debugging ================================================================\\
:\hyperlink{target_dbg}{\bf DEBUG}\\
:MATVIEW\_JACOBIAN\\
:VECVIEW\_RESIDUAL\\
:VECVIEW\_SOLUTION\\
:/

\noindent
: == mode =====================================================================\\
\hyperlink{target_mode}{\bf MODE} RICHARDS

\noindent
: == chemistry ================================================================\\
\hyperlink{target_chem}{\bf CHEMISTRY}\\
OPERATOR\_SPLIT\\
PRIMARY\_SPECIES\\
Ca++\\
H+\\
CO2(aq)\\
Tracer\\
/\\
SECONDARY\_SPECIES\\
OH-\\
HCO3-\\
CO3--\\
CaHCO3+\\
CaCO3(aq)\\
/\\
GAS\_SPECIES\\
CO2(g)\\
/\\
MINERALS\\
Calcite\\
/\\
:\\
MINERAL\_KINETICS\\
Calcite\\
RATE\_CONSTANT 1.e-8 ! [mol/cm$^3$/s]\\
/\\
/\\
:\\
DATABASE /Users/lichtner/flotran/database/hanford.dat\\
LOG\_FORMULATION\\
ACTIVITY\_COEFFICIENTS !NEWTON\_ITERATION\\
MOLAL\\
OUTPUT\\
All\\
/\\
/

\noindent
: == reference variables ======================================================\\
REFERENCE\_POROSITY 0.25d0\\

\noindent
: == time stepping ============================================================\\
\hyperlink{target_timestep}{\bf TIMESTEPPER}\\
TS\_ACCELERATION 8\\
MAX\_STEPS 100000\\
/

\noindent
: == discretization ===========================================================\\
\hyperlink{target_grid}{\bf GRID}\\
:TYPE amr ! amr grid\\
TYPE structured\\
NXYZ 6 6 6\\
DXYZ\\
1.\\
1.\\
1.\\
/\\
/

\noindent
: == flow solvers =============================================================\\
\hyperlink{target_newt}{\bf NEWTON\_SOLVER} FLOW\\
PRECONDITIONER\_MATRIX\_TYPE AIJ\\
RTOL 1.d-8\\
ATOL 1.d-8\\
STOL 1.d-30\\
ITOL\_UPDATE 1.d0\\
:NO\_INFINITY\_NORM\\
:NO\_PRINT\_CONVERGENCE\\
:PRINT\_DETAILED\_CONVERGENCE\\
/

\noindent
\hyperlink{target_linsolv}{\bf LINEAR\_SOLVER} FLOW\\
:KSP\_TYPE PREONLY\\
:PC\_TYPE LU\\
:KSP\_TYPE FGMRES !samrai\\
:PC\_TYPE SHELL !samrai\\
/

\noindent
: == transport solvers ========================================================\\
\hyperlink{target_newt}{\bf NEWTON\_SOLVER} TRANSPORT\\
PRECONDITIONER\_MATRIX\_TYPE AIJ\\
RTOL 1.d-12\\
ATOL 1.d-12\\
STOL 1.d-30\\
:NO\_INFINITY\_NORM\\
:NO\_PRINT\_CONVERGENCE\\
:PRINT\_DETAILED\_CONVERGENCE\\
/

\noindent
\hyperlink{target_linsolv}{\bf LINEAR\_SOLVER} TRANSPORT\\
:PC\_TYPE LU\\
:KSP\_TYPE PREONLY\\
:KSP\_TYPE FGMRES ! samrai\\
:PC\_TYPE SHELL !samrai\\
/

\noindent
: == fluid properties =========================================================\\
FLUID\_PROPERTY\\
DIFFUSION\_COEFFICIENT 1.d-9\\
/

\noindent
: == material properties ======================================================\\
\hyperlink{target_mat}{\bf MATERIAL\_PROPERTY} HD\\
ID 1\\
SATURATION\_FUNCTION HD\\
POROSITY 0.262\\
TORTUOSITY 1.0\\
PERMEABILITY\\
PERM\_ISO 5.43d-13\\
/\\
/

\noindent
: == saturation / permeability functions ======================================\\
\hyperlink{target_sat}{\bf SATURATION\_FUNCTION} HD\\
SATURATION\_FUNCTION\_TYPE VAN\_GENUCHTEN\\
RESIDUAL\_SATURATION 0.115\\
LAMBDA 0.286\\
ALPHA 1.9401d-4\\
/

\noindent
: == output ===================================================================\\
\hyperlink{target_output}{\bf OUTPUT}\\
:PERIODIC TIMESTEP 1\\
PERIODIC TIME 0.1 y\\
FORMAT HDF5\\
FORMAT TECPLOT BLOCK\\
VELOCITIES\\
/

\noindent
: == times ====================================================================\\
\hyperlink{target_time}{\bf TIME}\\
FINAL\_TIME 1.d0 y\\
INITIAL\ 1.e-6 y\\
MAXIMUM\_TIMESTEP\_SIZE 1.e-2 y\\
/

\noindent
: == regions ==================================================================\\
\hyperlink{target_region}{\bf REGION} all\\
COORDINATES\\
0.d0 0.d0 0.d0\\
6.d0 6.d0 6.d0\\
/\\
/

\noindent
\hyperlink{target_region}{\bf REGION} Top\\
FACE TOP\\
COORDINATES\\
0.d0 0.d0 6.d0\\
6.d0 6.d0 6.d0\\
/\\
/

\noindent
\hyperlink{target_region}{\bf REGION} Inlet\\
FACE TOP\\
COORDINATES\\
2.d0 2.d0 6.d0\\
4.d0 4.d0 6.d0\\
/\\
:BLOCK 3 4 3 4 6 6\\
/

\noindent
\hyperlink{target_region}{\bf REGION} Bottom\\
FACE BOTTOM\\
COORDINATES\\
0.d0 0.d0 0.d0\\
6.d0 6.d0 0.d0\\
/\\
/

\noindent
: == flow conditions ==========================================================\\
\hyperlink{target_flow_cond}{\bf FLOW\_CONDITION} Inlet\\
TYPE\\
FLUX neumann\\
/\\
FLUX 0.317098d-6 ! 10 m/y\\
/

\noindent
\hyperlink{target_flow_cond}{\bf FLOW\_CONDITION} Initial\\
TYPE\\
PRESSURE hydrostatic\\
/\\
DATUM 0.d0 0.d0 6.d0\\
PRESSURE 101325.d0\\
/

\noindent
: == transport conditions =====================================================\\
\hyperlink{target_trans_cond}{\bf TRANSPORT\_CONDITION} Inlet\\
TYPE dirichlet\\
CONSTRAINT\_LIST\\
0.d0 Inlet\\
/\\
/

\noindent
\hyperlink{target_trans_cond}{\bf TRANSPORT\_CONDITION} Initial\\
TYPE dirichlet\\
CONSTRAINT\_LIST\\
0.d0 Initial\\
/\\
/

\noindent
\hyperlink{target_trans_cond}{\bf TRANSPORT\_CONDITION} Outlet\\
TYPE zero\_gradient\\
CONSTRAINT\_LIST\\
0.d0 Initial\\
/\\
/

\noindent
: == couplers =================================================================\\
\hyperlink{target_bcon}{\bf BOUNDARY\_CONDITION} Inlet\\
\hyperlink{target_flow_cond}{\bf FLOW\_CONDITION} Inlet\\
\hyperlink{target_trans_cond}{\bf TRANSPORT\_CONDITION} Inlet\\
\hyperlink{target_region}{\bf REGION} Inlet\\
/

\noindent
\hyperlink{target_bcon}{\bf BOUNDARY\_CONDITION} Outlet\\
\hyperlink{target_flow_cond}{\bf FLOW\_CONDITION} Initial\\
\hyperlink{target_trans_cond}{\bf TRANSPORT\_CONDITION} Outlet\\
\hyperlink{target_region}{\bf REGION} Bottom\\
/

\noindent
\hyperlink{target_init}{\bf INITIAL\_CONDITION} Initial\\
\hyperlink{target_flow_cond}{\bf FLOW\_CONDITION} Initial\\
\hyperlink{target_trans_cond}{\bf TRANSPORT\_CONDITION} Initial\\
\hyperlink{target_region}{\bf REGION} all\\
/

\noindent
: == stratigraphy =============================================================\\
\hyperlink{target_strata}{\bf STRATA}\\
MATERIAL HD\\
REGION all\\
/

\noindent
: == transport constraints ======================================================\\
\hyperlink{target_constraint}{\bf CONSTRAINT} Initial\\
CONCENTRATIONS\\
Ca++    1.d-4   M  Calcite\\
H+      8.0d0  pH\\
CO2(aq) 1.d-2   G  CO2(g)\\
Tracer  1.d-8   T\\
/\\
MINERALS\\
Calcite    0.75  1.\\
/\\
/

\noindent
\hyperlink{target_constraint}{\bf CONSTRAINT} Inlet\\
CONCENTRATIONS\\
Ca++    1.d-6   T\\
H+      3.0d0  pH\\
CO2(aq) 1.d-3   G  CO2(g)\\
Tracer  1.d-0   T\\
/\\
/
\normalsize

\newpage
\protect\hypertarget{target_bcon}{}

\subsection{Keyword: BOUNDARY\_CONDITION}
{\noindent\bf Description:}
The BOUNDARY\_CONDITION keyword couples conditions specified under the FLOW\_\-CONDITION and/or TRANSPORT\_CONDITION keywords to a REGION in the problem domain.  The use of this keyword enables the use/reuse of flow and transport conditions and regions within multiple boundary and initial conditions and source/sinks in the input deck.

{\noindent\bf Input:}

\begin{deflist}{000}
\item[BOUNDARY\_CONDITION] {\tt boundary\_condition\_name}
\begin{deflist}{000}
\item[FLOW\_CONDITION] {\tt flow\_condition\_name}
\item[TRANSPORT\_CONDITION] {\tt transport\_condition\_name}
\item[REGION] {\tt region\_name}
\end{deflist}
\item[\keyend]
\end{deflist}

{\noindent\bf Explanation:}

\begin{center}
\begin{tabularx}{\linewidth}{lX}
\toprule[1.5pt]
\bf Keyword & \bf Description\\
\midrule
\bf BOUNDARY\_CONDITION & Defines the beginning of a boundary condition entry and the name of the boundary condition.\\
\midrule
\bf FLOW\_CONDITION & Defines the name of the flow condition to be linked to this boundary condition.\\
\midrule
\bf TRANSPORT\_CONDITION & Defines the name of the transport condition to be linked to this boundary condition.\\
\midrule
\bf REGION & Defines the name of the region to which the conditions are linked.\\
\midrule
\bf END & Terminates the boundary condition entry.\\
%\midrule\midrule
\bottomrule[1.5pt]
\end{tabularx}
\end{center}

\bigskip

{\noindent\bf Examples:}
\begin{verbatim}
BOUNDARY_CONDITION river
FLOW_CONDITION river_stage
TRANSPORT_CONDITION river_chemistry
REGION river_bank
END

BOUNDARY_CONDITION recharge
FLOW_CONDITION infiltration_flux
TRANSPORT_CONDITION infiltration_chemistry
REGION ground_surface
END
\end{verbatim}

%========================================================================

\newpage
\protect\hypertarget{target_brine}{}

\subsection{Keyword: BRINE (BRIN)}

\begin{deflist}{000}
\item[BRINE, BRIN] {\tt Value m\_nacl} [MOLAL, MASS, MOLE]
\end{deflist}

%========================================================================

\newpage
\protect\hypertarget{target_ckpt}{}

\subsection{Keyword: CHECKPOINT}
{\noindent\bf Description:}
Checkpoint files enable the restart of a simulation at any discrete point in simulation where a checkpoint file has been printed.  When the CHECKPOINT card is included in the input deck, checkpoint files are printed every N time steps, where N is the checkpoint frequency, and at the end of the simulation, should the simulation finish or the be shut down properly mid-simulation using the WALL\_CLOCK\_STOP card.  Checkpoint files are named \linebreak {\tt pflotran.chkN}, where N is the number of the timestep when the checkpoint file was printed.
A file named {\tt restart.chk} will also be written when PFLOTRAN properly terminates execution. One use this file to pick up from where the simulation stopped by increasing the final time.

{\noindent\bf Input:}

\begin{deflist}{0000000000}
\item [CHECKPOINT] \ {\tt <checkpoint\_frequency>}
\end{deflist}

{\noindent\bf Explanation:}

\begin{center}
\begin{tabularx}{\linewidth}{lX}
\toprule[1.5pt]
\bf Keyword & \bf Description\\
\midrule
\bf CHECKPOINT & toggles on checkpointing \\
{\tt checkpoint\_frequency} & frequency at which checkpoint files are printed {\tt<integer>} \\
\bottomrule
\end{tabularx}
\end{center}

\bigskip

{\noindent\bf Examples:}
\begin{verbatim}
CHECKPOINT 1000

CHECKPOINT 5
\end{verbatim}

%========================================================================
\newpage
\protect\hypertarget{target_chem}{}

\subsection{Keyword: CHEMISTRY}

\noindent
{\bf Description:}
The {\bf CHEMISTRY} keyword invokes the reactive transport mode and provides input for primary species, secondary species, minerals, gases, colloids and colloid-facilitated transport, and sorption including ion exchange and surface complexation. Mineral reactions are described through a kinetic rate law based on transition state theory and surface complexation reactions may involve equilibrium, kinetic (reversible or irreversible) or a multirate formulation.

%\shadowbox{
%\begin{minipage}{6.5in}

\noindent {\bf Input:}

\begin{deflist}{000}
\item [CHEMISTRY] ~

\begin{deflist}{000}

\item [PRIMARY\_SPECIES] ~
\item {\tt Name}
\item [\keyend]

\item [SECONDARY\_SPECIES] ~
\item {\tt Name}
\item [\keyend]

\item[GAS\_SPECIES] ~
\item {\tt Name}
\item [\keyend]

\item[MINERALS]
\item {\tt Name}
\item [\keyend]

\item[COLLOIDS]
\item {\tt Name} \ \ \ \ {\tt Mobile\_Fraction} [---]
\item [\keyend]

\item[MINERAL\_KINETICS] ~

\begin{deflist}{000}
\item [{\tt Mineral Name}]
\item [RATE\_CONSTANT] \ {\tt Value} [mol/cm$^2$/s]
\item [\keyend]
\end{deflist}

\item [\keyend]

\item[SORPTION] ~
\begin{deflist}{000}
\item[SURFACE\_COMPLEXATION\_RXN] ~

\begin{deflist}{000}
\item[EQUILIBRIUM]

\item[MULTIRATE\_KINETIC]

\item[KINETIC]

\item[COMPLEX\_KINETICS] ~
\begin{deflist}{000}
\item[FORWARD\_RATE\_CONSTANT] {\tt Value} [mol/cm$^3$/s???]
\item[BACKWARD\_RATE\_CONSTANT] {\tt Value} [mol/cm$^3$/s???]
\end{deflist}

\item [SITE\_FRACTION] {\tt Value}[---] \ \ \ \ \ (Continuation line `$\backslash$')
\item [RATE, RATES] {\tt Value} [mol/cm$^3$/s?] (Continuation line `$\backslash$')
\item [MULTIRATE\_SCALE\_FACTOR] {\tt Value} [---]

\item [MINERAL] {\tt Mineral Name}
\begin{deflist}{000}
\item[SITE] {\tt Name} \ \ \ {\tt Site Density} [mol/m$^3$]
\item[COMPLEXES] ~
\begin{deflist}{000}
\item[\tt Complex Name]
\end{deflist}
\item [\keyend] ~
\end{deflist}
\item [\keyend] ~

\item [COLLOID] {\tt Name}
\begin{deflist}{000}
\item[SITE] {\tt Name} \ \ \ {\tt Site Density} [mol/m$^3$]
\item[COMPLEXES] ~
\begin{deflist}{000}
\item[\tt Complex Name]
\end{deflist}
\item [\keyend] ~
\end{deflist}
\item [\keyend] ~
\end{deflist}

\item [\keyend]
\end{deflist}

\begin{deflist}{000}
\item [ION\_EXCHANGE\_RXN] ~
\begin{deflist}{000}
%\item [EQUILIBRIUM]
\item [MINERAL] {\tt Mineral Name}
\begin{deflist}{000}
\item [CEC] {\tt Value}[mol/m$^3$]
%\item[SITE/CATION] {\tt Name} \ \ \ {\tt Site Density} [mol/m$^3$]
\item[CATIONS] ~
\begin{deflist}{000}
\item[\tt Name]
\end{deflist}
\item [\keyend] ~
\end{deflist}
\item [\keyend] ~
\end{deflist}
\item [\keyend] ~

\item[DISTRIBUTION\_COEF] \ (not implemented)
\item[JUMPSTART\_KINETIC\_SORPTION]
\item[NO\_CHECKPOINT\_KINETIC\_SORPTION]
\item[NO\_RESTART\_KINETIC\_SORPTION]
\end{deflist}

\item [\keyend]

\item[DATABASE] {\tt Path/Database\_Name}
\item[LOG\_FORMULATION]
\item[NO\_CHECKPOINT\_ACT\_COEFS]
\item[ACTIVITY\_COEFFICIENTS] [\bf LAG, NEWTON, TIMESTEP, NEWTON\_ITERATION]
\item[ACTIVITY\_H2O, ACTIVITY\_WATER]
\item[MOLAL, MOLALITY]
\item[NO\_BDOT]
\item[UPDATE\_POROSITY]
\item[UPDATE\_TORTUOSITY]
\item[UPDATE\_PERMEABILITY]
\item[UPDATE\_MINERAL\_SURFACE\_AREA]
\item[MAX\_DLNC] \rm (Default 5)
\item[OUTPUT] ~
\begin{deflist}{000}
\item[MOLALITY]
\item[MOLARITY]
\item[All]
\item[\tt Species Name]
\item[FREE\_ION]
\item[pH]
\item[TOTAL\_SORBED]
\item[TOTAL\_SORBED\_MOBILE]
\item[COLLOIDS]
\item[KD]
\end{deflist}

\item [\keyend]

\end{deflist}

\item [\keyend]
\end{deflist}
%\end{minipage}
%}

\noindent
{\bf Explanation:}

\begin{center}
\begin{tabularx}{\linewidth}{lX}
\toprule
\bf Keyword & \bf Description\\
\midrule
\bf Primary\_Species & List of primary species that fully describe the chemical composition of the fluid. The set of primary species must form an independent set of species in terms of which all homogeneous aqueous equilibrium reactions can be expressed.\\
\midrule
\bf Secondary\_Species & List of aqueous species in equilibrium with primary species.\\
\midrule
\bf Gas\_Species & List of gas species.\\
\midrule
\ldots & \\
\bottomrule
\end{tabularx}
\end{center}

\bigskip

\noindent
{\bf Examples:}

%========================================================================

\newpage
\protect\hypertarget{target_stat}{}

\subsection{Keyword: COMPUTE\_STATISTICS}

\noindent
{\bf Description:}
COMPUTE\_STATISTICS enables the calculation statistical analysis of flow velocities during a simulation.  The average, maximum, minimum, and standard deviations velocities are computed.

\noindent{\bf Input:}
\begin{deflist}{000}
\item [COMPUTE\_STATISTICS] \{compute\_statistics = .true.\}
\end{deflist}

\noindent {\bf Explanation:}

\noindent
{\bf Example:}
\begin{verbatim}
COMPUTE_STATISTICS
\end{verbatim}

%========================================================================

\newpage
\protect\hypertarget{target_constraint}{}

\subsection{Keyword: CONSTRAINT}

\noindent
{\bf Description:}
The keyword {\bf CONSTRAINT} sets up fluid compositions based on various constraint conditions chosen by the user.

\noindent{\bf Input:}
\begin{deflist}{000}
\item [CONSTRAINT] \ {\tt constrain\_name}
\begin{deflist}{000}
\item[CONC, CONCENTRATIONS]
\begin{deflist}{000}
\item[{\tt Name, Concentration\_Value, Constraint}] ~\\
The variable {\tt Constraint} is chosen from the following list:
\item[F, FREE]
\item[T, TOTAL] 
\item[TOTAL\_SORB]
\item[P, PH]
\item[L, LOG] 
\item[M, MINERAL, MNRL]
\item[G, GAS]
\item[SC, CONSTRAINT\_SUPERCRIT\_CO2] 
\item[Z, CHG]
\end{deflist}
\item[(., /, END)]
\item[MNRL, MINERALS] ~
\begin{deflist}{000}
\item[{\tt mineral\_name, volume\_fraction, surface\_area}]
\end{deflist}
\item[(., /, END)]
\end{deflist}
\item[(., /, END)]
\end{deflist}

\noindent {\bf Explanation:}

\noindent
{\bf Example:}
\begin{verbatim}
CONSTRAINT initial
CONCENTRATIONS
H+       7.3             pH
O2(aq)   1.78132e-4       T
Al+++    1.e-9            M K-Feldspar
Ca++     1.20644e-3       M Calcite
Cu++     1.e-6            T
Fe++     1.e-9            M Ferrihydrite
Mg++     5.09772e-4       T
UO2++    2.34845e-7       T
K+       1.54789e-4       T
Na+      2.03498e-3       T
HCO3-    2.57305e-3       T
Cl-      6.97741e-4       T
F-       2.09491e-5       T
HPO4--   1.e-6            T
NO3-     4.69979e-3       T
SO4--    6.37961e-4       T
SiO2(aq) 5.36989e-4       T
Tracer   2.34845e-7       F
/
MINERALS
Quartz         0.35  1.
Calcite        0.    1.
Metatorbernite 0.    1.
/
/
\end{verbatim}

%========================================================================

\newpage
\protect\hypertarget{target_datset}{}

\subsection{Keyword: DATASET}

%\noindent{\bf Description:} Input datafile for thermodynamic properties of aqueous species, minerals, gases, colloids, and surface complexes.

\noindent{\bf Description:} Dataset for permeability.

\noindent{\bf Input:}
\begin{deflist}{000}
\item[DATASET] [permx, permy, permz] [permx\_filename, permy\_filename, permz\_filename]
\end{deflist}

%========================================================================

\newpage
\protect\hypertarget{target_dbg}{}

{\noindent\bf Input:}

\subsection{Keyword: DEBUG}
\begin{deflist}{00}
\item[DEBUG]~
\begin{deflist}{00}
\item[PRINT\_SOLUTION] [\bf VECVIEW\_SOLUTION, VIEW\_SOLUTION]
\item[PRINT\_RESIDUAL] [VECVIEW\_RESIDUAL,VIEW\_RESIDUAL]
\item[PRINT\_JACOBIAN] [MATVIEW\_JACOBIAN, VIEW\_JACOBIAN]
\item[PRINT\_JACOBIAN\_NORM] [NORM\_JACOBIAN]
\item[PRINT\_COUPLERS] [PRINT\_COUPLER]
\item[PRINT\_JACOBIAN\_DETAILED] [MATVIEW\_JACOBIAN\_DETAILED, VIEW\_JACOBIAN\_DETAILED]
\item  PRINT\_NUMERICAL\_DERIVATIVES] [VIEW\_NUMERICAL\_DERIVATIVES]
\end{deflist}
\item[(.,/,END)]
\end{deflist}

{\noindent\bf Explanation:}

\bigskip

{\noindent\bf Examples:}

%================================================================

\newpage
\protect\hypertarget{target_flow_cond}{}

\subsection{Keyword: FLOW\_CONDITION}

{\noindent\bf Description:}
The {\bf FLOW\_CONDITION} keyword specifies scalar or vector data sets to be associated with a given boundary or initial condition.  For instance, to specify a hydrostatic boundary condition, the use would specify a condition with a pressure associated with a point in space (i.e. datum) in space and a gradient, both vector quantities.  Note that in the case of a hydrostatic boundary condition, the vertical gradient specified in the input deck must be zero in order to enable the hydrostatic pressure calculation.  Otherwise, the specified vertical gradient overrides the hydrostatic pressure.  Transient pressures, temperatures, concentrations, datums, gradients, etc. are specified using the {\bf FILE} {\tt filename} combination for the name of the data set.

{\noindent\bf Input:}
\begin{deflist}{000}
\item [FLOW\_CONDITION] \ {\tt flow\_condition\_name}
\begin{deflist}{000}
\item [UNITS] {\tt Value} (not currently supported)
\begin{deflist}{000000000}
{\tt Value} is one of the following entries:
\item[s, sec, min, hr, d, day, w, week, mo, month, y, yr] (time)
\item[mm, cm, m, met, meter, dm, km] (length)
\item[kg/s, kg/yr] (rate)
\item[Pa, KPa] (pressure)
\item[m/s, m/yr] (velocity)
\item[C, K] (temperature)
\item[M, mol/L] (concentration)
\item[KJ/mol] (enthalpy)
\end{deflist}

%\item[(., /, END)]

\item[CYCLIC] 

\item[INTERPOLATION] ~
\begin{deflist}{000}
\item[step]
\item[linear]
\end{deflist}

\item[TYPE] ~

\begin{deflist}{000000}
\item[PRESSURE] {\tt [dirichlet, hydrostatic, zero\_gradient, conductance,  \linebreak seepage]}
\item[RATE] \ {\tt [mass\_rate, volumetric\_rate, scaled\_volumetric\_rate]}: \ specifies an injection/extraction rate in mass [kg/s], volume [m$^3$/s], and a volumetric injection/extraction rate [m$^3$/s] that is scaled across a well screen, weighted as a function of the interfacial area and permeability of neighboring cells (in $x$, $y$).

\item[FLUX] {\tt [dirichlet, neumann, mass\_rate, hydrostatic, conductance,  \linebreak zero\_gradient, production\_well, seepage, volumetric, \linebreak volumetric\_rate, equilibrium]}
\item[TEMPERATURE] {\tt [dirichlet, hydrostatic, zero\_gradient]}
\item[CONCENTRATION] {\tt [dirichlet, hydrostatic, zero\_gradient]}
\item[ENTHALPY (H)] {\tt [dirichlet, hydrostatic, zero\_gradient]}
\end{deflist}
\item[(., /, END)]
\item[TIME] (not currently supported)

\item[IPHASE] {\tt Value[integer]}

\item[DATUM] ~
\begin{deflist}{000}
\item[{\tt x \ y \ z}]
\item[{\bf FILE} \ {\tt file\_name}]
\end{deflist}
\item[GRADIENT, GRAD] ~
\begin{deflist}{000}
\item [PRES, PRESS, PRESSURE] ~
\begin{deflist}{000}
\item[$d_{dx}$ $d_{dy}$ $d_{dz}$]
\item[{\bf FILE} \ {\tt file\_name}]
\end{deflist}
\item [FLUX]
\item [TEMP, TEMPERATURE]
\item [CONC, CONCENTRATION]
\item [H, ENTHALPY]
\end{deflist}
\item[(., /, END)]
\item[TEMPERATURE, TEMP] \ {\tt <float>}
\item[ENTHALPY, H] \ {\tt <float>}
\item[PRESSURE, PRES, PRESS] \ {\tt <float>}
\item[RATE] \ {\tt Value}
\item[FLUX, VELOCITY, VEL] \ {\tt <float>}
\item[CONC, CONCENTRATION] \ {\tt <float>}
\item[CONDUCTANCE] \ {\tt <float>}
%\item[CONSTRAINT\_LIST]
\end{deflist}
\item[(., /, END)] ~
\end{deflist}

{\noindent\bf Explanation:}

\begin{center}
\begin{tabularx}{\linewidth}{lX}
\toprule[1.5pt]
\bf Keyword & \bf Description\\
\midrule
\bf FLOW/TRANSPORT\_CONDITION & Initiates a condition entry and defines its name.\\
\midrule
\bf CYCLIC & Instructs PFLOTRAN to cycle the transient data set should the simulation time exceed the last time in the data set.\\
\midrule
\bf INTERPOLATION & Defines the method for interpolating between data set times.\\
\midrule
\bf DATUM & Location is space where prescribed scalar (e.g. pressure, temperature concentration, etc.) is defined.\\
\midrule
\bf TYPE & Specifies the type of condition.\\
\midrule
\bf PRESSURE & Specifies the type of pressure condition.\\
 \bf TEMPERATURE & Specifies the type of temperature condition.\\
    \bf CONCENTRATION & Specifies the type of concentration condition.\\
    \bf ENTHALPY & Specifies the type of enthalpy condition.\\
    \bf END & Terminates type entry.\\
\midrule\midrule
\bf GRADIENT & Gradient of the scalar field in 3D space.\\
\midrule
\bf PRESSURE & Pressure gradient in $x$-, $y$-, and $z$-directions.\\
\bf TEMPERATURE & Temperature gradient in $x$-, $y$-, and $z$-directions.\\
\bf CONCENTRATION & Concentration gradient in $x$-, $y$-, and $z$-directions.\\
\bf ENTHALPY & Enthalpy gradient in $x$-, $y$-, and $z$-directions.\\
\bf END & Terminates gradient entry.\\
\midrule\midrule
\bf PRESSURE & Absolute fluid pressure at the datum.\\
\bf FLUX & Darcy velocity of fluid defining flux across a boundary.\\
\bf TEMPERATURE & Temperature in $^\circ$C at the datum.\\
\bf CONCENTRATION & Solute concentration at the datum.\\
\bf ENTHALPY & Enthalpy at the datum.\\
\bf CONSTRAINT\_LIST & Specifies a list of concentration constraints for solute transport.\\
\bf END & Terminates the condition entry.\\
\bottomrule[1.5pt]
\end{tabularx}
\end{center}

\bigskip

{\noindent\bf Examples:}
\begin{verbatim}
FLOW_CONDITION initial
TYPE
PRESSURE hydrostatic
/
PRESSURE 1956741.84 ! 200 meter piezometric head (200*997.32*9.81)
/

FLOW_CONDITION source
TYPE
RATE volumetric_rate
/
RATE 2.77777778d-3  ! 10 m^3/hr
/

TRANSPORT_CONDITION initial
TYPE zero_gradient
CONSTRAINT_LIST
0.d0 initial
/
END

TRANSPORT_CONDITION source
TYPE dirichlet
CONSTRAINT_LIST
0.d0 well
/

FLOW_CONDITION East
TYPE
:PRESSURE seepage
PRESSURE conductance
/
CYCLIC
DATUM file ../../river_scope3.datum
GRADIENT
PRESSURE file ../../river_scope3.gradient
/
CONDUCTANCE 1.d-12
PRESSURE 101325.d0
/
\end{verbatim}

%========================================================================

\newpage
\protect\hypertarget{target_fluid_property}{}

\subsection{Keyword: FLUID\_PROPERTY}

\noindent{\bf Description:}

\noindent{\bf Input:}
\begin{deflist}{000}
\item[FLUID\_PROPERTY]~
\begin{deflist}{000}
\item[PHASE] \ {\tt <name>} \ (LIQUID\_PHASE, GAS\_PHASE) [Default: LIQUID\_PHASE]
\item[DIFFUSION\_COEFFICIENT] \ {\tt <float>} [Default: $1\times 10^{-9}$ m$^2$/s]
\end{deflist}
\item[(., /, END)]
\end{deflist}

\noindent{\bf Explanation:}

\noindent{\bf Example:}
\begin{verbatim}
FLUID_PROPERTY
DIFFUSION_COEFFICIENT 1.d-9
/
\end{verbatim}

%========================================================================

\newpage
\protect\hypertarget{target_grid}{}

\subsection{Keyword: GRID \hfill Required}

\noindent{\bf Description:} this keyword defines the descritization scheme, the type of grid and resolution, and the geometry employed in the simulation.

\begin{description}
\item[GRID]~
\item[Required Input Parameters:]~

\begin{description}
\item[TYPE <type> <symmetry>:] ~

\begin{description}
\item Grid type (structured, structured\_mimetic, unstructured, amr)

\item Symmetry type (cartesian [default], cylindrical, spherical
\end{description}

\item[NXYZ <\# \# \#>:] \# of grid cells in $x$, $y$, $z$ directions (structured only)

\item[FILE <filename>:] Name of file containing grid information (unstructured only)

\item[BOUNDS:] Specifies bounds of structured cartesian grid (see examples below)
\begin{description}
\item[<x\_min, x\_max>]~
\item[<y\_min, y\_max>]~
\item[<z\_min, z\_max>]~
\end{description}
\item[(.,/,END)] ~

\item[DXYZ:] Specifies grid spacing of structured cartesian grid (see examples below)
\begin{description}
\item[<{\bf dx}>] ~
\item[<{\bf dy}>] ~
\item[<{\bf dz}>] ~
\end{description}
\item[(.,/,END)] ~
\end{description}

\item[Optional Input Parameters:] ~

\begin{description}

\item[GRAVITY <\# \# \#>:] Specifies gravity vector [Default: 0 0 $-$9.8068 m/s$^2$]

\item[ORIGIN <\# \# \#>:] Coordinate of grid origin [Default: 0 0 0]

\item[INVERT\_Z:] Inverts the $z$-axis [Default: positive $z$ points downward]
\end{description}
\end{description}

\noindent
{\bf Examples:}
\begin{verbatim}
GRID
TYPE structured cylindrical
NXYZ 512  1  32
DXYZ
2.d0
1.d0
2.d0
END
\end{verbatim}

\begin{verbatim}
BOUNDS
0. 1024.
0.    1.
0.   64.
END
\end{verbatim}

\noindent
By using the {\tt BOUNDS} keyword, the model domain is specified in a grid-independent fashion and, as a result, the grid spacing may be changed by modifying the keyword {\tt NXYZ} only.

%========================================================================

\newpage
\protect\hypertarget{target_init}{}

\subsection{Keyword: INITIAL\_CONDITION}

\noindent{\bf Description:} Condition coupler between regions and flow and transport conditions.

\noindent{\bf Input:}
\begin{deflist}{000}
\item[INITIAL\_CONDITION] \ [{\tt Name}]
\begin{deflist}{000}
\item[REGION] {\tt region\_name}
\item[FLOW\_CONDITION] {\tt condition\_name}
\item[TRANSPORT\_CONDITION] {\tt condition\_name}
%\item[TYPE] [{\tt initial, boundary, source\_sink}]
%\item[FACE] \ {\bf [WEST, EAST, NORTH, SOUTH, BOTTOM, TOP]}
\end{deflist}
\item[(., /, END)] ~
\end{deflist}

\noindent{\bf Explanation:}

\noindent{\bf Example:}

\begin{verbatim}

:=========== condition couplers ==============
: initial condition
INITIAL_CONDITION
FLOW_CONDITION gradient-north
TRANSPORT_CONDITION Initial
REGION all
END
\end{verbatim}

%========================================================================

\newpage
\protect\hypertarget{target_linsolv}{}

\subsection{Keyword: LINEAR\_SOLVER}

\noindent{\bf Description:}

\noindent{\bf Input:}
\begin{deflist}{000}
\item[LINEAR\_SOLVER] \ [{\bf TRAN, TRANSPORT / FLOW}]

\begin{deflist}{000}
\item[SOLVER\_TYPE (SOLVER, KRYLOV\_TYPE, KRYLOV, KSP, KSP\_TYPE)] ~

\begin{deflist}{000}
\item[NONE (PREONLY)]
\item[GMRES]
\item[FGMRES]
\item[BCGS] \ (BICGSTAB, BI-CGSTAB)
\item[IBCGS] \ (IBICGSTAB, IBI-CGSTAB)
\item[RICHARDSON]
\item[CG]
\end{deflist}

\item[PRECONDITIONER\_TYPE (PRECONDITIONER, PC, PC\_TYPE)] ~

\begin{deflist}{000}
\item[NONE (PCNONE)]
\item[ILU (PCILU)]
\item[LU (PCLU)]
\item[BJACOBI (BLOCK\_JACOBI)]
\item[ASM (ADDITIVE\_SCHWARTZ)]
\item[PCASM]
\item[HYPRE]
\item[SHELL]
\end{deflist}

\item[HYPRE\_OPTIONS]
\begin{deflist}{000}
\item[TYPE] \ [{\tt pilut, parasails, boomeramg, euclid}]
\item[BOOMERAMG\_CYCLE\_TYPE] / [{\tt V, W}]
\item[BOOMERAMG\_MAX\_LEVELS] \ {\tt Value}
\item[BOOMERAMG\_MAX\_ITER] \ {\tt Value}
\item[BOOMERAMG\_TOL] \ {\tt Value}
\item[BOOMERAMG\_TRUNCFACTOR] \ {\tt Value}
\item[BOOMERAMG\_AGG\_NL] \ {\tt Value}
\item[BOOMERAMG\_AGG\_NUM\_PATHS] \ {\tt Value}
\item[BOOMERAMG\_STRONG\_THRESHOLD] \ {\tt Value}
\item[BOOMERAMG\_GRID\_SWEEPS\_ALL] \ {\tt Value}
\item[BOOMERAMG\_GRID\_SWEEPS\_DOWN] \ {\tt Value}
\item[BOOMERAMG\_GRID\_SWEEPS\_UP] \ {\tt Value}
\item[BOOMERAMG\_GRID\_SWEEPS\_COARSE] \ {\tt Value}
\item[BOOMERAMG\_RELAX\_TYPE\_ALL] \ {\tt Value}
\item[BOOMERAMG\_RELAX\_TYPE\_DOWN] \ {\tt Value}
\item[BOOMERAMG\_RELAX\_TYPE\_UP] \ {\tt Value}
\item[BOOMERAMG\_RELAX\_TYPE\_COARSE] \ {\tt Value}
\item[BOOMERAMG\_RELAX\_WEIGHT\_ALL] \ {\tt Value}
\item[BOOMERAMG\_RELAX\_WEIGHT\_LEVEL] \ {\tt Value}
\item[BOOMERAMG\_OUTER\_RELAX\_WEIGHT\_ALL] \ {\tt Value}
\item[BOOMERAMG\_OUTER\_RELAX\_WEIGHT\_LEVEL] \ {\tt Value}
\item[BOOMERAMG\_NO\_CF] \ {\tt Value}
\item[BOOMERAMG\_MEASURE\_TYPE] \ {\tt Value}
\item[BOOMERAMG\_COARSEN\_TYPE] \ {\tt Value}
\item[BOOMERAMG\_INTERPOLATION\_TYPE, BOOMERAMG\_INTERP\_TYPE] \ {\tt Value}
\item[BOOMERAMG\_NODAL\_COARSEN] \ {\tt Value}
\item[BOOMERAMG\_NODAL\_RELAXATION] \ {\tt Value}
\end{deflist}

\item[ATOL] \ {\tt Value}
\item[RTOL] \ {\tt Value}
\item[DTOL] \ {\tt Value}
\item[MAXIT] \ {\tt Value}

\end{deflist}
\item[(., /, END)]
\end{deflist}

\noindent{\bf Explanation:}

\noindent{\bf Example:}

%========================================================================

\newpage
\protect\hypertarget{target_mat}{}

\subsection{Keyword: MATERIAL\_PROPERTY}

\noindent{\bf Description:} Specifies material properties to be associated with a region in the problem domain.

\noindent{\bf Input:}
\begin{deflist}{000}
\item[MATERIAL\_PROPERTY] \ {\tt Name}
\begin{deflist}{000}
\item[ID] \ {\tt float}
\item[SATURATION\_FUNCTION] \ {\tt Name}
\item[ROCK\_DENSITY] \ {\tt float} \ [kg/m$^3$]
\item[SPECIFIC\_HEAT] \ {\tt float} \ [kJ/(kg K)]
\item[LONGITUDINAL\_DISPERSIVITY] \ {\tt float} \ [m]
\item[TRANSVERSE\_DISPERSIVITY] \ (not implemented) \ [m]
\item[THERMAL\_CONDUCTIVITY\_DRY] \ {\tt float} \ [W/(m K)]
\item[THERMAL\_CONDUCTIVITY\_WET] \ {\tt float} \ [W/(m K)]
\item[PORE\_COMPRESSIBILITY] \ {\tt float} \ (not implemented) \ [bar$^{-1}$]
\item[THERMAL\_EXPANSITIVITY] \ {\tt float} \ (not implemented) \ [C$^{-1}$]
\item[POROSITY] \ {\tt float} \ [---], {\tt porosity\_filename}
%\item[POROSITY] \ {\tt porosity\_filename}
\item[TORTUOSITY] \ {\tt float} \ [---]
\item[PERMEABILITY] ~
\begin{deflist}{000}
\item[ISOTROPIC] \ Toggles on isotropy
\item[ANISOTROPIC] \ Toggles on anisotropy
\item[VERTICAL\_ANISOTROPY\_RATIO] \ {\tt float}
\item[PERM\_X] \ {\tt <float>} \ Diagonal permeability $k_{xx}$ [m$^2$]
\item[PERM\_Y] \ {\tt <float>} \ Diagonal permeability $k_{yy}$ [m$^2$]
\item[PERM\_Z] \ {\tt <float>} \ Diagonal permeability $k_{zz}$ [m$^2$]
\item[PERM\_ISO] \ {\tt <float>} \ Isotropic permeability values [m$^2$]
\item[PERM\_XY] \ {\tt <float>} \ Off-diagonal permeability $k_{xy}$ for use with MFD (mimetic\_unstructured grid) [m$^2$]
\item[PERM\_XZ] \ {\tt <float>} [m$^2$] \ Off-diagonal permeability $k_{xz}$
\item[PERM\_YZ] \ {\tt <float>} [m$^2$] \ Off-diagonal permeability $k_{yz}$
\end{deflist}
\item[(., /, END)]
\item[PERMEABILITY\_POWER] \ {\tt float}
\item[TORTUOSITY\_POWER] \ {\tt float}
\item[MINERAL\_SURFACE\_AREA\_POWER] ~
\begin{deflist}{000}
\item[VOLUME\_FRACTION] \ {\tt float} \ Volume fraction power in mineral surface area
\item[POROSITY] \ {\tt float} \ Porosity power in mineral surface area
\end{deflist}
\item[(., /, END)]
\item[RANDOM\_DATASET] \ {\tt permeability\_filename}
\end{deflist}
\item[(., /, END)]
\end{deflist}

\noindent{\bf Explanation:}

\noindent{\bf Example:}
\begin{verbatim}
MATERIAL_PROPERTY  Hanford
ID 1
SATURATION_FUNCTION sf1
POROSITY 0.332
TORTUOSITY 1.
PERMEABILITY
PERM_X 1.d-12
PERM_Y 1.d-12
PERM_Z 1.d-12
/
/
\end{verbatim}

%========================================================================

\newpage
\protect\hypertarget{target_max}{}

\subsection{Keyword: MAX\_CHANGE}

\noindent{\bf Description:}

\noindent{\bf Input:}
\begin{deflist}{000}
\item[MAX\_CHANGE] \ {\tt DPMAX} \ {\tt DTMAX} \ {\tt DSMAX} \ {\tt DCMAX}
\end{deflist}

\noindent{\bf Explanation:}

\noindent{\bf Example:}
\begin{verbatim}
:          dpmax dtmax dsmax dcmax
MAX_CHANGE 5.d4    5.  0.02   0.05
/
/
\end{verbatim}

%========================================================================

\newpage
\protect\hypertarget{target_mode}{}

\subsection{Keyword: MODE}

\noindent{\bf Description:} determines the flow mode: Richards (variably saturated porous media); MPH, MPHASE, FLASH2 (CO$_2$ + H$_2$O); THC (Thermal-Hydrologic-Chemical, in pro\-gress); IMMIS, THS (Immisible).

\begin{comment}
\noindent{\bf Input:}
\begin{deflist}{000}
\item[MODE] <option>
\item[Options:] ~
\begin{deflist}{000}
\item[RICHARDS]
\item[MPHASE (MPH)]
\item[FLASH2]
\item[THC (\rm in progress)]
\item[IMMIS (IMS, THS)]
\end{deflist}
\end{deflist}
\end{comment}

%\noindent{\bf Explanation:}

\begin{center}
\begin{tabularx}{\linewidth}{lX}
%\toprule[1.5pt]
\bf MODE <option>\\
%\midrule
\bf Option & \bf Description\\
%\midrule
\bf RICHARDS &Single-phase, isothermal, variable saturated groundwater flow using Richards equation\\
%\midrule
\bf MPHASE (MPH) &Multiphase supercritical CO$_2$-brine-energy based on variable switching for phase changes\\
%\midrule
\bf FLASH2 &Multiphase supercritical CO$_2$-brine-energy based on the flash method for phase changes with a persistent set of unknowns---required for AMR\\
%\midrule
\bf THC &Thermo-Hydro-Chemical coupled groundwater flow, thermal and solute transport\\
%\midrule
\bf IMMIS (IMS, THS) &Immissible CO$_2$-water-energy\\
%\bottomrule[1.5pt]
\end{tabularx}
\end{center}

\noindent{\bf Example:}
\begin{verbatim}
MODE THC
\end{verbatim}

%========================================================================

\newpage
\protect\hypertarget{target_newt}{}

\subsection{Keyword: NEWTON\_SOLVER}

\noindent{\bf Description:} 

\noindent{\bf Input:}
\begin{deflist}{000}
\item[NEWTON\_SOLVER] ~
\begin{deflist}{000}
\item[TRAN, TRANSPORT (tran\_solver) / DEFAULT (flow\_solver)]
\item[INEXACT\_NEWTON]
\item[NO\_PRINT\_CONVERGENCE]
\item[NO\_INF\_NORM (NO\_INFINITY\_NORM)]
\item[NO\_FORCE\_ITERATION]
\item[PRINT\_DETAILED\_CONVERGENCE]
\item[ATOL]
\item[RTOL]
\item[STOL]
\item[DTOL]
\item[ITOL (INF\_TOL, ITOL\_RES, INF\_TOL\_RES)]
\item[ITOL\_UPDATE (INF\_TOL\_UPDATE)]
\item[MAXIT]
\item[MAXF]
\end{deflist}
\item[(., /, END)]
\end{deflist}

\noindent{\bf Explanation:}

\noindent{\bf Example:}

%========================================================================

\newpage
\protect\hypertarget{target_numjac}{}

\subsection{Keyword: NUMERICAL\_JACOBIAN}
\begin{deflist}{0000000000}
\item[NUMERICAL\_JACOBIAN] \{numerical\_derivatives = .true.\}
\end{deflist}

%========================================================================

\newpage
\protect\hypertarget{target_observation}{}

\subsection{Keyword: OBSERVATION}

{\noindent\bf Description:}
The OBSERVATION card specifies a location (REGION) at which flow and transport results (e.g. pressure, saturation, flow velocities, solute concentrations, etc.) will be monitored in the output.
The user must specify either a region or boundary condition to which the observation object is linked.  The velocity keyword toggles on the printing of velocities at a point in space.

\noindent{\bf Input:}
\begin{deflist}{000}
\item[OBSERVATION] ~
\begin{deflist}{000}
\item[BOUNDARY\_CONDITION] \ {\tt boundary condition name}
\item[REGION] \ {\tt region name}
\item[VELOCITY]
\item[AT\_CELL\_CENTER]
\end{deflist}
\item[(., /, END)]
\end{deflist}

{\noindent\bf Explanation:}
\begin{description}
\item[Keyword OBSERVATION] initiates an observation point entry.
\item[Keyword REGION] (optional) defines the name of the region (usually a point in space) to which the observation point is linked.
\item[Keyword BOUNDARY\_CONDITION] (optional) specifies the name of a boundary condition to which the observation point is tied (e.g. to monitor fluxes across a boundary face).
\item[Keyword VELOCITY] (optional) toggles on the printing of Darcy velocities at the observation point.
\end{description}

{\noindent\bf Examples:}
\begin{verbatim}
OBSERVATION
REGION well1
VELOCITY
END

OBSERVATION
BOUNDARY_CONDITION river
END
\end{verbatim}

%========================================================================

\newpage
\protect\hypertarget{target_orig}{}

\subsection{Keyword: ORIGIN (ORIG)}
\begin{deflist}{0000000000}
\item[ORIGIN (ORIG)] X\_DIRECTION Y\_DIRECTION Z\_DIRECTION
\end{deflist}

%========================================================================


\newpage
\protect\hypertarget{target_output}{}

\subsection{Keyword: OUTPUT}

\noindent {\bf Description:} The {\bf OUTPUT} keyword controls formatting and time of output.

\noindent {\bf Input:}

\begin{deflist}{000}
\item[OUTPUT] ~
\begin{deflist}{000}
\item[TIMES] {\tt Unit (s, h, y)} \ \ \ {\tt <float>} 
\item[SCREEN \ OFF] \ suppress screen output
\item[SCREEN \ PERIODIC] {\tt <integer>}: print to screen every <integer> time steps.
\item[PERIODIC \ TIME] {\tt <float>} \ {\tt Unit}
\item[PERIODIC \ TIMESTEP] {\tt <float>} \ {\tt Unit}
\item[PERIODIC\_OBSERVATION \ TIME] \ {\tt <float>} \ {\tt <unit>}: \ output the results at observation points at times specified by the actual time
\item[PERIODIC\_OBSERVATION \ TIMESTEP] \ {\tt <integer> <unit>}: \ output the results at observation points at times specified by time steps
\item[NO\_PRINT\_INITIAL:] \ the initial state of the system will not be printed to the output file if this card is activated
\item[NO\_PRINT\_FINAL:] \ the final state of the system will not be printed to the output file if this card is activated
\item[FORMAT] \ <file format>: \ specify the snapshot file type. Options available are TECPLOT BLOCK, TECPLOT POINT, HDF5, MAD, VTK
%\item[FORMAT \ TECPLOT \ BLOCK]
%\item[FORMAT \ HDF5]
%\item[FORMAT \ MAD]
%\item[FORMAT \ VTK]
\item[PERMEABILITY]
\item[POROSITY]
\item[FLUXES]
\item[VELOCITIES]
\item[MASS\_BALANCE:] \ output the mass balance of the system if this card is activated. It include global mass balance as well as fluxes at all boundaries for water and chemical species specified for output in the CHEMISTRY card.
\end{deflist}
\item[(., /, END)]
\end{deflist}

\noindent {\bf Explanation:}

\begin{center}
\begin{tabularx}{\linewidth}{lX}
OUTPUT: & keyword to control output.\\
TIMES: & list of output times.\\
SCREEN OFF: & turns off screen output\\
SCREEN PERIODIC: & controls screen output frequency.\\
PERIODIC TIME: & controls frequency of output times.\\
PERIODIC TIMESTEP: & controls frequency of output time steps.\\
PERIODIC\_OBSERVATION TIME: & frequency of output time.\\
PERIODIC\_OBSERVATION TIMESTEP: & frequency of output time step.\\
NO\_FINAL, NO\_PRINT\_FINAL: & \\
FORMAT TECPLOT POINT: & Tecplot POINT output, valid for 1D and 2D problems.\\
FORMAT TECPLOT BLOCK: & Tecplot BLOCK output.\\
FORMAT HDF5: & HDF5 output format written to a .h5 file which can be read by Visit.\\
FORMAT MAD: & MAD (Method of Anchored Distributions) format.\\
FORMAT VTK: & VTK format.\\
UNIT: & time units of seconds (s), days (d), and years (y).\\
PERMEABILITY: & \\
POROSITY: & \\
FLUXES: & \\
VELOCITIES: & keyword to output velocities.\\
MASS\_BALANCE: & keyword to output global mass balances and boundary fluxes.
\end{tabularx}
\end{center}

\noindent {\bf Examples:}

\begin{verbatim}
OUTPUT
:SCREEN PERIODIC 10
:PERIODIC TIME 10 h
PERIODIC_OBSERVATION TIMESTEP 1
:times h 1.
:PERIODIC_OBSERVATION TIME 50 h
FORMAT TECPLOT POINT
FORMAT HDF5
VELOCITIES
MASS_BALANCE
/
\end{verbatim}

%========================================================================

\newpage
\protect\hypertarget{target_overwrite}{}

\subsection{Keyword: OVERWRITE\_RESTART\_TRANSPORT}
%\shadowbox{
%\begin{minipage}{6.5in}
\begin{deflist}{0000000000}
\item[OVERWRITE\_RESTART\_TRANSPORT] \{overwrite\_restart\_transport = .true.\}
\end{deflist}
%\end{minipage}
%}

%================================================================

\newpage
\protect\hypertarget{target_region}{}


\subsection{Keyword: REGION}

{\noindent\bf Description:}
The {\bf REGION} keyword defines a set of grid cells encompassed by a volume or intersected by a plane or point, or a list of grid cell ids.  The {\bf REGION} name can then be used to link this set of grid cells to material properties, strata, boundary and initial conditions, source sinks, observation points, etc.  Although a region may be defined though the use of (I, J, K) indices using the {\bf BLOCK} keyword, the user is encouraged to define regions either through {\bf COORDINATES} or lists read in from an HDF5 file in order to minimize the dependence of the input file on grid resolution.  In the case of the {\bf FILE} keyword, a list of grid cell ids is read from an HDF5 file where the {\tt region\_name} defines the HDF5 data set.  It should be noted that given a region defined by a plane or point shared by two grid cells (e.g. a plane defining the surface between two grid cells), {\bf PFLOTRAN} will select the upwind cell(s) as the region.

{\noindent\bf Input:}

\begin{deflist}{000}
\item[REGION] {\tt region\_name}
\begin{deflist}{000}
\item[FILE] \ {\tt file\_name}
\item[LIST] \ (to be implemented)
\item[FACE] \ {\tt face\_name}
\item[BLOCK] \ {\tt i1 \ i2 \ j1 \ j2 \ k1 \ k2}
\item[COORDINATE] \ {\tt x \ y \ z}
\item[COORDINATES] ~
\begin{deflist}{000}
\item[\tt x1 y1 z1]
\item[\tt x2 y2 z2]
\end{deflist}
\item[(., /, END)]
\end{deflist}
\item[(., /, END)]
\end{deflist}

{\noindent\bf Explanation:}
\begin{description}
\item[Keyword REGION] begins a region entry with name {\tt region\_name}.
\item[Keyword BLOCK] defines a volumetric, planar, or point region through IJK indices: i1 i2 j1 j2 k1 k2.
\item[Keyword COORDINATE] defines a point region through coordinates in 3D space.
\item[Keyword COORDINATES] Defines a volumetric, planar, or point region between two points in space.
\item[Keyword FILE] Defines an HDF5 file within which a dataset named
region\_name contains a list of grid cells corresponding to a region.
\item [Keyword FACE] Defines the face of the grid cell to which boundary conditions are connected where face\_name is one of WEST, EAST, NORTH, SOUTH, BOTTOM, TOP (structured grids only).
\item [Keyword END] Ends the region entry (can be one of . \ END).
\end{description}

{\noindent\bf
Examples:}

\begin{verbatim}
REGION source_zone
BLOCK 3 5 15 16 2 3
END

REGION source_zone
BLOCK
3 5 15 16 2 3
END

REGION west_boundary
BLOCK 1 1 1 30 1 50
FACE WEST
END

REGION source_zone
COORDINATES
50. 10. 10.
60. 15. 15.
/
END

REGION river_boundary
FILE ./regions.h5
FACE EAST
END

REGION well
COORDINATE 50. 10. 10.
END

REGION well
COORDINATE
50. 10. 10.
END

REGION west_boundary
COORDINATES
0. 0. 0.
0. 10. 10.
/
FACE WEST
END
\end{verbatim}

%========================================================================

\newpage
\protect\hypertarget{target_restart}{}

\subsection{Keyword: RESTART}
{\noindent\bf Description}

The RESTART card defines a checkpoint file from which the current simulation should be restarted.  If a time is specified after the file name, the initial simulation time is set to that time.

{\noindent\bf Input:}

%\shadowbox{
%\begin{minipage}{6.5in}
\begin{deflist}{000}
\item[RESTART] \ <restart\_file\_name> \ <restart\_time> \ <time\_units>
\end{deflist}
%\end{minipage}
%}

{\noindent\bf Explanation:}
\begin{description}
\item[Keyword RESTART] defines the checkpoint filename to be read in to restart a simulation at the specified time.
\end{description}

{\noindent\bf
Examples:}

\begin{verbatim}
RESTART restart.chk 0. y

RESTART restart.chk 

\end{verbatim}

%========================================================================

\newpage
\protect\hypertarget{target_sat}{}

\subsection{Keyword: SATURATION\_FUNCTION}

\noindent{\bf Description:}

\noindent{\bf Input:}
\begin{deflist}{000}
\item[SATURATION\_FUNCTION] \ {\tt Name}

\begin{deflist}{000}
\item[SATURATION\_FUNCTION\_TYPE] \ {\bf VAN\_GENUCHTEN}
\item[SATURATION\_FUNCTION\_TYPE] \ {\bf MUALEM}
\item[PERMEABILITY\_FUNCTION\_TYPE] \ {\bf VAN\_GENUCHTEN}
\item[PERMEABILITY\_FUNCTION\_TYPE] \ {\bf MUALEM}
\item[RESIDUAL\_SATURATION] \ {\tt Value}
\item[LAMBDA] \ {\tt Value}
\item[ALPHA] \ {\tt Value}
\item[MAX\_CAPILLARY\_PRESSURE] \ {\tt Value}
\item[BETAC] \ {\tt Value}
\item[POWER] \ {\tt Value}
\end{deflist}
\item[(., /, END)]
\end{deflist}

\noindent{\bf Explanation:}

\noindent{\bf Example:}
\begin{verbatim}
SATURATION_FUNCTION sf1
SATURATION_FUNCTION_TYPE VAN_GENUCHTEN
RESIDUAL_SATURATION 0.1d0
LAMBDA 2.67d0
ALPHA 2.042d-4
MAX_CAPILLARY_PRESSURE 1d8
BETAC 0.d0
POWER 1.d0
/
\end{verbatim}

%========================================================================

\newpage
\protect\hypertarget{target_src}{}

\subsection{Keyword: SOURCE\_SINK}
\begin{deflist}{000}
\item[SOURCE\_SINK] \ {\tt <name>}
\begin{deflist}{000}
\item[REGION] \ <region\_name> \ name of the region the source/sink term is applied to
\item[FLOW\_CONDITION] \ <condition\_name> \ name of the flow condition
\item[TRANSPORT\_CONDITION] \ <condition\_name> \ name of the transport condition
\end{deflist}
\item[(., /, END)]
\end{deflist}

\noindent{\bf Example:}
\begin{verbatim}
SOURCE_SINK Well_2-9_1
FLOW_CONDITION Injection_1
TRANSPORT_CONDITION Source
REGION Well_2-9_1
/
\end{verbatim}

%========================================================================

\newpage
\protect\hypertarget{target_strata}{}

\subsection{Keyword: STRATIGRAPHY (STRATA)}
%\shadowbox{
%\begin{minipage}{6.5in}
\begin{deflist}{0000000000}
\item[STRATIGRAPHY (STRATA)]
\item  REGION region\_name
\item  MATERIAL material\_name
\item  INACTIVE
\item[(., /, END)]
\end{deflist}
%\end{minipage}
%}

%========================================================================

\newpage
\protect\hypertarget{target_time}{}

\noindent {\bf Description:} the keyword {\bf TIME} controls the simulation time.

\noindent {\bf Input:}
\subsection{Keyword: TIME}
\begin{deflist}{000}
\item[TIME] ~
\begin{deflist}{000}
\item[FINAL\_TIME] {\tt Value} \ {\tt Unit (s, m, h, d, mo, y)}
\item[INITIAL\_TIMESTEP\_SIZE] {\tt Value} \ {\tt Unit (s, m, h, d, mo, y)}
\item[MAXIMUM\_TIMESTEP\_SIZE] {\tt Value} \ {\tt Unit (s, m, h, d, mo, y)}
\item[MAXIMUM\_TIMESTEP\_SIZE] {\tt Value} \ {\tt Unit (s, m, h, d, mo, y)} \ {\bf AT} \ {\tt Value} \ {\tt Unit (s, m, h, d, mo, y)}
\item[STEADY\_STATE]
\end{deflist}
\item[(., /, END)]
\end{deflist}

\noindent{\bf Explanation:}

\noindent{\bf Example:}
\begin{verbatim}
TIME
FINAL_TIME 100. h
INITIAL_TIMESTEP_SIZE 1.d-3 h
MAXIMUM_TIMESTEP_SIZE 1.d0 h
/
\end{verbatim}
%================================================================

\newpage
\protect\hypertarget{target_timestep}{}

\subsection{Keyword: TIMESTEPPER}

\noindent{\bf Description:} the keyword {\bf TIMESTEPPER} controls time stepping.

\noindent{\bf Input:}
\begin{deflist}{000}
\item[TIMESTEPPER] [{\bf FLOW, TRAN, TRANSPORT}]
\begin{deflist}{000}
\item[NUM\_STEPS\_AFTER\_TS\_CUT] [5]
\item[MAX\_STEPS] [999999]
\item[TS\_ACCELERATION] [5]
\item[MAX\_TS\_CUTS] [16]
\item[INITIALIZE\_TO\_STEADY\_STATE]
\item[RUN\_AS\_STEADY\_STATE]
\item[MAX\_PRESSURE\_CHANGE] [5.d4]
\item[MAX\_TEMPERATURE\_CHANGE] [5.d0]
\item[MAX\_CONCENTRATION\_CHANGE] [1.d0]
\item[MAX\_SATURATION\_CHANGE] [0.5d0]
\end{deflist}
\item[(., /, END)]
\end{deflist}

\noindent{\bf Explanation:}

\noindent{\bf Example:}

%========================================================================

\newpage
\protect\hypertarget{target_trans_cond}{}

\subsection{Keyword: TRANSPORT\_CONDITION}

\noindent{\bf Description:}

\noindent{\bf Input:}
\begin{deflist}{000}
\item[TRANSPORT\_CONDITION] \ {\tt Name}

\begin{deflist}{000}
\item[TYPE] [{\bf dirichlet, dirichlet\_zero\_gradient, equilibrium, neumann, mole, mole\_rate, \linebreak zero\_gradient}]
\item[TIME] \ {\tt Value}
\item[UNITS] \ {\bf s, sec, min, hr, d, day, y, yr}
\item[CONSTRAINT\_LIST]
\item {\tt time} \ {\tt constraint\_name}
\item[(., /, END)]
\item[CONSTRAINT] \ {\tt constraint\_name}
\end{deflist}
\item[(., /, END)]
\end{deflist}

\noindent{\bf Explanation:}

\noindent{\bf Example:}

%========================================================================

\newpage
\protect\hypertarget{target_unifvel}{}

\subsection{Keyword: UNIFORM\_VELOCITY \hfill Optional}
%\addcontentsline{toc}{subsection}{\thesubsection\ Keyword: UNIFORM\_VELOCITY} 

\noindent{\bf Description:}

\noindent{\bf Input:}
\begin{deflist}{000}
\item[UNIFORM\_VELOCITY] \ {\tt vlx \ vly \ vlz} \ [m/s]
\end{deflist}

\noindent{\bf Explanation:} Set uniform velocity for transport mode.

\noindent{\bf Example:}
\begin{verbatim}
UNIFORM_VELOCITY 3.84259d-6 0.d0 0.d0  ! 1.38333 cm/h
\end{verbatim}

%========================================================================

\newpage
\protect\hypertarget{target_touch}{}

\subsection{Keyword: USE\_TOUCH\_OPTIONS}

\noindent{\bf Description:}

\noindent{\bf Input:}
\begin{deflist}{000}
\item[USE\_TOUCH\_OPTIONS] \{use\_touch\_options = .true.\}
\end{deflist}

\noindent{\bf Explanation:}

\noindent{\bf Example:}

%========================================================================

\newpage
\protect\hypertarget{target_veldata}{}

\subsection{Keyword: VELOCITY\_DATASET}

\noindent{\bf Description:} Set time-dependent velocity for transport mode.

\noindent{\bf Input:}
\begin{deflist}{000}
\item[VELOCITY\_DATASET] ~
\begin{deflist}{000}
\item[UNITS] \ cm/h
\item[CYCLIC]
\item[INTERPOLATION] \ {\bf step} [default]
\item[INTERPOLATION] \ {\bf linear}
\item[VELOCITY] ~
\begin{deflist}{000}
\item[{\tt Time \ velx \ vely \ velz}]
\end{deflist}
\item[(., /, END)]
\end{deflist}
\item[(., /, END)]
\end{deflist}

\noindent{\bf Explanation:}

\noindent{\bf Example:}
\begin{verbatim}
VELOCITY_DATASET
UNITS cm/h
CYCLIC ! cycles the data set using last time as offset
:INTERPOLATION STEP ! interpolation method (step [default] or linear)
VELOCITY
:time velx vely velz
:time units = time unit in velocity units
0.d0       1.38333d0 0.d0 0.d0 
12.d0     -1.38333d0 0.d0 0.d0 
24.d0      1.38333d0 0.d0 0.d0 
/
/
\end{verbatim}

%========================================================================

\newpage
\protect\hypertarget{target_wallclk}{}

\subsection{Keyword: WALLCLOCK\_STOP}
%\shadowbox{
%\begin{minipage}{6.5in}
\begin{deflist}{0000000000}
\item[WALLCLOCK\_STOP] wallclock\_stop\_time
\end{deflist}

\noindent{\bf Explanation:}

\noindent{\bf Example:}

%========================================================================
%========================================================================
%========================================================================
\newpage
\section{Example Input Files}

\subsection{Richards Equation}

\footnotesize
\begin{verbatim}
:Description: 1D test problem for tracer transport

:=========================== flow mode ========================================
MODE RICHARDS

:=========================== chemistry ========================================
CHEMISTRY
PRIMARY_SPECIES
Tracer
/
/

:=========================== solver options ===================================
TIMESTEPPER
MAX_STEPS 10
TS_ACCELERATION 8
/

NEWTON_SOLVER FLOW
:RTOL 1.d-4
:ATOL 1.d-4
:STOL 1.e-60
:DTOL 1.e4
:ITOL_UPDATE 1.d0
:NO_INFINITY_NORM
::NO_PRINT_CONVERGENCE
:PRINT_DETAILED_CONVERGENCE
/

LINEAR_SOLVER FLOW
KSP_TYPE GMRES
PC_TYPE NONE
:KSP_TYPE PREONLY
:PC_TYPE LU
:SOLVER GMRES
/

NEWTON_SOLVER TRANSPORT
:RTOL 1.d-4
:ATOL 1.d-4
:STOL 1.e-60
:DTOL 1.e4
:ITOL_UPDATE 1.d-4
NO_INFINITY_NORM
:NO_PRINT_CONVERGENCE
:PRINT_DETAILED_CONVERGENCE
/

LINEAR_SOLVER TRANSPORT
KSP_TYPE GMRES
PC_TYPE NONE
:KSP_TYPE PREONLY
:PC_TYPE LU
:SOLVER GMRES
/

:=========================== discretization ===================================
GRID
TYPE structured
ORIGIN 0.d0 0.d0 0.d0
NXYZ 32 32 32
BOUNDS
0.d0 100.d0
0.d0 100.d0
0.d0 100.d0
/
END

:=========================== fluid properties =================================
FLUID_PROPERTY 
DIFFUSION_COEFFICIENT 1.d-9
/

:=========================== material properties ==============================
MATERIAL_PROPERTY soil1
ID 1
POROSITY 0.25d0
TORTUOSITY 1.d0
SATURATION_FUNCTION default
PERMEABILITY
PERM_X 1.d-12
PERM_Y 1.d-12
PERM_Z 1.d-12
/
/

MATERIAL_PROPERTY soil2
ID 2
POROSITY 0.25d0
TORTUOSITY 1.d0
SATURATION_FUNCTION default
PERMEABILITY
PERM_X 5.d-13
PERM_Y 5.d-13
PERM_Z 5.d-13
/
/

:=========================== saturation functions =============================
SATURATION_FUNCTION default
/

:=========================== output options ===================================
OUTPUT
:MASS_BALANCE
TIMES y 0.25d0 0.5d0 0.75d0
FORMAT TECPLOT BLOCK
VELOCITIES
/

:=========================== times ============================================
TIME
FINAL_TIME 1.d0 y
INITIAL_TIMESTEP_SIZE 1.d-3 y
MAXIMUM_TIMESTEP_SIZE 1.d-1 y
/

:=========================== regions ==========================================
REGION all
COORDINATES
0.d0 0.d0 0.d0
100.d0 100.d0 100.d0
/
END

REGION top_layer
COORDINATES
0.d0 0.d0 60.d0
100.d0 100.d0 100.d0
/
END

REGION bottom_layer
COORDINATES
0.d0 0.d0 0.d0
100.d0 100.d0 60.d0
/
END

REGION west
FACE WEST
COORDINATES
0.d0 0.d0 0.d0
0.d0 100.d0 100.d0
/
END

REGION east
FACE EAST
COORDINATES
100.d0 0.d0 0.d0
100.d0 100.d0 100.d0
/
END

REGION north
FACE NORTH
COORDINATES
0.d0 100.d0 0.d0
100.d0 100.d0 100.d0
/
END

REGION south
FACE SOUTH
COORDINATES
0.d0 0.d0 0.d0
100.d0 0.d0 100.d0
/
END

REGION top
FACE TOP
COORDINATES
0.d0 0.d0 100.d0
100.d0 100.d0 100.d0
/
END

REGION bottom
FACE BOTTOM
COORDINATES
0.d0 0.d0 0.d0
100.d0 100.d0 0.d0
/
END

REGION well
COORDINATES
50.d0 50.d0 50.d0
50.d0 50.d0 50.d0
/
END

:=========================== flow conditions ==================================
FLOW_CONDITION initial
TYPE
PRESSURE hydrostatic
/
PRESSURE 1956741.84 ! 200 meter piezometric head (200*997.32*9.81)
/

FLOW_CONDITION source
TYPE
RATE volumetric_rate
/
RATE 2.77777778d-3  ! 10 m^3/hr
/

:=========================== transport conditions =============================
TRANSPORT_CONDITION initial
TYPE zero_gradient
CONSTRAINT_LIST
0.d0 initial
/
END

TRANSPORT_CONDITION source
TYPE dirichlet
CONSTRAINT_LIST
0.d0 well
/
/

:=========================== constraints ======================================
CONSTRAINT well
CONCENTRATIONS
Tracer 1.d0 T
/
END

CONSTRAINT initial
CONCENTRATIONS
Tracer 1.d-40 T
/
END

:=========================== condition couplers ===============================
: initial condition
INITIAL_CONDITION
FLOW_CONDITION initial
TRANSPORT_CONDITION initial
REGION all
END

: west boundary condition
BOUNDARY_CONDITION west
FLOW_CONDITION initial
TRANSPORT_CONDITION initial
REGION west
END

: east boundary condition
BOUNDARY_CONDITION east
FLOW_CONDITION initial
TRANSPORT_CONDITION initial
REGION east
END

: north boundary condition
BOUNDARY_CONDITION north
FLOW_CONDITION initial
TRANSPORT_CONDITION initial
REGION north
END

: south boundary condition
BOUNDARY_CONDITION south
FLOW_CONDITION initial
TRANSPORT_CONDITION initial
REGION south
END

: top boundary condition
BOUNDARY_CONDITION top
FLOW_CONDITION initial
TRANSPORT_CONDITION initial
REGION top
END

: bottom boundary condition
BOUNDARY_CONDITION bottom
FLOW_CONDITION initial
TRANSPORT_CONDITION initial
REGION bottom
END

: well source/sink
SOURCE_SINK well
FLOW_CONDITION source
TRANSPORT_CONDITION source
REGION well
END

:=========================== stratigraphy couplers ============================
STRATA
REGION top_layer
MATERIAL soil1
END

STRATA
REGION bottom_layer
MATERIAL soil1
END

\end{verbatim}

\normalsize

\subsection{Carbon Sequestration Problem with Reaction with Calcite}

\footnotesize
\begin{verbatim}
MODE FLASH2
:MODE MPHASE

:CHECKPOINT 100
:RESTART pflotran.chk800

:=========================== discretization ===================================
GRID
TYPE structured
ORIGIN 0.d0 0.d0 0.d0
NXYZ 160  160  25
BOUNDS
0.d0 7000.d0
0.d0 7000.d0
0.d0 250.d0
/
END

:PROC 2 1 1

:=========================== solver options ===================================
TIMESTEPPER
:MAX_STEPS 50
TS_ACCELERATION 8
MAX_PRESSURE_CHANGE 5.D4
MAX_TEMPERATURE_CHANGE 2.D0   
MAX_CONCENTRATION_CHANGE 0.005
MAX_SATURATION_CHANGE  0.01
/

NEWTON_SOLVER FLOW
ATOL 1D-8
RTOL 1D-8
STOL 1D-30
DTOL 1D15
ITOL 1D-8
MAXIT 25
MAXF 100
END
:

:=========================== times ============================================
TIME
FINAL_TIME 300.d0 y
INITIAL_TIMESTEP_SIZE 1.d-3 y
MAXIMUM_TIMESTEP_SIZE 0.05 y at 10 y
MAXIMUM_TIMESTEP_SIZE 0.1 y at 100 y
MAXIMUM_TIMESTEP_SIZE 0.25 y at 200 y
MAXIMUM_TIMESTEP_SIZE 0.5 y at 300 y
MAXIMUM_TIMESTEP_SIZE 1. y at 500 y
MAXIMUM_TIMESTEP_SIZE 2.5 y at 1000 y
/

:=========================== output options ===================================
OUTPUT
MASS_BALANCE
TIMES y 10. 50. 100. 200. 300.
FORMAT TECPLOT BLOCK
:FORMAT TECPLOT POINT
VELOCITIES
/

:=========================== fluid properties =================================
FLUID_PROPERTY
DIFFUSION_COEFFICIENT 1.d-9
/

:=========================== material properties ==============================
MATERIAL_PROPERTY rock2
ID 1
POROSITY 0.38d0
TORTUOSITY 1d-1
ROCK_DENSITY 2.65E3
SPECIFIC_HEAT 1E3
THERMAL_CONDUCTIVITY_DRY 0.5
THERMAL_CONDUCTIVITY_WET 0.5 
SATURATION_FUNCTION sf2
PERMEABILITY
PERM_X 2.d-12
PERM_Y 2.d-12
PERM_Z 2.d-12
/
/

:=========================== saturation functions =============================
SATURATION_FUNCTION sf2
PERMEABILITY_FUNCTION_TYPE PRUESS_1
SATURATION_FUNCTION_TYPE PRUESS_1
RESIDUAL_SATURATION LIQUID_PHASE 0.25
RESIDUAL_SATURATION GAS_PHASE 0.1
LAMBDA 0.75d0
ALPHA 5d-3
MAX_CAPILLARY_PRESSURE 1.d6
BETAC 2.d0
POWER 1.d0
/

:=========================== regions ==========================================
REGION all
COORDINATES
0.d0   0.d0 0.d0
7000.D0 7000.D0 250.D0
/
END

REGION west
FACE WEST
COORDINATES
0.d0 0.d0 0.d0
0.d0 7000.d0 250.d0
/
END

REGION east
FACE EAST
COORDINATES
7000.d0 0.d0 0.d0
7000.d0 7000.d0 250.d0
/
END

REGION well
BLOCK 77 84 77 84 5 5
:COORDINATES
:50.d0 0.d0 50.d0
:51.d0 1.d0 51.d0
/
:END

:=========================== flow conditions ==================================
FLOW_CONDITION initial
UNITS Pa,C,M,yr
TYPE
PRESSURE hydrostatic
TEMPERATURE zero_gradient
CONCENTRATION zero_gradient
/
IPHASE 1
PRESSURE 2D7 2D7
TEMPERATURE 50 C
CONCENTRATION 1d-6 M
ENTHALPY 0.d0 0.d0
/

skip
FLOW_CONDITION top
UNITS Pa,C,M,yr
TYPE
PRESSURE dirichlet
TEMPERATURE zero_gradient
CONCENTRATION zero_gradient
/
IPHASE 1
PRESSURE 2D7 2D7
TEMPERATURE 50
CONCENTRATION 1d-6
ENTHALPY 0.d0 0.d0
/
noskip

FLOW_CONDITION side
UNITS Pa,C,M,yr
TYPE
PRESSURE hydrostatic
:PRESSURE dirichlet
TEMPERATURE zero_gradient
CONCENTRATION zero_gradient
/
IPHASE 1
PRESSURE 2D7 2D7
TEMPERATURE 50
CONCENTRATION 1d-6
ENTHALPY 0.d0 0.d0
/

FLOW_CONDITION source
UNITS Pa,C,M,yr
TYPE
PRESSURE mass_rate
TEMPERATURE dirichlet
CONCENTRATION dirichlet
/
PRESSURE file c2i.txt  ! kg/s
TEMPERATURE 50.d0
CONCENTRATION 0.D0
ENTHALPY 0.d0 0.d0
/

:=========================== condition couplers ===============================
: initial condition
INITIAL_CONDITION
FLOW_CONDITION initial
REGION all
END

: top boundary condition
:BOUNDARY_CONDITION top
:FLOW_CONDITION top
:REGION top
:END

: boundary condition
BOUNDARY_CONDITION east
FLOW_CONDITION side
REGION east
END

BOUNDARY_CONDITION west
FLOW_CONDITION side
REGION west
END

SOURCE_SINK
FLOW_CONDITION source
REGION well
END

:=========================== stratigraphy couplers ============================
STRATA
REGION all
MATERIAL rock2
END

\end{verbatim}

\normalsize

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{comment}
\section{PFLOTRAN Objects}

This section gives an overview in alphabetical order of the objects and their data structures used in PFLOTRAN. The upper most object is {\bf Simulation} followed by {\bf Realization}, followed by {\bf Level}, {\bf Patch} and {\bf Grid}.

\begin{longtable}{ll}%[h]%\centering
%\caption{PFLOTRAN Keywords}\label{flkeywd}

%\vspace{4mm}

%\begin{tabular}{lll}
\toprule[1.5pt]
\multicolumn{1}{c}{Object} & \multicolumn{1}{c}{Description}\\
\midrule[1pt]
\hyperlink{target_obj_breakthrough}{Breakthrough} & \\
\hyperlink{target_obj_cond}{Condition} & \\
\hyperlink{target_obj_conn}{Connection} & \\
\hyperlink{target_obj_coupler}{Coupler} & \\
\hyperlink{target_obj_discretization}{Discretization} & \\
\hyperlink{target_obj_field}{Field} & \\
\hyperlink{target_obj_grid}{Grid} & \\
\hyperlink{target_obj_level}{Level} & \\
\hyperlink{target_obj_logging}{Logging} & \\
\hyperlink{target_obj_mat}{Material} & \\
\hyperlink{target_obj_option}{Option} & \\
\hyperlink{target_obj_patch}{Patch} & \\
\hyperlink{target_obj_real}{Realization} & \\
\hyperlink{target_obj_region}{Region} & \\
\hyperlink{target_obj_richards}{Richards} & \\
\hyperlink{target_obj_richards_lite}{Richards\_lite} & \\
\hyperlink{target_obj_simulation}{Simulation} & \\
\hyperlink{target_obj_solver}{Solver} & \\
\hyperlink{target_obj_stepper}{Stepper} & \\
\hyperlink{target_obj_strata}{Strata} & \\
\hyperlink{target_obj_structured_grid}{Structured\_grid} & \\
\hyperlink{target_obj_waypoint}{Waypoint} & \\
\bottomrule[1.5pt]
%\end{tabular}
\end{longtable}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\protect\hypertarget{target_obj_breakthrough}{}
\subsection{Breakthrough}

\begin{verbatim}
  type, public :: breakthrough_type
    ! all added variables must be included in BreakthroughCreateFromBreakthrough
    PetscInt :: id
    PetscTruth :: print_velocities
    character(len=MAXWORDLENGTH) :: name
    character(len=MAXWORDLENGTH) :: region_name
    type(region_type), pointer :: region
    type(breakthrough_type), pointer :: next
  end type breakthrough_type

  type, public :: breakthrough_list_type
    PetscInt :: num_breakthroughs
    type(breakthrough_type), pointer :: first
    type(breakthrough_type), pointer :: last
    type(breakthrough_type), pointer :: array(:)
  end type breakthrough_list_type
\end{verbatim}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\protect\hypertarget{target_obj_cond}{}
\subsection{Condition}

\begin{verbatim}
  type, public :: condition_dataset_type
    PetscInt :: rank
    logical :: is_transient
    logical :: is_cyclic
    PetscInt :: interpolation_method
    PetscReal, pointer :: times(:)
    PetscReal, pointer :: values(:,:)
    PetscReal, pointer :: cur_value(:)
    PetscInt :: cur_time_index
    PetscInt :: max_time_index
  end type condition_dataset_type

  type, public :: condition_type
    PetscInt :: id                    ! id from which condition can be referenced
    character(len=MAXWORDLENGTH) :: class ! character string describing class of
                                            condition
    PetscInt :: iclass                            ! integer id for class
    logical :: sync_time_with_update
    character(len=MAXWORDLENGTH) :: name ! name of condition (e.g. initial,
                                           recharge)
    PetscInt :: num_sub_conditions
    PetscInt :: iphase
    PetscInt, pointer :: itype(:)
    character(len=MAXWORDLENGTH) :: time_units
    character(len=MAXWORDLENGTH) :: length_units
    type(sub_condition_type), pointer :: pressure
    type(sub_condition_type), pointer :: temperature
    type(sub_condition_type), pointer :: concentration
    type(sub_condition_type), pointer :: enthalpy
    type(sub_condition_ptr_type), pointer :: sub_condition_ptr(:)
    type(condition_type), pointer :: next ! pointer to next condition_type for
                                            linked-lists
  end type condition_type

  type, public :: sub_condition_type
    PetscInt :: itype                  ! integer describing type of condition
    character(len=MAXWORDLENGTH) :: ctype ! character string describing type of
                                            condition
    character(len=MAXWORDLENGTH) :: units      ! units

    type(condition_dataset_type) :: datum
    type(condition_dataset_type) :: gradient
    type(condition_dataset_type) :: dataset

  end type sub_condition_type

  type, public :: sub_condition_ptr_type
    type(sub_condition_type), pointer :: ptr
  end type sub_condition_ptr_type

  type, public :: condition_ptr_type
    type(condition_type), pointer :: ptr
  end type condition_ptr_type

  type, public :: condition_list_type
    PetscInt :: num_conditions
    type(condition_type), pointer :: first
    type(condition_type), pointer :: last
    type(condition_ptr_type), pointer :: array(:)
  end type condition_list_type
\end{verbatim}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\protect\hypertarget{target_obj_conn}{}
\subsection{Connection}

\begin{verbatim}
  type, public :: connection_set_type
    PetscInt :: id
    PetscInt :: itype                  ! connection type (boundary, internal,
                                         source sink
    PetscInt :: num_connections
    PetscInt, pointer :: id_up(:)      ! list of ids of upwind cells
    PetscInt, pointer :: id_dn(:)      ! list of ids of downwind cells
    PetscReal, pointer :: dist(:,:)    ! list of distance vectors,
                                         size(-1:3,num_connections) where
                                      !   -1 = fraction upwind
                                      !   0 = magnitude of distance
                                      !   1-3 = components of unit vector
    PetscReal, pointer :: area(:)        ! list of areas of faces normal to
                                           distance vectors
!    PetscReal, pointer :: velocity(:,:)  ! velocity scalars for each phase
    type(connection_set_type), pointer :: next
  end type connection_set_type


  ! pointer data structure required for making an array of region pointers in F90
  type, public :: connection_set_ptr_type
    type(connection_set_type), pointer :: ptr           ! pointer to the
                                                          connection_set_type
  end type connection_set_ptr_type

  type, public :: connection_set_list_type
    PetscInt :: num_connection_objects
    type(connection_set_type), pointer :: first
    type(connection_set_type), pointer :: last
    type(connection_set_ptr_type), pointer :: array(:)
  end type connection_set_list_type
\end{verbatim}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\protect\hypertarget{target_obj_coupler}{}
\subsection{Coupler}

\begin{verbatim}
  type, public :: coupler_type
    PetscInt :: id                                       ! id of coupler
    PetscInt :: itype                                    ! integer defining type
    character(len=MAXWORDLENGTH) :: ctype        ! character string defining type
    character(len=MAXWORDLENGTH) :: condition_name      ! character string
                                         defining name of condition to be applied
    character(len=MAXWORDLENGTH) :: region_name         ! character string
                                         defining name of region to be applied
    PetscInt :: icondition          ! id of condition in condition array/list
    PetscInt :: iregion             ! id of region in region array/list
    PetscInt :: iface                               ! for structured grids only
    PetscInt, pointer :: aux_int_var(:,:) ! auxilliary array for integer value
    PetscReal, pointer :: aux_real_var(:,:) ! auxilliary array for real values
    type(condition_type), pointer :: condition          ! pointer to condition in
                                                          condition array/list
    type(region_type), pointer :: region                ! pointer to region in
                                                          region array/list
    type(connection_type), pointer :: connection        ! pointer to an array/list
                                                          of connections
    type(coupler_type), pointer :: next                 ! pointer to next coupler
  end type coupler_type

  type, public :: coupler_ptr_type
    type(coupler_type), pointer :: ptr
  end type coupler_ptr_type

  type, public :: coupler_list_type
    PetscInt :: num_couplers
    type(coupler_type), pointer :: first
    type(coupler_type), pointer :: last
    type(coupler_ptr_type), pointer :: array(:)
  end type coupler_list_type
\end{verbatim}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\protect\hypertarget{target_obj_discretization}{}
\subsection{Discretization}

\begin{verbatim}
  type, public :: discretization_type
    PetscInt :: itype ! type of discretization (e.g. structured, unstructured,
                        etc.)
    character(len=MAXWORDLENGTH) :: ctype
    type(grid_type), pointer :: grid  ! pointer to a grid object
    type(amrgrid_type), pointer :: amrgrid  ! pointer to an amr grid object
    DM :: dm_1_dof, dm_nflowdof, dm_ntrandof
  end type discretization_type
\end{verbatim}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\protect\hypertarget{target_obj_field}{}
\subsection{Field}

\begin{verbatim}
  type, public :: field_type

!geh material id
    ! 1 degree of freedom
    Vec :: porosity0, porosity_loc
    Vec :: tor_loc
    Vec :: ithrm_loc
    Vec :: icap_loc
    Vec :: iphas_loc, iphas_old_loc

    Vec :: perm_xx_loc, perm_yy_loc, perm_zz_loc
    Vec :: perm0_xx, perm0_yy, perm0_zz, perm_pow

    Vec :: saturation_loc, density_loc

    Vec :: volume

    ! residual vectors
    Vec :: flow_r
    Vec :: tran_r

    ! Solution vectors
    Vec :: flow_xx, flow_xx_loc, flow_dxx, flow_yy, flow_accum
    Vec :: tran_xx, tran_xx_loc, tran_dxx, tran_yy, tran_accum

  end type field_type
\end{verbatim}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\protect\hypertarget{target_obj_grid}{}
\subsection{Grid}

\begin{verbatim}
  type, public :: grid_type

    character(len=MAXWORDLENGTH) :: ctype
    PetscInt :: itype  ! type of grid (e.g. structured, unstructured, etc.)

    PetscInt :: nmax   ! Total number of nodes in global domain
    PetscInt :: nlmax  ! Total number of non-ghosted nodes in local domain.
    PetscInt :: ngmax  ! Number of ghosted & non-ghosted nodes in local domain.

    !nL2G :  not collective, local processor: local  =>  ghosted local
    !nG2L :  not collective, local processor:  ghosted local => local
    !nG2N :  collective,  ghosted local => global index , used for
    !                     matsetvaluesblocked ( not matsetvaluesblockedlocal)
    !nL2A :   collective, local => natural index, used for initialization
    !                              and source/sink setup
    PetscInt, pointer :: nL2G(:), nG2L(:), nL2A(:)
    PetscInt, pointer :: nG2A(:)

    PetscReal, pointer :: x(:), y(:), z(:)

    PetscReal :: x_min, x_max, y_min, y_max, z_min, z_max

    PetscInt, pointer :: hash(:,:,:)
    PetscInt :: num_hash_bins

    type(structured_grid_type), pointer :: structured_grid
    type(unstructured_grid_type), pointer :: unstructured_grid

    type(connection_list_type), pointer :: internal_connection_list

  end type grid_type
\end{verbatim}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\protect\hypertarget{target_obj_level}{}
\subsection{Level}

\begin{verbatim}
  type, public :: level_type

    PetscInt :: id
    type(patch_list_type), pointer :: patch_list
    type(level_type), pointer :: next

  end type level_type

  ! pointer data structure required for making an array of level pointers in F90
  type, public :: level_ptr_type
    type(level_type), pointer :: ptr           ! pointer to the level_type
  end type level_ptr_type

  type, public :: level_list_type
    PetscInt :: num_level_objects
    type(level_type), pointer :: first
    type(level_type), pointer :: last
    type(level_ptr_type), pointer :: array(:)
  end type level_list_type
\end{verbatim}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\protect\hypertarget{target_obj_logging}{}
\subsection{Logging}

\begin{verbatim}
  type, public :: logging_type

    PetscInt :: stage(10)

    PetscInt :: class_pflotran

    PetscEvent :: event_init
    PetscEvent :: event_setup

    PetscEvent :: event_restart
    PetscEvent :: event_checkpoint

    PetscEvent :: event_condition_read
    PetscEvent :: event_condition_read_values

    PetscEvent :: event_h5dread_f
    PetscEvent :: event_h5dwrite_f
    PetscEvent :: event_read_indices_hdf5
    PetscEvent :: event_map_indices_hdf5
    PetscEvent :: event_hash_create
    PetscEvent :: event_hash_map
    PetscEvent :: event_read_real_array_hdf5
    PetscEvent :: event_read_int_array_hdf5
    PetscEvent :: event_write_real_array_hdf5
    PetscEvent :: event_write_int_array_hdf5
    PetscEvent :: event_read_array_hdf5
    PetscEvent :: event_write_struct_dataset_hdf5
    PetscEvent :: event_region_read_hdf5
    PetscEvent :: event_region_read_ascii
    PetscEvent :: event_material_read_hdf5

    PetscEvent :: event_output_tecplot
    PetscEvent :: event_output_hdf5
    PetscEvent :: event_output_str_grid_tecplot
    PetscEvent :: event_output_write_tecplot
    PetscEvent :: event_output_write_flux_tecplot
    PetscEvent :: event_output_get_var_from_array
    PetscEvent :: event_output_get_cell_vel
    PetscEvent :: event_output_vec_tecplot
    PetscEvent :: event_output_breakthrough
    PetscEvent :: event_output_coordinates_hdf5

  end type logging_type
\end{verbatim}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\protect\hypertarget{target_obj_mat}{}
\subsection{Material}

\begin{verbatim}
  type, public :: material_type
    PetscInt :: id
    character(len=MAXWORDLENGTH) :: name
    PetscReal :: permeability(3,3)
    PetscReal :: permeability_pwr
    PetscReal :: porosity
    PetscReal :: tortuosity
    PetscInt :: ithrm
    PetscInt :: icap
    type(material_type), pointer :: next
  end type material_type

  type, public :: material_ptr_type
    type(material_type), pointer :: ptr
  end type material_ptr_type

  type, public :: thermal_property_type
    PetscInt :: id
    PetscReal :: rock_density
    PetscReal :: spec_heat
    PetscReal :: therm_cond_dry
    PetscReal :: therm_cond_wet
    PetscReal :: pore_compress
    PetscReal :: pore_expansivity
    PetscReal :: tort_bin_diff
    PetscReal :: vap_air_diff_coef
    PetscReal :: exp_binary_diff
    PetscReal :: enh_binary_diff_coef
    type(thermal_property_type), pointer :: next
  end type thermal_property_type

  type, public :: saturation_function_type
    PetscInt :: id
    character(len=MAXWORDLENGTH) :: saturation_function_ctype
    PetscInt :: saturation_function_itype
    character(len=MAXWORDLENGTH) :: permeability_function_ctype
    PetscInt :: permeability_function_itype
    PetscReal, pointer :: Sr(:)
    PetscReal :: m
    PetscReal :: lambda
    PetscReal :: alpha
    PetscReal :: pcwmax
    PetscReal :: betac
    PetscReal :: power
    PetscInt :: ihist
    PetscReal :: BC_pressure_low
    PetscReal :: BC_pressure_high
    PetscReal :: BC_spline_coefficients(4)
    type(saturation_function_type), pointer :: next
  end type saturation_function_type

  type, public :: saturation_function_ptr_type
    type(saturation_function_type), pointer :: ptr
  end type saturation_function_ptr_type
\end{verbatim}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\protect\hypertarget{target_obj_option}{}
\subsection{Option}

\begin{verbatim}
  type, public :: option_type

    PetscMPIInt :: myrank                    ! rank in PETSC_COMM_WORLD
    PetscMPIInt :: commsize                  ! size of PETSC_COMM_WORLD

    ! defines the mode (e.g. mph, richards, vadose, etc.
    character(len=MAXWORDLENGTH) :: flowmode
    PetscInt :: iflowmode
    character(len=MAXWORDLENGTH) :: tranmode
    PetscInt :: itranmode

    PetscInt :: nphase
    PetscInt :: nflowdof
    PetscInt :: nspec

    PetscInt :: ntrandof
    PetscInt :: ncomp

    PetscReal :: uniform_velocity(3)

    ! Program options
    PetscTruth :: use_matrix_free  ! If true, do not form the Jacobian.

    PetscInt :: imod

    PetscTruth :: use_isoth

    character(len=MAXWORDLENGTH) :: generalized_grid
    logical :: use_generalized_grid

    PetscReal :: flow_time, tran_time, time  ! The time elapsed in the simulation.
    PetscReal :: flow_dt, tran_dt, dt ! The size of the time step.

!    PetscReal, pointer :: tplot(:)
    PetscReal, pointer :: tfac(:)
      ! An array of multiplicative factors that specify how to increase time step.

    PetscInt :: iblkfmt ! blocked format

      ! Basically our target number of newton iterations per time step.
    PetscReal :: dpmxe,dtmpmxe,dsmxe,dcmxe !maximum allowed changes in field vars.
    PetscReal :: dpmax,dtmpmax,dsmax,dcmax

    PetscReal :: scale
    PetscReal, pointer :: rock_density(:),cpr(:),dencpr(:),ckdry(:),ckwet(:), &
                          tau(:),cdiff(:),cexp(:)
    PetscReal, pointer :: swir(:),lambda(:),alpha(:),pckrm(:),pcwmax(:), &
                          pcbetac(:),pwrprm(:),sir(:,:)
    PetscInt, pointer:: icaptype(:)

    PetscReal :: m_nacl
    PetscReal :: difaq, delhaq, gravity(3), fmwh2o= 18.0153D0, fmwa=28.96D0, &
              fmwco2=44.0098D0, eqkair, ret=1.d0, fc=1.d0

    PetscInt :: ideriv
    PetscReal :: tref,pref

    PetscReal :: disp

!   table lookup
    PetscInt :: itable=0

    PetscTruth :: restart_flag
    PetscReal :: restart_time
    character(len=MAXWORDLENGTH) :: restart_file
    PetscTruth :: checkpoint_flag
    PetscInt :: checkpoint_frequency

    PetscLogDouble :: start_time
    PetscTruth :: wallclock_stop_flag
    PetscLogDouble :: wallclock_stop_time

    PetscInt :: log_stage(10)

    logical :: numerical_derivatives
    logical :: compute_statistics
    logical :: use_touch_options
    logical :: overwrite_restart_transport
    PetscInt :: io_handshake_buffer_size

    character(len=MAXWORDLENGTH) :: permx_filename
    character(len=MAXWORDLENGTH) :: permy_filename
    character(len=MAXWORDLENGTH) :: permz_filename

  end type option_type

  type, public :: output_option_type

    character(len=2) :: tunit
    PetscReal :: tconv

    logical :: print_hdf5
    logical :: print_hdf5_velocities
    logical :: print_hdf5_flux_velocities

    logical :: print_tecplot
    logical :: print_tecplot_velocities
    logical :: print_tecplot_flux_velocities

    PetscInt :: plot_number
    character(len=MAXWORDLENGTH) :: plot_name

  end type output_option_type
\end{verbatim}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\protect\hypertarget{target_obj_patch}{}
\subsection{Patch}

\begin{verbatim}
  type, public :: patch_type

    PetscInt :: id

    ! thiese arrays will be used by all modes, mode-specific arrays should
    ! go in the auxilliary data stucture for that mode
    PetscInt, pointer :: imat(:)
    PetscReal, pointer :: internal_velocities(:,:)
    PetscReal, pointer :: boundary_velocities(:,:)

    type(grid_type), pointer :: grid

    type(region_list_type), pointer :: regions

    type(coupler_list_type), pointer :: transport_boundary_conditions
    type(coupler_list_type), pointer :: transport_initial_conditions
    type(coupler_list_type), pointer :: transport_source_sinks

    type(coupler_list_type), pointer :: flow_boundary_conditions
    type(coupler_list_type), pointer :: flow_initial_conditions
    type(coupler_list_type), pointer :: flow_source_sinks

    type(strata_list_type), pointer :: strata
    type(breakthrough_list_type), pointer :: breakthrough

    type(auxilliary_type) :: aux

    type(patch_type), pointer :: next

  end type patch_type

  ! pointer data structure required for making an array of patch pointers in F90
  type, public :: patch_ptr_type
    type(patch_type), pointer :: ptr           ! pointer to the patch_type
  end type patch_ptr_type

  type, public :: patch_list_type
    PetscInt :: num_patch_objects
    type(patch_type), pointer :: first
    type(patch_type), pointer :: last
    type(patch_ptr_type), pointer :: array(:)
  end type patch_list_type
\end{verbatim}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\protect\hypertarget{target_obj_real}{}
\subsection{Realization}

\begin{verbatim}
  type, public :: realization_type

    type(discretization_type), pointer :: discretization
    type(level_list_type), pointer :: level_list
    type(patch_type), pointer :: patch

    type(option_type), pointer :: option
    type(field_type), pointer :: field
    type(pflow_debug_type), pointer :: debug
    type(output_option_type), pointer :: output_option

    type(region_list_type), pointer :: regions
    type(condition_list_type), pointer :: flow_conditions
    type(condition_list_type), pointer :: transport_conditions

    type(material_type), pointer :: materials
    type(material_ptr_type), pointer :: material_array(:)
    type(thermal_property_type), pointer :: thermal_properties
    type(saturation_function_type), pointer :: saturation_functions
    type(saturation_function_ptr_type), pointer :: saturation_function_array(:)

    type(waypoint_list_type), pointer :: waypoints

  end type realization_type
\end{verbatim}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\protect\hypertarget{target_obj_region}{}
\subsection{Region}

\begin{verbatim}
  type, public :: block_type
    PetscInt :: i1,i2,j1,j2,k1,k2
    type(block_type), pointer :: next
  end type block_type

  type, public :: region_type
    PetscInt :: id
    character(len=MAXWORDLENGTH) :: name
    character(len=MAXWORDLENGTH) :: filename
    PetscInt :: i1,i2,j1,j2,k1,k2
    PetscReal :: coordinate(3)
    PetscInt :: iface
    PetscInt :: num_cells
    PetscInt, pointer :: cell_ids(:)
    PetscInt, pointer :: faces(:)
    type(region_type), pointer :: next
  end type region_type

  type, public :: region_ptr_type
    type(region_type), pointer :: ptr
  end type region_ptr_type

  type, public :: region_list_type
    PetscInt :: num_regions
    type(region_type), pointer :: first
    type(region_type), pointer :: last
    type(region_type), pointer :: array(:)
  end type region_list_type
\end{verbatim}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\protect\hypertarget{target_obj_richards}{}
\subsection{Richards}

\begin{verbatim}
  type, public :: richards_auxvar_type
    PetscReal :: pres
    PetscReal :: temp
    PetscReal :: sat
    PetscReal :: den
    PetscReal :: den_kg
    PetscReal :: avgmw
    PetscReal :: h
    PetscReal :: u
    PetscReal :: pc
!    PetscReal :: vis
!    PetscReal :: dvis_dp
!    PetscReal :: kr
!    PetscReal :: dkr_dp
    PetscReal :: kvr
    PetscReal :: dsat_dp
    PetscReal :: dden_dp
    PetscReal :: dden_dt
    PetscReal :: dkvr_dp
    PetscReal :: dkvr_dt
    PetscReal :: dh_dp
    PetscReal :: dh_dt
    PetscReal :: du_dp
    PetscReal :: du_dt
    PetscReal, pointer :: xmol(:)
    PetscReal, pointer :: diff(:)
  end type richards_auxvar_type

  type, public :: richards_type
    PetscInt :: n_zero_rows
    PetscInt, pointer :: zero_rows_local(:), zero_rows_local_ghosted(:)

    logical :: aux_vars_up_to_date
    logical :: inactive_cells_exist
    PetscInt :: num_aux, num_aux_bc
    type(richards_auxvar_type), pointer :: aux_vars(:)
    type(richards_auxvar_type), pointer :: aux_vars_bc(:)
  end type richards_type
\end{verbatim}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\protect\hypertarget{target_obj_richards_lite}{}
\subsection{Richards\_lite}

\begin{verbatim}
  type, public :: richards_lite_auxvar_type
    PetscReal :: pres
    PetscReal :: temp
    PetscReal :: sat
    PetscReal :: den
    PetscReal :: den_kg
    PetscReal :: avgmw
    PetscReal :: pc
!    PetscReal :: vis
!    PetscReal :: dvis_dp
!    PetscReal :: kr
!    PetscReal :: dkr_dp
    PetscReal :: kvr
    PetscReal :: dsat_dp
    PetscReal :: dden_dp
    PetscReal :: dkvr_dp
  end type richards_lite_auxvar_type

  type, public :: richards_lite_type
    PetscInt :: n_zero_rows
    PetscInt, pointer :: zero_rows_local(:), zero_rows_local_ghosted(:)

    logical :: aux_vars_up_to_date
    logical :: inactive_cells_exist
    PetscInt :: num_aux, num_aux_bc
    type(richards_lite_auxvar_type), pointer :: aux_vars(:)
    type(richards_lite_auxvar_type), pointer :: aux_vars_bc(:)
  end type richards_lite_type
\end{verbatim}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\protect\hypertarget{target_obj_simulation}{}
\subsection{Simulation}

\begin{verbatim}
  type, public :: simulation_type

    type(realization_type), pointer :: realization
    type(stepper_type), pointer :: flow_stepper
    type(stepper_type), pointer :: tran_stepper

  end type simulation_type
\end{verbatim}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\protect\hypertarget{target_obj_solver}{}
\subsection{Solver}

\begin{verbatim}
  type, public :: solver_type
    PetscReal :: linear_atol       ! absolute tolerance
    PetscReal :: linear_rtol       ! relative tolerance
    PetscReal :: linear_dtol       ! divergence tolerance
    PetscInt :: linear_maxit     ! maximum number of iterations

    PetscReal :: newton_atol       ! absolute tolerance
    PetscReal :: newton_rtol       ! relative tolerance
    PetscReal :: newton_stol       ! relative tolerance (relative to previous
                                     iteration)
    PetscReal :: newton_dtol       ! divergence tolerance
    PetscReal :: newton_inf_res_tol    ! infinity tolerance for residual
    PetscReal :: newton_inf_upd_tol    ! infinity tolerance for update
    PetscInt :: newton_maxit     ! maximum number of iterations
    PetscInt :: newton_maxf      ! maximum number of function evaluations

        ! Jacobian matrix
    Mat :: J
    MatFDColoring :: matfdcoloring
      ! Coloring used for computing the Jacobian via finite differences.

    ! PETSc nonlinear solver context
    SNES :: snes
    KSPType :: ksp_type
    PCType  :: pc_type
    KSP   ::  ksp
    PC    ::  pc

    PetscTruth :: inexact_newton

    PetscTruth :: print_convergence
    PetscTruth :: print_detailed_convergence
    PetscTruth :: check_infinity_norm
    PetscTruth :: force_at_least_1_iteration

  end type solver_type
\end{verbatim}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\protect\hypertarget{target_obj_stepper}{}
\subsection{Stepper}

\begin{verbatim}
  type, public :: stepper_type

    PetscInt :: steps     ! The number of time-steps taken by the code.
    PetscInt :: nstepmax  ! Maximum number of timesteps taken by the code.
    PetscInt :: icut_max  ! Maximum number of timestep cuts within one time step.
    PetscInt :: ndtcmx    ! Steps needed after cutting to increase time step
    PetscInt :: newtcum   ! Total number of Newton steps taken.
    PetscInt :: icutcum   ! Total number of cuts in the timestep taken.
    PetscInt :: iaccel    ! Accelerator index

    PetscReal :: dt_min
    PetscReal :: dt_max

    type(solver_type), pointer :: solver

    type(waypoint_type), pointer :: cur_waypoint

    type(convergence_context_type), pointer :: convergence_context

  end type stepper_type
\end{verbatim}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\protect\hypertarget{target_obj_strata}{}
\subsection{Strata}

\begin{verbatim}
  type, public :: strata_type
    PetscInt :: id                                 ! id of strata
    logical :: active
    character(len=MAXWORDLENGTH) :: material_name  ! character string defining
                                                   name of material to be applied
    character(len=MAXWORDLENGTH) :: region_name    ! character string defining
                                                   name of region to be applied
    PetscInt :: imaterial                ! id of material in material array/list
    PetscInt :: iregion                      ! id of region in region array/list
    type(material_type), pointer :: material       ! pointer to material in
                                                     material array/list
    type(region_type), pointer :: region           ! pointer to region in region
                                                     array/list
    type(strata_type), pointer :: next             ! pointer to next strata
  end type strata_type

  type, public :: strata_ptr_type
    type(strata_type), pointer :: ptr
  end type strata_ptr_type

  type, public :: strata_list_type
    PetscInt :: num_strata
    type(strata_type), pointer :: first
    type(strata_type), pointer :: last
    type(strata_ptr_type), pointer :: array(:)
  end type strata_list_type
\end{verbatim}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\protect\hypertarget{target_obj_structured_grid}{}
\subsection{Structured\_grid}

\begin{verbatim}
  type, public :: structured_grid_type

    PetscInt :: nx, ny, nz    ! Global domain dimensions of the grid.
    PetscInt :: nxy, nmax     ! nx * ny, nx * ny * nz
    PetscInt :: npx, npy, npz ! Processor partition in each direction.
    PetscInt :: nlx, nly, nlz ! Local grid dimension w/o ghost nodes.
    PetscInt :: ngx, ngy, ngz ! Local grid dimension with ghost nodes.
    PetscInt :: nxs, nys, nzs
      ! Global indices of non-ghosted corner (starting) of local domain.
    PetscInt :: ngxs, ngys, ngzs
      ! Global indices of ghosted starting corner of local domain.
    PetscInt :: nxe, nye, nze, ngxe, ngye, ngze
      ! Global indices of non-ghosted/ghosted ending corner of local domain.
    PetscInt :: nlxy, nlxz, nlyz
    PetscInt :: ngxy, ngxz, ngyz

    PetscInt :: istart, jstart, kstart, iend, jend, kend
      ! istart gives the local x-index of the non-ghosted starting (lower left)
      ! corner. iend gives the local x-index of the non-ghosted ending
      ! corner. jstart, jend correspond to y-index, kstart, kend to z-index.

    PetscInt :: nlmax  ! Total number of non-ghosted nodes in local domain.
    PetscInt :: ngmax  ! Number of ghosted & non-ghosted nodes in local domain.

    PetscReal :: origin(3)

    PetscReal, pointer :: dx0(:), dy0(:), dz0(:)

    logical :: invert_z_axis

    PetscReal, pointer :: dx(:),dy(:),dz(:),dxg(:),dyg(:),dzg(:) ! Grid spacings

    PetscFortranAddr p_samr_patch ! pointer to a SAMRAI patch object

  end type structured_grid_type
\end{verbatim}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\protect\hypertarget{target_obj_waypoint}{}
\subsection{Waypoint}

\begin{verbatim}
  type, public :: waypoint_type
    PetscReal :: time
    logical :: print_output
    type(output_option_type), pointer :: output_option
    logical :: update_bcs
    logical :: update_srcs
    PetscReal :: dt_max
    logical :: final  ! any waypoint after this will be deleted
    type(waypoint_type), pointer :: prev
    type(waypoint_type), pointer :: next
  end type waypoint_type

  type, public :: waypoint_list_type
    PetscInt :: num_waypoints
    type(waypoint_type), pointer :: first
    type(waypoint_type), pointer :: last
    type(waypoint_type), pointer :: array(:)
  end type waypoint_list_type
\end{verbatim}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage
\section{FAQ}

\subsection{\sl iobuf load errors}

It may be the case that the `iobuf'module is causing problems.  That is a module that, if it's loaded, links
with an IO buffering library. It can speed up IO considerably, but there
are have been some bugs (hopefully fixed) identified with it before.  It
is loaded by default.  You might want to try a 'module unload' of that
before building PFLOTRAN, and seeing if that works. Unfortunately, it
may be necessary to mess with the configuration files for the PETSc builds to
make sure that you don't link with the iobuf library.

\end{comment}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Adaptive Mesh Refinement: SAMRAI}

\subsection{Creating the SAMRAI input file}

\footnotesize
\begin{verbatim}
DIRICHLET = 0
NEUMANN   = 1
PERIODIC  = 2
MIXED     = 3
ROBIN     = 4

// name of pflotran specific input file
pflotran_filename="pflotran.15c.in"

CartesianGeometry{
  //  Specify lower/upper corners of the computational domain and a
  //  set of non-overlapping boxes defining domain interior.  If union 
  //  of boxes is not a parallelpiped, lower/upper corner data corresponds 
  //  to min/max corner indices over all boxes given.
  //  x_lo  -- (double array) lower corner of computational domain [REQD]
  //  x_up  -- (double array) upper corner of computational domain [REQD]
  //  domain_boxes  -- (box array) set of boxes that define interior of 
  //                   physical domain. [REQD]
  //  periodic_dimension -- (int array) coordinate directions in which 
  //                        domain is periodic.  Zero indicates not
  //                        periodic, non-zero value indicates periodicity.
  //                        [0]
  // indexing always starts at 0 for domain_boxes => 0-79 = 80 cells
  domain_boxes = [(0,0,0), (19,19,79)]
   x_lo         = 0.e0, 0.e0, 0.e0  
   x_up         = 20.e0, 20.e0, 80.e0
}

GriddingAlgorithm{
   // Information used to create patches in AMR hierarchy.
   // max_levels -- (int) max number of mesh levels in hierarchy [REQD]
   // 
   // For most of the following parameters, the number of prescribed data
   // values need not match the number of levels in the hierarchy 
   // (determined by max_levels).  If more values are given than number 
   // of levels, extraneous values will be ignored.  If less are given, then
   // values that correspond to individual levels will apply to those 
   // levels.  Missing values will be taken from those for the finest
   // level specified.
   //
   // ratio_to_coarser {
   //   level_1 -- (int array) ratio between index spaces on 
   //              level 1 to level 0 [REQD]
   //   level_2 -- (int array)  ratio between index spaces on 
   //              level 2 to level 1 [REQD]
   //   etc....
   // }
   // largest_patch_size {
   //   level_0 -- (int array) largest patch allowed on level 0. 
   //              [REQD]    
   //   level_1 -- (int array)    "       "      "   "  level 1 
   //              [level 0 entry]
   //   etc....                       
   // }
   max_levels = 7 
   largest_patch_size {
      level_0 = 20, 20, 80
      level_1 = 40, 40, 40
      // all finer levels will use same values as level_1...
   }
   smallest_patch_size {
      level_0 = 10, 10, 40
      level_1 =  5,  5, 10
      // all finer levels will use same values as level_1...
   }
   ratio_to_coarser {
      level_1  = 2, 2, 2
      // all finer levels will use same values as level_1...
   }
   combine_efficiency = 0.95
   efficiency_tolerance = 0.95
   coalesce_boxes=FALSE
   check_nonrefined_tags='i'
}

StandardTagAndInitialize{
   tagging_method = "REFINE_BOXES"
   RefineBoxes{
      // index region on level 0 to tag for refinement in level 0 indices.
      // the full index region on level 0 is [(0,0,0),(19,19,79)]
      // Note that this will create a refinement region on level 1 extending from
      // [(0,0,60*2), (19*2+1,19*2+1,79*2+1)] when refined by a factor of 2 in
      // each direction. The full index space on level one is [(0,0,0), (2*19+1,2*19+1,2*79+1)]
      level_0 = [(0,0,60),(19,19,79)]         // 0.5 m
      level_1 = [(0,0,140),(39,39,159)]       // 0.25
      level_2 = [(0,0,300),(79,79,319)]       // 0.125
      level_3 = [(0,0,620),(159,159,639)]     // 0.0625
      level_4 = [(0,0,1260),(319,319,1279)]   // 0.03125
      level_5 = [(0,0,2540),(639,639,2559)]   // 0.015625
   }
}

LoadBalancer{
   bin_pack = "SPATIAL"
}

PflotranApplicationStrategy{
   DriverMode                       = 1
   nl_tangential_coarse_fine_scheme = "LINEAR"
   nl_normal_coarse_fine_scheme     = "LINEAR"
   number_solution_components       = 3

   PflotranMultilevelOperator{
       operator_name                   = "PflotranMultilevelOperator"
	       tangent_interp_scheme           = "LINEAR"
	       normal_interp_scheme            = "LINEAR"
	       adjust_cf_coefficients          = FALSE
	       interpolate_ghost_values        = TRUE
	       extrapolation_order             = 2
	       boundary_conditions             = NEUMANN, NEUMANN, NEUMANN, NEUMANN, NEUMANN, DIRICHLET
	       coarsen_diffusive_fluxes        = TRUE
	       coarsen_convective_fluxes       = TRUE
	       print_info_level                = 0
	       cell_refine_op                  = "CONSTANT_REFINE"
	       cell_coarsen_op                 = "CONSERVATIVE_COARSEN"
	       cell_soln_coarsen_op            = "CONSERVATIVE_COARSEN"
	       cell_src_coarsen_op             = "SUM_COARSEN"
	       face_refine_op                  = "CONSTANT_REFINE"
	       face_coarsen_op                 = "CONSERVATIVE_COARSEN"
	       variable_order_interpolation    = FALSE
	       use_cf_interpolant              = TRUE
   }

   PflotranFlowPreconditioner{

     preconditioner_print_flag = FALSE

     pc_solver{
       solver_name                      = "FAC"
       max_iterations                   = 2
       max_error                        = 1.e-12
       print_info_level                 = 1 
       presolve_iterations              = 2
       postsolve_iterations             = 2
       use_visit                        = FALSE
       viz_directory                    = "fac_viz"
       zero_initial_guess               = TRUE

       level_solver_0 {
            solver_name                 = "CellHYPRELevelSolver"
            print_info_level            = 0 
            mg_solver_type              = 1
            max_iterations              = 1
            max_error                   = 1.e-12
            num_presweeps               = 2
            num_postsweeps              = 2
            preprocess_rhs              = FALSE
       }

       level_solver_1 {
            solver_name                 = "CellLevelSmoother"
            smoother_type               = "Red-black Gauss-Seidel"
            print_info_level            = 0 
            max_iterations              = 1
            max_error                   = 1.e-12
            num_sweeps                  = 10
       }
     }
   }

   PflotranTransportPreconditioner{

     preconditioner_print_flag = FALSE

     pc_solver{
       solver_name                      = "FAC"
       max_iterations                   = 2 
       max_error                        = 1.e-12
       print_info_level                 = 1 
       presolve_iterations              = 2
       postsolve_iterations             = 2
       use_visit                        = FALSE
       viz_directory                    = "fac_viz"
       zero_initial_guess               = TRUE

       level_solver_0 {
            solver_name                = "CellHYPRELevelSolver"
            print_info_level           = 0 
            mg_solver_type             = 1
            max_iterations             = 1
            max_error                  = 1.e-12
            num_presweeps              = 2
            num_postsweeps             = 2
            preprocess_rhs             = FALSE
       }

       level_solver_1 {
            solver_name                = "CellLevelSmoother"
            smoother_type              = "Red-black Gauss-Seidel"
            print_info_level           = 0 
            max_iterations             = 1
            max_error                  = 1.e-12
            num_sweeps                 = 10
       }
     } 
   }
}


TimerManager{
   timer_list = "xfer::*::*", "FAC::*::*", "AMRUtilities::*::*", "apps::main::main", \
   "RD2T::*::*", "LevelSolver::*::*"
}
\end{verbatim}

\normalsize
\section{References}

\begin{description}

\item Balay S, Eijkhout V, Gropp WD, McInnes LC and Smith BF (1997) Modern Software Tools in Scientific Computing, Eds. Arge E, Bruaset AM and Langtangen HP (Birkha\"user Press), pp. 163--202.

\item Goode, D.J. (1996) Direct simulation of groundwater age, Water Resources Research, 32, 289--296.

\item Hammond, G.E., P.C. Lichtner, C. Lu, and R.T. Mills (2011) PFLOTRAN: Reactive Flow \& Transport Code for Use on Laptops to Leadership-Class Supercomputers, Editors: Zhang, F., G. T. Yeh, and J. C. Parker,
{\em Ground Water Reactive Transport Models},
Bentham Science Publishers.
ISBN 978-1-60805-029-1. 

\end{description}

\end{document}

