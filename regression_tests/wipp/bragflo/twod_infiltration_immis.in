! Test Case #4. Two-dimensional infiltration using Ideal Gas Law
! MUST RUN THIS SIMULATION IN IMMISCIBLE PFLOTRAN
! BF = BRAGFLO
! For more descriptions of the problem please read case_4.docx


SIMULATION
  SIMULATION_TYPE SUBSURFACE
  PROCESS_MODELS
    SUBSURFACE_FLOW flow
      MODE GENERAL
      OPTIONS
        ITOL_RELATIVE_UPDATE 1.d-30  ! Turn off ITOL_RELATIVE_UPDATE criteria
        ISOTHERMAL
        MAXIMUM_PRESSURE_CHANGE 5.0D5
        TOUGH2_ITOL_SCALED_RESIDUAL 1.d-4
        GAS_COMPONENT_FORMULA_WEIGHT 2.01588D0 !H2
      /
    /
  /
END

SUBSURFACE

REGRESSION
  CELLS_PER_PROCESS 19
  CELLS
    1
    2
    3
    4
  /
END

!=========================== discretization ===================================
GRID
  TYPE structured
  ORIGIN 0.d0 0.d0 0.d0
  NXYZ 20 1 18
  DXYZ
    0.115  0.15  0.15   0.085 0.075 0.14  0.15  0.15  0.15  0.15  \
    0.15   0.15  0.15   0.15  0.15  0.155 0.18  0.20  0.20  0.20
    1.d0
    0.30  0.20  0.10  0.05  0.05  0.10  0.10  0.10  0.10  0.10  \
    0.10  0.10  0.10  0.10  0.10  0.10  0.10  0.10
  /
END

NEWTON_SOLVER FLOW
  RTOL 1.d-30       ! Turn off RTOL criteria
  ATOL 1.d-30       ! Turn off ATOL criteria
  STOL 1.d-30       ! Turn off STOL criteria
  MAXIT 20          ! Maximum newton iteration number
/

FLUID_PROPERTY
  PHASE LIQUID
  DIFFUSION_COEFFICIENT 0.d-0  ! no diffusion as BF runs on immiscible flow
END

FLUID_PROPERTY
  PHASE GAS
  DIFFUSION_COEFFICIENT 0.d-0  ! no diffusion as BF runs on immiscible flow
END

skip
TIMESTEPPER FLOW
  TS_ACCELERATION 10
  DT_FACTOR 1.5d0 1.5d0 1.5d0 1.5d0 1.5d0 0.7d0 0.7d0 0.7d0 0.7d0 0.7d0
END
noskip

FLOW_CONDITION well1  ! INJQ in BF
  TYPE
    RATE mass_rate
  /
  SYNC_TIMESTEP_WITH_UPDATE
  RATE LIST
    TIME_UNITS s
    DATA_UNITS kg/s
    0.d0 0.0047201 0.d0 0.d0
  /
/

FLOW_CONDITION well2  ! INJQ in BF
  TYPE
    RATE mass_rate
  /
  SYNC_TIMESTEP_WITH_UPDATE
  RATE LIST
    TIME_UNITS s
    DATA_UNITS kg/s
    0.d0 0.0061566 0.d0 0.d0
  /
/

FLOW_CONDITION well3  ! INJQ in BF
  TYPE
    RATE mass_rate
  /
  SYNC_TIMESTEP_WITH_UPDATE
  RATE LIST
    TIME_UNITS s
    DATA_UNITS kg/s
    0.d0 0.0061566 0.d0 0.d0
  /
/

FLOW_CONDITION well4  ! INJQ in BF
  TYPE
    RATE mass_rate
  /
  SYNC_TIMESTEP_WITH_UPDATE
  RATE LIST
    TIME_UNITS s
    DATA_UNITS kg/s
    0.d0 0.0034888 0.d0 0.d0
  /
/

REGION INJQ1
  BLOCK 1 1 1 1 18 18
/

REGION INJQ2
  BLOCK 2 2 1 1 18 18
/

REGION INJQ3
  BLOCK 3 3 1 1 18 18
/

REGION INJQ4
  BLOCK 4 4 1 1 18 18
/

FLOW_CONDITION seep1
  TYPE
    GAS_PRESSURE dirichlet
    MOLE_FRACTION dirichlet
    TEMPERATURE dirichlet
  /
  GAS_PRESSURE 0.101330D+06
  ! psat at 25 C is 3157.9744387448523
  ! at 100% humidity, p_a = p_g - p_sat
  ! mole fraction = p_a / p_g = (p_g - p_sat) / p_g
  !               = (101330. - 3157.9744387448523) / 101330.
  MOLE_FRACTION 0.97d0
  TEMPERATURE 25.d0
/

FLOW_CONDITION FC_EAST_BOUNDARY
  TYPE
    GAS_PRESSURE dirichlet
    MOLE_FRACTION dirichlet
    TEMPERATURE dirichlet
  /
  GAS_PRESSURE 0.101330D+06
  MOLE_FRACTION 0.999999999D0
  TEMPERATURE 25.d0
END

!=========================== material properties ==============================
MATERIAL_PROPERTY soil
  ID 1
  TORTUOSITY 1.0d0
  POROSITY 0.30d0
  CHARACTERISTIC_CURVES SF_soil
  ROCK_DENSITY 2650.d0
  THERMAL_CONDUCTIVITY_DRY 0.5
  THERMAL_CONDUCTIVITY_WET 2.
  HEAT_CAPACITY 830.
!  SOIL_COMPRESSIBILITY_FUNCTION BRAGFLO
!  SOIL_COMPRESSIBILITY 0.d0
!  SOIL_REFERENCE_PRESSURE 101330.d0
  PERMEABILITY
    PERM_ISO 9.95d-12
  /
END

CHARACTERISTIC_CURVES SF_soil
  SATURATION_FUNCTION BRAGFLO_KRP9
    LIQUID_RESIDUAL_SATURATION 0.d0
    MAX_CAPILLARY_PRESSURE 6.40601E+06
  /
  PERMEABILITY_FUNCTION BRAGFLO_KRP9_LIQ
    LIQUID_RESIDUAL_SATURATION 0.d0
  /
  PERMEABILITY_FUNCTION BRAGFLO_KRP9_GAS
    LIQUID_RESIDUAL_SATURATION 0.d0
    GAS_RESIDUAL_SATURATION 0.1d0
  /
END

EOS WATER
  DENSITY EXPONENTIAL 0.9984E+03 101330.d0 2.5000E-10
  ENTHALPY CONSTANT 1.8890d0
  VISCOSITY CONSTANT 1.d-3
END

EOS GAS
  VISCOSITY CONSTANT 17.9E-06
  HENRYS_CONSTANT CONSTANT 1.d10
  DENSITY IDEAL
END

!=========================== output options ===================================
skip
OUTPUT
  FORMAT TECPLOT POINT
  FORMAT HDF5
  TIMES s 3600. 7200. 28800.
  VARIABLES
    MAXIMUM_PRESSURE
    LIQUID_PRESSURE
    GAS_PRESSURE
    LIQUID_SATURATION
    GAS_SATURATION
    LIQUID_MOLE_FRACTIONS
    GAS_MOLE_FRACTIONS
    LIQUID_DENSITY
    GAS_DENSITY
  /
/
noskip

!=========================== times ============================================
TIME
  FINAL_TIME 28800.0 s
  INITIAL_TIMESTEP_SIZE 0.1 s
  MAXIMUM_TIMESTEP_SIZE 3000.0 s
/

!=========================== regions ==========================================
REGION all
  COORDINATES
    0.d0 0.d0 0.d0
    3.d0 1.d0 2.d0
  /
END

REGION 1
  BLOCK 1 20 1 1 1 1
END

REGION 2
  BLOCK 1 20 1 1 2 2
END

REGION 3
  BLOCK 1 20 1 1 3 3
END

REGION 4
  BLOCK 1 20 1 1 4 4
END

REGION 5
  BLOCK 1 20 1 1 5 5
END

REGION 6
  BLOCK 1 20 1 1 6 6
END

REGION 7
  BLOCK 1 20 1 1 7 7
END

REGION 8
  BLOCK 1 20 1 1 8 8
END

REGION 9
  BLOCK 1 20 1 1 9 9
END

REGION 10
  BLOCK 1 20 1 1 10 10
END

REGION 11
  BLOCK 1 20 1 1 11 11
END

REGION 12
  BLOCK 1 20 1 1 12 12
END

REGION 13
  BLOCK 1 20 1 1 13 13
END

REGION 14
  BLOCK 1 20 1 1 14 14
END

REGION 15
  BLOCK 1 20 1 1 15 15
END

REGION 16
  BLOCK 1 20 1 1 16 16
END

REGION 17
  BLOCK 1 20 1 1 17 17
END

REGION 18
  BLOCK 1 20 1 1 18 18
END

REGION B1
  FACE EAST
  BLOCK 20 20 1 1 1 1
END

REGION B2
  FACE EAST
  BLOCK 20 20 1 1 2 2
END

REGION B3
  FACE EAST
  BLOCK 20 20 1 1 3 3
END

REGION B4
  FACE EAST
  BLOCK 20 20 1 1 4 4
END

REGION B5
  FACE EAST
  BLOCK 20 20 1 1 5 5
END

REGION B6
  FACE EAST
  BLOCK 20 20 1 1 6 6
END

REGION B7
  FACE EAST
  BLOCK 20 20 1 1 7 7
END

REGION B8
  FACE EAST
  BLOCK 20 20 1 1 8 8
END

REGION B9
  FACE EAST
  BLOCK 20 20 1 1 9 9
END

REGION B10
  FACE EAST
  BLOCK 20 20 1 1 10 10
END

REGION B11
  FACE EAST
  BLOCK 20 20 1 1 11 11
END

REGION B12
  FACE EAST
  BLOCK 20 20 1 1 12 12
END

REGION B13
  FACE EAST
  BLOCK 20 20 1 1 13 13
END

REGION B14
  FACE EAST
  BLOCK 20 20 1 1 14 14
END

REGION B15
  FACE EAST
  BLOCK 20 20 1 1 15 15
END

REGION B16
  FACE EAST
  BLOCK 20 20 1 1 16 16
END

REGION B17
  FACE EAST
  BLOCK 20 20 1 1 17 17
END

REGION B18
  FACE EAST
  BLOCK 20 20 1 1 18 18
END

REGION R_EAST_BOUNDARY
  FACE EAST
  BLOCK 20 20 1 1 5 18
END

!=========================== flow conditions ==================================

FLOW_CONDITION 1
  TYPE
    LIQUID_PRESSURE dirichlet  ! later defines these as initial conditions below
    MOLE_FRACTION dirichlet
    TEMPERATURE dirichlet
  /
  LIQUID_PRESSURE 0.10622565D+06
  MOLE_FRACTION 1.D-6
  TEMPERATURE 25.d0  !isothermal ignores this
END

FLOW_CONDITION 2
  TYPE
    LIQUID_PRESSURE dirichlet
    MOLE_FRACTION dirichlet
    TEMPERATURE dirichlet
  /
  LIQUID_PRESSURE 0.10377783D+06
  MOLE_FRACTION 1.D-6
  TEMPERATURE 25.d0
END

FLOW_CONDITION 3
  TYPE
    LIQUID_PRESSURE dirichlet
    MOLE_FRACTION dirichlet
    TEMPERATURE dirichlet
  /
  LIQUID_PRESSURE 0.10230913D+06
  MOLE_FRACTION 1.D-6
  TEMPERATURE 25.d0
END

FLOW_CONDITION 4
  TYPE
    LIQUID_PRESSURE dirichlet
    MOLE_FRACTION dirichlet
    TEMPERATURE dirichlet
  /
  LIQUID_PRESSURE 0.10157478D+06
  MOLE_FRACTION 1.D-6
  TEMPERATURE 25.d0
END

FLOW_CONDITION 5
  TYPE
    GAS_PRESSURE dirichlet
    LIQUID_SATURATION dirichlet
    TEMPERATURE dirichlet
  /
  GAS_PRESSURE 0.10108522D+06
  LIQUID_SATURATION 0.99964370D+00
  TEMPERATURE 25.d0
END

FLOW_CONDITION 6
  TYPE
    GAS_PRESSURE dirichlet
    LIQUID_SATURATION dirichlet
    TEMPERATURE dirichlet
  /
  GAS_PRESSURE 0.10035087D+06
  LIQUID_SATURATION 0.98052838D+00
  TEMPERATURE 25.d0
END

FLOW_CONDITION 7
  TYPE
    GAS_PRESSURE dirichlet
    LIQUID_SATURATION dirichlet
    TEMPERATURE dirichlet
  /
  GAS_PRESSURE 0.99371738D+05
  LIQUID_SATURATION 0.87090754D+00
  TEMPERATURE 25.d0
END

FLOW_CONDITION 8
  TYPE
    GAS_PRESSURE dirichlet
    LIQUID_SATURATION dirichlet
    TEMPERATURE dirichlet
  /
  GAS_PRESSURE 0.98392607D+05
  LIQUID_SATURATION 0.67549792D+00
  TEMPERATURE 25.d0
END

FLOW_CONDITION 9
  TYPE
    GAS_PRESSURE dirichlet
    LIQUID_SATURATION dirichlet
    TEMPERATURE dirichlet
  /
  GAS_PRESSURE 0.97413476D+05
  LIQUID_SATURATION 0.47474155D+00
  TEMPERATURE 25.d0
END

FLOW_CONDITION 10
  TYPE
    GAS_PRESSURE dirichlet
    LIQUID_SATURATION dirichlet
    TEMPERATURE dirichlet
  /
  GAS_PRESSURE 0.96434346D+05
  LIQUID_SATURATION 0.32120575D+00
  TEMPERATURE 25.d0
END

FLOW_CONDITION 11
  TYPE
    GAS_PRESSURE dirichlet
    LIQUID_SATURATION dirichlet
    TEMPERATURE dirichlet
  /
  GAS_PRESSURE 0.95455215D+05
  LIQUID_SATURATION 0.21806666D+00
  TEMPERATURE 25.d0
END

FLOW_CONDITION 12
  TYPE
    GAS_PRESSURE dirichlet
    LIQUID_SATURATION dirichlet
    TEMPERATURE dirichlet
  /
  GAS_PRESSURE 0.94476084D+05
  LIQUID_SATURATION 0.15135593D+00
  TEMPERATURE 25.d0
END

FLOW_CONDITION 13
  TYPE
    GAS_PRESSURE dirichlet
    LIQUID_SATURATION dirichlet
    TEMPERATURE dirichlet
  /
  GAS_PRESSURE 0.93496953D+05
  LIQUID_SATURATION 0.10800850D+00
  TEMPERATURE 25.d0
END

FLOW_CONDITION 14
  TYPE
    GAS_PRESSURE dirichlet
    LIQUID_SATURATION dirichlet
    TEMPERATURE dirichlet
  /
  GAS_PRESSURE 0.92517822D+05
  LIQUID_SATURATION 0.79232753D-01
  TEMPERATURE 25.d0
END

FLOW_CONDITION 15
  TYPE
    GAS_PRESSURE dirichlet
    LIQUID_SATURATION dirichlet
    TEMPERATURE dirichlet
  /
  GAS_PRESSURE 0.91538691D+05
  LIQUID_SATURATION 0.59616072D-01
  TEMPERATURE 25.d0
END

FLOW_CONDITION 16
  TYPE
    GAS_PRESSURE dirichlet
    LIQUID_SATURATION dirichlet
    TEMPERATURE dirichlet
  /
  GAS_PRESSURE 0.90559560D+05
  LIQUID_SATURATION 0.45879896D-01
  TEMPERATURE 25.d0
END

FLOW_CONDITION 17
  TYPE
    GAS_PRESSURE dirichlet
    LIQUID_SATURATION dirichlet
    TEMPERATURE dirichlet
  /
  GAS_PRESSURE 0.89580429D+05
  LIQUID_SATURATION 0.36016551D-01
  TEMPERATURE 25.d0
END

FLOW_CONDITION 18
  TYPE
    GAS_PRESSURE dirichlet
    LIQUID_SATURATION dirichlet
    TEMPERATURE dirichlet
  /
  GAS_PRESSURE 0.88601299D+05
  LIQUID_SATURATION 0.28770300D-01
  TEMPERATURE 25.d0
END


!=========================== condition couplers ===============================
INITIAL_CONDITION
  FLOW_CONDITION 1
  REGION 1
END

INITIAL_CONDITION
  FLOW_CONDITION 2
  REGION 2
END

INITIAL_CONDITION
  FLOW_CONDITION 3
  REGION 3
END

INITIAL_CONDITION
  FLOW_CONDITION 4
  REGION 4
END

INITIAL_CONDITION
  FLOW_CONDITION 5
  REGION 5
END

INITIAL_CONDITION
  FLOW_CONDITION 6
  REGION 6
END

INITIAL_CONDITION
  FLOW_CONDITION 7
  REGION 7
END

INITIAL_CONDITION
  FLOW_CONDITION 8
  REGION 8
END

INITIAL_CONDITION
  FLOW_CONDITION 9
  REGION 9
END

INITIAL_CONDITION
  FLOW_CONDITION 10
  REGION 10
END

INITIAL_CONDITION
  FLOW_CONDITION 11
  REGION 11
END

INITIAL_CONDITION
  FLOW_CONDITION 12
  REGION 12
END

INITIAL_CONDITION
  FLOW_CONDITION 13
  REGION 13
END

INITIAL_CONDITION
  FLOW_CONDITION 14
  REGION 14
END

INITIAL_CONDITION
  FLOW_CONDITION 15
  REGION 15
END

INITIAL_CONDITION
  FLOW_CONDITION 16
  REGION 16
END

INITIAL_CONDITION
  FLOW_CONDITION 17
  REGION 17
END

INITIAL_CONDITION
  FLOW_CONDITION 18
  REGION 18
END


BOUNDARY_CONDITION
  FLOW_CONDITION 1
  REGION B1
END

BOUNDARY_CONDITION
  FLOW_CONDITION 2
  REGION B2
END

BOUNDARY_CONDITION
  FLOW_CONDITION 3
  REGION B3
END

BOUNDARY_CONDITION
  FLOW_CONDITION 4
  REGION B4
END

BOUNDARY_CONDITION
  FLOW_CONDITION seep1
  REGION R_EAST_BOUNDARY
END

skip
BOUNDARY_CONDITION
  FLOW_CONDITION 1
  REGION B1
END

BOUNDARY_CONDITION
  FLOW_CONDITION 2
  REGION B2
END

BOUNDARY_CONDITION
  FLOW_CONDITION 3
  REGION B3
END

BOUNDARY_CONDITION
  FLOW_CONDITION 4
  REGION B4
END

BOUNDARY_CONDITION
  FLOW_CONDITION seep1
  REGION B5
END

BOUNDARY_CONDITION
  FLOW_CONDITION seep1
  REGION B6
END

BOUNDARY_CONDITION
  FLOW_CONDITION seep1
  REGION B7
END

BOUNDARY_CONDITION
  FLOW_CONDITION seep1
  REGION B8
END

BOUNDARY_CONDITION
  FLOW_CONDITION seep1
  REGION B9
END

BOUNDARY_CONDITION
  FLOW_CONDITION seep1
  REGION B10
END

BOUNDARY_CONDITION
  FLOW_CONDITION seep1
  REGION B11
END

BOUNDARY_CONDITION
  FLOW_CONDITION seep1
  REGION B12
END

BOUNDARY_CONDITION
  FLOW_CONDITION seep1
  REGION B13
END

BOUNDARY_CONDITION
  FLOW_CONDITION seep1
  REGION B14
END

BOUNDARY_CONDITION
  FLOW_CONDITION seep1
  REGION B15
END

BOUNDARY_CONDITION
  FLOW_CONDITION seep1
  REGION B16
END

BOUNDARY_CONDITION
  FLOW_CONDITION seep1
  REGION B17
END

BOUNDARY_CONDITION
  FLOW_CONDITION seep1
  REGION B18
END
noskip

SOURCE_SINK well1
  FLOW_CONDITION well1
  REGION INJQ1
/

SOURCE_SINK well2
  FLOW_CONDITION well2
  REGION INJQ2
/

SOURCE_SINK well3
  FLOW_CONDITION well3
  REGION INJQ3
/

SOURCE_SINK well4
  FLOW_CONDITION well4
  REGION INJQ4
/
!=========================== stratigraphy couplers ============================

STRATA
  REGION all
  MATERIAL soil
END

END_SUBSURFACE

