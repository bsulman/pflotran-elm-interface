# uniaxial strain under gravity 
#
#=========================== simulation block ===================================
SIMULATION
  SIMULATION_TYPE GEOMECHANICS_SUBSURFACE  
  PROCESS_MODELS
    SUBSURFACE_FLOW flow
      MODE MPHASE 
    END
    GEOMECHANICS_SUBSURFACE geomech 
    END
  END
END
SUBSURFACE

#=========================== databases ===================================
CO2_DATABASE ../../database/co2data0.dat


#=========================== Debug ===================================
skip
DEBUG
  PRINT_RESIDUAL
  PRINT_SOLUTION
  PRINT_JACOBIAN
END
noskip

#=========================== discretization ===================================
GRID
  TYPE structured
  ORIGIN 0.d0 0.d0 0.d0
  NXYZ 20 20 20 
   BOUNDS
   0.d0 0.d0 0.d0 
   2500.d0 2500.d0 1000.d0
  END
END

#=========================== solver options ===================================
TIMESTEPPER FLOW
 TS_ACCELERATION 8
END

NEWTON_SOLVER FLOW
 ATOL 1D-12
 RTOL 1D-8
 STOL 1D-30
 DTOL 1D15
 ITOL 1D-7
 MAXIT 25
 MAXF 100
END

#=========================== times ============================================
TIME
 FINAL_TIME 1.d-8 y 
 INITIAL_TIMESTEP_SIZE 1.d-8 y
 MAXIMUM_TIMESTEP_SIZE 2.5e2 y
END

#=========================== output options ===================================
OUTPUT
  MASS_BALANCE
  PERIODIC TIMESTEP 1
# FORMAT TECPLOT POINT
  FORMAT HDF5
  FORMAT VTK
END

#=========================== fluid properties =================================
FLUID_PROPERTY 
  DIFFUSION_COEFFICIENT 1.d-9
END

#=========================== material properties ==============================
MATERIAL_PROPERTY formation
ID 1
#POROSITY DATASET Porosity
POROSITY 0.15d0
TORTUOSITY 1.d0
ROCK_DENSITY 2.65d3
SPECIFIC_HEAT 1.d3
THERMAL_CONDUCTIVITY_DRY 2.5
THERMAL_CONDUCTIVITY_WET 2.5 
SATURATION_FUNCTION sf2
PERMEABILITY
# ANISOTROPIC
# DATASET Permeability
# PERM_X 2.171704e-13
# PERM_Y 1.66425e-13
# PERM_Z 3.5266678286297e-14
  PERM_X 2.e-14
  PERM_Y 2.e-14
  PERM_Z 2.e-14
/
/

MATERIAL_PROPERTY caprock
ID 2
#POROSITY DATASET Porosity
POROSITY 0.01d0
TORTUOSITY 1.d0
ROCK_DENSITY 2.65d3
SPECIFIC_HEAT 1.d3
THERMAL_CONDUCTIVITY_DRY 2.5
THERMAL_CONDUCTIVITY_WET 2.5 
SATURATION_FUNCTION sf2
PERMEABILITY
# ANISOTROPIC
# DATASET Permeability
  PERM_X 1.e-17
  PERM_Y 1.e-17
  PERM_Z 1.e-17
/
/

MATERIAL_PROPERTY overburden
ID 3
#POROSITY DATASET Porosity
POROSITY 0.15d0
TORTUOSITY 1.d0
ROCK_DENSITY 2.65d3
SPECIFIC_HEAT 1.d3
THERMAL_CONDUCTIVITY_DRY 2.5
THERMAL_CONDUCTIVITY_WET 2.5 
SATURATION_FUNCTION sf2
PERMEABILITY
# ANISOTROPIC
# DATASET Permeability
  PERM_X 2.e-14
  PERM_Y 2.e-14
  PERM_Z 2.e-14
/
/

MATERIAL_PROPERTY basement
ID 4
#POROSITY DATASET Porosity
POROSITY 0.1d0
TORTUOSITY 1.d0
ROCK_DENSITY 2.65d3
SPECIFIC_HEAT 1.d3
THERMAL_CONDUCTIVITY_DRY 2.5
THERMAL_CONDUCTIVITY_WET 2.5 
SATURATION_FUNCTION sf2
PERMEABILITY
# ANISOTROPIC
# DATASET Permeability
  PERM_X 1.e-16
  PERM_Y 1.e-16
  PERM_Z 1.e-16
/
/

#DATASET Porosity
#FILENAME ./porosity.h5
#/

#DATASET Permeability
#FILENAME ./1unit_permeability.h5
#/

#=========================== saturation functions =============================
SATURATION_FUNCTION sf2
PERMEABILITY_FUNCTION_TYPE MUALEM
SATURATION_FUNCTION_TYPE VAN_GENUCHTEN
RESIDUAL_SATURATION LIQUID_PHASE 0.1
RESIDUAL_SATURATION GAS_PHASE 0.0
LAMBDA 0.762d0
ALPHA 7.5d-4
MAX_CAPILLARY_PRESSURE 1.d6
/

#=========================== regions ==========================================
REGION all
COORDINATES
0.d0 0.d0 0.d0
2500.d0 2500.d0 1000.d0
/
END

REGION basement
COORDINATES
0.d0 0.d0 0.d0
2500.d0 2500.d0 400.d0
/
END

REGION formation
COORDINATES
0.d0 0.d0 400.d0
2500.d0 2500.d0 500.d0
/
END

REGION overburden
COORDINATES
0.d0 0.d0 600.d0
2500.d0 2500.d0 1000.d0
/
END

REGION east
FACE EAST
COORDINATES
2500.d0 0.d0 0.d0
2500.d0 2500.d0 1000.d0
/
END

REGION west
FACE WEST
COORDINATES
0.d0 0.d0 0.d0
0.d0 2500.d0 1000.d0
/
END

REGION north
FACE NORTH
COORDINATES
0.d0 2500.d0 0.d0
2500.d0 2500.d0 1000.d0
/
END

REGION south
FACE SOUTH
COORDINATES
0.d0 0.d0 0.d0
2500.d0 0.d0 1000.d0
/
END

REGION top
FACE TOP
COORDINATES
0.d0 0.d0 1000.d0
2500.d0 2500.d0 1000.d0
/
END

REGION bottom
FACE BOTTOM
COORDINATES
0.d0 0.d0 0.d0
2500.d0 2500.d0 0.d0
/
END

REGION caprock
COORDINATES
0.d0 0.d0 500.d0
2500.d0 2500.d0 600.d0
/
END

REGION well
COORDINATES
1250.d0 1250.d0 400.d0
1250.d0 1250.d0 500.d0
/
END

REGION obs
  COORDINATES
    1250.d0 1250.d0 500.d0
    1250.d0 1250.d0 500.d0
  END
END

#=========================== observation points ===============================

OBSERVATION obs
  REGION obs
  AT_CELL_CENTER
  VELOCITY
END

#=========================== flow conditions ==================================
FLOW_CONDITION initial
  UNITS Pa,C,M,yr
  TYPE
    PRESSURE hydrostatic
    TEMPERATURE dirichlet
    CONCENTRATION dirichlet
    ENTHALPY dirichlet
  END
  DATUM 0.d0 0.d0 1000.d0
  GRADIENT
    TEMPERATURE 0.d0 0.d0 -0.025d0
  END
  IPHASE 1
  PRESSURE 1.01325d5 1.01325d5 
  TEMPERATURE 75.d0
  CONCENTRATION 1.d-8
  ENTHALPY 0.d0 0.d0
END

FLOW_CONDITION east
UNITS Pa,C,M,yr
TYPE
PRESSURE hydrostatic
TEMPERATURE dirichlet
CONCENTRATION dirichlet
ENTHALPY dirichlet
/
DATUM 0.d0 0.d0 1000.d0
GRADIENT
  TEMPERATURE 0.d0 0.d0 -0.025d0
/
IPHASE 1
PRESSURE 2.0D7 2.0D7
TEMPERATURE 75.d0
CONCENTRATION 1.d-16
ENTHALPY 0.d0 0.d0
/

FLOW_CONDITION west
UNITS Pa,C,M,yr
TYPE
PRESSURE hydrostatic
TEMPERATURE dirichlet
CONCENTRATION dirichlet
ENTHALPY dirichlet
/
DATUM 0.d0 0.d0 1000.d0
GRADIENT
  TEMPERATURE 0.d0 0.d0 -0.025d0
/
IPHASE 1
PRESSURE 2.0D7 2.0D7
TEMPERATURE 75.d0
CONCENTRATION 1.d-16
ENTHALPY 0.d0 0.d0
/

FLOW_CONDITION north
UNITS Pa,C,M,yr
TYPE
PRESSURE hydrostatic
TEMPERATURE dirichlet
CONCENTRATION dirichlet
ENTHALPY dirichlet
/
DATUM 0.d0 0.d0 1000.d0
GRADIENT
  TEMPERATURE 0.d0 0.d0 -0.025d0
/
IPHASE 1
PRESSURE 2.0D7 2.0D7
TEMPERATURE 75.d0
CONCENTRATION 1.d-16
ENTHALPY 0.d0 0.d0
/

FLOW_CONDITION south
UNITS Pa,C,M,yr
TYPE
PRESSURE hydrostatic
TEMPERATURE dirichlet
CONCENTRATION dirichlet
ENTHALPY dirichlet
/
DATUM 0.d0 0.d0 1000.d0
GRADIENT
  TEMPERATURE 0.d0 0.d0 -0.025d0
/
IPHASE 1
PRESSURE 2.0D7 2.0D7
TEMPERATURE 75.d0
CONCENTRATION 1.d-16
ENTHALPY 0.d0 0.d0
/

FLOW_CONDITION top
UNITS Pa,C,M,yr
TYPE
PRESSURE hydrostatic 
TEMPERATURE dirichlet
CONCENTRATION dirichlet
ENTHALPY dirichlet
/
DATUM 0.d0 0.d0 1000.d0
GRADIENT
  TEMPERATURE 0.d0 0.d0 -0.025d0
/
IPHASE 1
PRESSURE 2.d7 2.d7 
TEMPERATURE 75.d0
CONCENTRATION 1.d-16
ENTHALPY 0.d0 0.d0
/

FLOW_CONDITION bottom
UNITS Pa,C,M,yr
TYPE
PRESSURE neumann 
TEMPERATURE dirichlet
CONCENTRATION dirichlet
ENTHALPY dirichlet
/
GRADIENT
  TEMPERATURE 0.d0 0.d0 -0.025d0
/
IPHASE 1
PRESSURE 0.d0 0.d0 
TEMPERATURE 75.d0
CONCENTRATION 1.d-16
ENTHALPY 0.d0 0.d0
/

FLOW_CONDITION src
#UNITS Pa,C,M,yr
SYNC_TIMESTEP_WITH_UPDATE
TYPE
RATE mass_rate
PRESSURE dirichlet
TEMPERATURE dirichlet
CONCENTRATION dirichlet
ENTHALPY dirichlet
/
RATE LIST
  TIME_UNITS y
  DATA_UNITS kg/s
0.  0. 10.d0
30. 0. 0.
/
PRESSURE 2.d7 2.d7
TEMPERATURE 75.d0
CONCENTRATION 1.D-16
ENTHALPY 0.d0 0.d0
/

#=========================== condition couplers ===============================
# initial condition
INITIAL_CONDITION
FLOW_CONDITION initial
REGION all
END

# east boundary condition
BOUNDARY_CONDITION east
FLOW_CONDITION initial 
REGION east
END

# west boundary condition
BOUNDARY_CONDITION west
FLOW_CONDITION initial 
REGION west
END

# north boundary condition
BOUNDARY_CONDITION north
FLOW_CONDITION initial 
REGION north
END

# south boundary condition
BOUNDARY_CONDITION south
FLOW_CONDITION initial 
REGION south
END

# top boundary condition
BOUNDARY_CONDITION top
FLOW_CONDITION initial 
REGION top
END

skip
# bottom boundary condition
BOUNDARY_CONDITION bottom
FLOW_CONDITION initial 
REGION bottom
END
noskip

SOURCE_SINK src
FLOW_CONDITION src
REGION well
END

#=========================== stratigraphy couplers ============================
STRATA
REGION formation
MATERIAL formation
END

STRATA
REGION caprock
MATERIAL caprock
END

STRATA
REGION overburden
MATERIAL overburden
END

STRATA
REGION basement
MATERIAL basement
END

END_SUBSURFACE

#================================== geomechanics ===============================
GEOMECHANICS

GEOMECHANICS_GRID
  TYPE unstructured uniaxial_strain/usg.mesh
  GRAVITY 0.d0 0.d0 -9.81
END

GEOMECHANICS_SUBSURFACE_COUPLING TWO_WAY_COUPLED
  MAPPING_FILE uniaxial_strain_mapping.dat
END

NEWTON_SOLVER GEOMECHANICS
#  MAXIT 1
END

GEOMECHANICS_OUTPUT
  TIMES y 0.d0 1.d0 2.d0 5.d0 10.d0 15.d0 20.d0 
 FORMAT HDF5
#  STRAIN_XX
#  STRAIN_YY
#  STRAIN_ZZ
#  STRESS_XX
#  STRESS_YY
#  STRESS_ZZ
#  DISP_X
#  DISP_Y
#  DISP_Z
END

GEOMECHANICS_TIME
  COUPLING_TIMESTEP_SIZE 0.1 y
END

GEOMECHANICS_MATERIAL_PROPERTY rock1 
  ID 1
  YOUNGS_MODULUS 1.d0
  POISSONS_RATIO 0.0
  ROCK_DENSITY 1.d0
  BIOT_COEFFICIENT 0.d0
  THERMAL_EXPANSION_COEFFICIENT 0.d0 #1.d-5
END

GEOMECHANICS_REGION all
  FILE uniaxial_strain/all.vset
END

GEOMECHANICS_REGION top
  FILE uniaxial_strain/top.vset
END

GEOMECHANICS_REGION bottom
  FILE uniaxial_strain/bottom.vset
END

GEOMECHANICS_REGION east
  FILE uniaxial_strain/east.vset
END

GEOMECHANICS_REGION west
  FILE uniaxial_strain/west.vset
END

GEOMECHANICS_REGION north 
  FILE uniaxial_strain/north.vset
END

GEOMECHANICS_REGION south 
  FILE uniaxial_strain/south.vset
END

GEOMECHANICS_CONDITION bottom 
  TYPE
    DISPLACEMENT_Z dirichlet
  END
    DISPLACEMENT_Z 0.d0
END

GEOMECHANICS_CONDITION east 
  TYPE
    DISPLACEMENT_X dirichlet
  END
    DISPLACEMENT_X 0.d0
END

GEOMECHANICS_CONDITION west 
  TYPE
    DISPLACEMENT_X dirichlet
  END
    DISPLACEMENT_X 0.d0
END

GEOMECHANICS_CONDITION north 
  TYPE
    DISPLACEMENT_Y dirichlet
  END
    DISPLACEMENT_Y 0.d0
END

GEOMECHANICS_CONDITION south 
  TYPE
    DISPLACEMENT_Y dirichlet
  END
    DISPLACEMENT_Y 0.d0
END

GEOMECHANICS_BOUNDARY_CONDITION bottom 
  GEOMECHANICS_CONDITION bottom 
  GEOMECHANICS_REGION bottom
END

GEOMECHANICS_BOUNDARY_CONDITION east 
  GEOMECHANICS_CONDITION east 
  GEOMECHANICS_REGION east
END

GEOMECHANICS_BOUNDARY_CONDITION west 
  GEOMECHANICS_CONDITION west 
  GEOMECHANICS_REGION west
END

GEOMECHANICS_BOUNDARY_CONDITION south 
  GEOMECHANICS_CONDITION south 
  GEOMECHANICS_REGION south
END

GEOMECHANICS_BOUNDARY_CONDITION north 
  GEOMECHANICS_CONDITION north 
  GEOMECHANICS_REGION north
END

GEOMECHANICS_STRATA
  GEOMECHANICS_REGION all 
  GEOMECHANICS_MATERIAL rock1
END

END_GEOMECHANICS
